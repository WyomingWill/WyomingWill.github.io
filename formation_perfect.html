<html>
<head>
<title>formation_perfect</title>
<style type="text/css">
<!--
  :link { color: rgb(110, 0, 110); } 
  :visited { color: rgb(110, 0, 110); } 
  body { margin-left: 5px; font-family: arial, sans-serif; 
         background: white; font-size: 12pt } 
  h2 { background: rgb(166,172,255); 
       font-size: 15pt; 
       padding-left: 6px; padding-right: 6px; padding-top: 6px; 
       padding-bottom: 6px; } 
  p { margin-left: 10px; } 
  pre { margin-left: 13px; background: rgb(225,225,225); 
        font-family: monospace; padding-left: 3px; padding-right: 3px; 
        padding-top: 3px; padding-bottom: 3px; } 
-->
</style>
</head>
<body>

<p>This page was automatically generated by NetLogo 4.1.3.</p>

<p>The applet requires Java 5 or higher.
Java must be enabled in your browser settings.
Mac users must have Mac OS X 10.4 or higher.
Windows and Linux users may obtain the latest Java from
<a href="http://java.sun.com/getjava/download.html">Sun's Java site</a>.</p>

<p>
<applet code="org.nlogo.lite.Applet"
        archive="NetLogoLite.jar"
        width="733" height="644">
  <param name="DefaultModel"
         value="formation_perfect.nlogo">
</applet>
</p>

<p>powered by
<a target="_blank" href="http://ccl.northwestern.edu/netlogo/">NetLogo</a></p>

<p>view/download model file:
<a href="formation_perfect.nlogo">formation_perfect.nlogo</a>
</p>
<h2>WHAT IS IT?</h2>
<p>This is an extension of &quot;formation_newton.nlogo,&quot; for the book entitled &quot;Physicomimetics: Physics-Based Swarm Intelligence.&quot;</p><br>
<h2>HOW IT WORKS</h2>
<p>Multiple particles use F = ma and a &quot;split Newtonian&quot; force law to self-organize into a perfect triangular or square lattice. </p><br>
<h2>WHAT IS NEW</h2>
<p>This is the first simulation for Chapter 4 of the book, which pushes the envelope of physicomimetics.  This simulation creates perfect lattices, by making minor modifications to the existing framework. </p>
<p>First, we assume that each particle has an attribute assigned to it at initialization. This attribute is composed of two integers: m and n.  This attribute serves to indicate where a particle should be with respect to another particle.</p>
<p>Second, we require that all particles share a global coordinate system (which was never assumed in the prior simulations).  This can be accomplished easily - each particle is assumed to have a digital compass that tells the particle which way is north. </p>
<p>Finally, we deliberately break Newton's third law to a small degree, by modifying the force law. We do this to improve performance. The reason this is important is because we want to stress that physicomimetics &quot;mimics&quot; physics, as opposed to merely copying physics.  We are task-driven.  If alterations to standard physics improves performance, that is quite acceptable.</p><br>
<h2>HOW TO USE IT</h2>
<p>Click SETUP AGENTS to initialize the particles, and click MOVE AGENTS to have them move.</p>
<p>The CLEAR button will clear the graphics, which becomes handy when particles have their pens down (more on this below).</p>
<p>The NUMBER_OF_PARTICLES slider allows you to control the number of particles created at initialization. Changing this slider while the simulation is running will have no effect. However, you can increase the number of particles while the simulation is running by using the ONE IS BORN button. However, the ONE IS BORN button does not change the number of initial particles when the simulation is restarted by clicking SETUP AGENTS.</p>
<p>The ONE IS BORN button creates a new particle.</p>
<p>There is also a TOGGLE FORMATION button that allows you to choose between square and triangular lattices. </p>
<p>All other sliders will affect the simulation when it is running.</p><br>
<h2>THINGS TO NOTICE</h2>
<p>Particles are initialized in a random cluster in the middle of the graphics pane, and self-organize into a perfect square or triangular lattice. </p>
<p>The GRAVITATIONAL_CONSTANT controls the G parameter in the split Newtonian force law. The POWER controls the value of &quot;p&quot; in the generalized law. The DESIRED_SEPARATION is the desired distance between neighboring particles.</p>
<p>The GOOD GRAVITATIONAL CONSTANT monitor uses the theory established in Chapter 3 to provide guidance on a good value of G, when you change the DESIRED_SEPARATION.</p>
<p>Again, FRICTION is enabled. This allows the system to stabilize.</p>
<p>Note that when creating triangular lattices, angular momentum is not conserved. But note that linear momentum is still conserved. The reason for this is explained in Chapter 4 of the book.</p>
<p>The red dot in the simulation shows the center of mass of the system. If the Conservation of Linear Momentum holds in both the x- and y-dimensions, the red dot will not move. This simulation includes a monitor for the Angular Momentum.</p>
<p>This model allows you to add particles. Adding particles allows you to see how scalable the system is, and illustrates just how nicely new particles are incorporated into the lattice. </p><br>
<h2>THINGS TO TRY</h2>
<p>See how the FRICTION changes behavior. Click SETUP AGENTS, lower the friction, and click MOVE AGENTS.  What happens?  </p>
<p>Similarly, change the GRAVITATIONAL_CONSTANT or the POWER.</p>
<p>Change the DESIRED_SEPARATION while the system is running. Try changing it slowly and then change it quickly. What happens?</p>
<p>Add particles and watch their trajectories.</p>
<p>See how the G PHASE TRANSITION value is affected when you change the GRAVITATIONAL_CONSTANT, the POWER and the FORCE_MAXIMUM.</p>
<p>Toggle between triangular and square formations.  Note how robust the system is - the formations are torn apart and then self-repair.</p><br>
<h2>EXTENDING THE MODEL</h2>
<p>Find a more elegant way to compute the (m, n) attribute. </p>
<p>Consider changing the model so that the (m, n) attribute is swapped between particles, as opposed to having particles move so much.</p>
<p>Extend this model to create perfect honeycomb formations.</p>
<p>Try the Lennard-Jones force law instead.</p>
<p>Note, in order to change any NetLogo simulation, you must have the source code (i.e., &quot;formation_perfect.nlogo&quot;) downloaded to your computer, as well as NetLogo itself. You can not change the code when you are running the simulation with your browser.</p><br>
<h2>NETLOGO FEATURES</h2>
<p>This simulation allows the user to create new particles.</p>
<p>To create a particle, the &quot;hatch&quot; command is used - this clones an existing particle and moves it away from the original. Also, the new particle has the &quot;pen down,&quot; which means that you will see the path that the particle takes. If the graphics pane becomes too busy, click on the CLEAR button.</p>
<p>This code has two procedures (&quot;attract&quot; and &quot;repulse&quot;) where values of arguments are passed to the procedures.</p><br>
<h2>RELATED MODELS</h2>
<p>This is an extension of &quot;formation_newton.nlogo&quot; to create perfect lattices.</p>
<p>Chapter 17 (by Sanza Kazadi) provides alternative mechanisms for creating perfect lattices.  His chapter includes videos of these techniques.</p><br>
<h2>CREDITS AND REFERENCES</h2>
<p>To see the first papers that outlined the work presented in this simulation:</p>
<p>Gordon, D. F., Spears, W. M., Sokolsky, O., and Lee, I. (1999) Distributed spatial control, global monitoring and steering of mobile physical agents. In Proceedings of IEEE International Conference on Information, Intelligence, and Systems.</p>
<p>Spears, W. M., and Gordon, D. F. (1999) Using Artificial Physics to control agents. In Proceedings of IEEE International Conference on Information, Intelligence, and Systems.</p>
<p>The latter paper is the first to show the perfect formations.</p><br>
<h2>HOW TO CITE</h2>
<p>If you mention this model in an academic publication, we ask that you include these citations for the model itself and for the NetLogo software:<br>- Spears, W. M. and Spears, D. F. (eds.) Physicomimetics: Physics-Based Swarm Intelligence, Springer-Verlag, (2011).<br>- Wilensky, U. (1999). NetLogo. <a href="http://ccl.northwestern.edu/netlogo/">http://ccl.northwestern.edu/netlogo/</a>. Center for Connected Learning and Computer-Based Modeling, Northwestern University, Evanston, IL.</p><br>
<h2>COPYRIGHT NOTICE</h2>
<p>Copyright 2011 William M. Spears. All rights reserved.</p>
<p>Permission to use, modify or redistribute this model is hereby granted, provided that both of the following requirements are followed:<br>a) this copyright notice is included, and<br>b) this model will not be redistributed for profit without permission from William M. Spears. Contact William M. Spears for appropriate licenses for redistribution for profit.</p>
<p><a href="http://www.swarmotics.com">http://www.swarmotics.com</a></p><br>
<h2>PROCEDURES</h2>
<pre><font color="#5a5a5a">; William M. Spears September 2011</font><font color="#000000">
</font><font color="#5a5a5a">; Perfect Triangular and Square Lattices Using the Split Newtonian Force Law</font><font color="#000000">
</font><font color="#5a5a5a">; For research and educational use only</font><font color="#000000">

</font><font color="#660096">breed</font><font color="#000000"> [particles particle]                                </font><font color="#5a5a5a">; Introduce the &quot;particle&quot; breed</font><font color="#000000">

</font><font color="#007f69">globals</font><font color="#000000"> [total_lmx total_lmy total_angular_mom G p FR D
         center_of_mass_x center_of_mass_y FMAX DeltaT
         square? square_button?]

</font><font color="#007f69">turtles-own</font><font color="#000000"> [hood deltax deltay r F Fx Fy v vx vy dvx dvy mass view
             lmx lmy theta lever_arm_x lever_arm_y lever_arm_r angular_mom
             squarem squaren hexm hexn pm pn km kn cx cy]

</font><font color="#007f69">to</font><font color="#000000"> setup
   </font><font color="#0000aa">clear-all</font><font color="#000000">                                              </font><font color="#5a5a5a">; Clear everything</font><font color="#000000">
                                                          </font><font color="#5a5a5a">; Create and initialize particles   </font><font color="#000000">
   create-particles Number_of_Particles [setup-particles]
   </font><font color="#0000aa">set</font><font color="#000000"> square_button? </font><font color="#963700">true</font><font color="#000000">                                </font><font color="#5a5a5a">; Start with a square lattice</font><font color="#000000">
   update-info
                                                          </font><font color="#5a5a5a">; Computes center of mass and displays location</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> center_of_mass_x (</font><font color="#660096">sum</font><font color="#000000"> [</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> mass] </font><font color="#660096">of</font><font color="#000000"> particles) </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#660096">sum</font><font color="#000000"> [mass] </font><font color="#660096">of</font><font color="#000000"> particles)
   </font><font color="#0000aa">set</font><font color="#000000"> center_of_mass_y (</font><font color="#660096">sum</font><font color="#000000"> [</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> mass] </font><font color="#660096">of</font><font color="#000000"> particles) </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#660096">sum</font><font color="#000000"> [mass] </font><font color="#660096">of</font><font color="#000000"> particles)
   </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patch</font><font color="#000000"> (</font><font color="#660096">round</font><font color="#000000"> center_of_mass_x) (</font><font color="#660096">round</font><font color="#000000"> center_of_mass_y) 
      [</font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">in-radius</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000">]] 
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> run-and-monitor
   </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) [</font><font color="#0000aa">user-message</font><font color="#000000"> </font><font color="#963700">&quot;Please click HALT and then SETUP AGENTS first&quot;</font><font color="#000000"> </font><font color="#0000aa">stop</font><font color="#000000">]
   update-info
   </font><font color="#0000aa">ask</font><font color="#000000"> particles [ap-particles]
   </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> [move]
                                                          </font><font color="#5a5a5a">; Computes center of mass and displays location</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> center_of_mass_x (</font><font color="#660096">sum</font><font color="#000000"> [</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> mass] </font><font color="#660096">of</font><font color="#000000"> particles) </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#660096">sum</font><font color="#000000"> [mass] </font><font color="#660096">of</font><font color="#000000"> particles)
   </font><font color="#0000aa">set</font><font color="#000000"> center_of_mass_y (</font><font color="#660096">sum</font><font color="#000000"> [</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> mass] </font><font color="#660096">of</font><font color="#000000"> particles) </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#660096">sum</font><font color="#000000"> [mass] </font><font color="#660096">of</font><font color="#000000"> particles)
   </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patch</font><font color="#000000"> (</font><font color="#660096">round</font><font color="#000000"> center_of_mass_x) (</font><font color="#660096">round</font><font color="#000000"> center_of_mass_y)
      [</font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">in-radius</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000">]]  

   </font><font color="#0000aa">set</font><font color="#000000"> total_lmx </font><font color="#660096">sum</font><font color="#000000"> [lmx] </font><font color="#660096">of</font><font color="#000000"> particles                   </font><font color="#5a5a5a">; Total linear momentum, x-component</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> total_lmy </font><font color="#660096">sum</font><font color="#000000"> [lmy] </font><font color="#660096">of</font><font color="#000000"> particles                   </font><font color="#5a5a5a">; Total linear momentum, y-component</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> total_angular_mom </font><font color="#660096">sum</font><font color="#000000"> [angular_mom] </font><font color="#660096">of</font><font color="#000000"> particles   </font><font color="#5a5a5a">; Total angular momentum of objects</font><font color="#000000">
   </font><font color="#0000aa">tick</font><font color="#000000">
   do-plots
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> setup-particles                                        </font><font color="#5a5a5a">; Set up the particles</font><font color="#000000">
   </font><font color="#0000aa">setxy</font><font color="#000000"> (</font><font color="#660096">random-normal</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">20</font><font color="#000000">) (</font><font color="#660096">random-normal</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">20</font><font color="#000000">)        </font><font color="#5a5a5a">; Start in a cluster</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">heading</font><font color="#000000"> </font><font color="#660096">random</font><font color="#000000"> </font><font color="#963700">360</font><font color="#000000">                                 </font><font color="#5a5a5a">; Everyone has a random heading </font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> vx </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> vy </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> mass </font><font color="#963700">1</font><font color="#000000">                           </font><font color="#5a5a5a">; Start with no motion and mass = 1</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> </font><font color="#963700">&quot;circle&quot;</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000"> </font><font color="#963700">5</font><font color="#000000">
   </font><font color="#0000aa">ifelse</font><font color="#000000"> ((</font><font color="#660096">who</font><font color="#000000"> </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">) </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) 
      [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">white</font><font color="#000000">] 
      [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">yellow</font><font color="#000000">]                                  </font><font color="#5a5a5a">; Different colors for square formations</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> theta </font><font color="#963700">0</font><font color="#000000">
   init-m-n
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">; Terribly ugly code to set up the (m,n) attributes. It would </font><font color="#000000">
</font><font color="#5a5a5a">; be wonderful if someone could make this more elegant - hint hint.</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> init-m-n
   </font><font color="#5a5a5a">; For square lattices</font><font color="#000000">
   </font><font color="#0000aa">let</font><font color="#000000"> ring (</font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> (</font><font color="#660096">floor</font><font color="#000000"> (</font><font color="#660096">sqrt</font><font color="#000000"> (</font><font color="#660096">who</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000">))))
   </font><font color="#0000aa">let</font><font color="#000000"> index (</font><font color="#660096">who</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> ((ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) </font><font color="#660096">*</font><font color="#000000"> (ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) </font><font color="#660096">*</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000">))

   </font><font color="#0000aa">ifelse</font><font color="#000000"> (index </font><font color="#660096">&lt;</font><font color="#000000"> (</font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">))  [</font><font color="#0000aa">set</font><font color="#000000"> squarem (</font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> index </font><font color="#660096">-</font><font color="#000000"> ring)] [
   </font><font color="#0000aa">ifelse</font><font color="#000000"> (index </font><font color="#660096">&lt;=</font><font color="#000000"> (</font><font color="#963700">4</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">)) [</font><font color="#0000aa">set</font><font color="#000000"> squarem ring] [
   </font><font color="#0000aa">ifelse</font><font color="#000000"> (index </font><font color="#660096">&lt;</font><font color="#000000"> (</font><font color="#963700">6</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000">))  [</font><font color="#0000aa">set</font><font color="#000000"> squarem (</font><font color="#963700">5</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">-</font><font color="#000000"> index </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">)] [</font><font color="#0000aa">set</font><font color="#000000"> squarem (</font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> ring)]]]

   </font><font color="#0000aa">ifelse</font><font color="#000000"> (index </font><font color="#660096">&lt;</font><font color="#000000"> ( </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring))     [</font><font color="#0000aa">set</font><font color="#000000"> squaren (ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">)] [
   </font><font color="#0000aa">ifelse</font><font color="#000000"> (index </font><font color="#660096">&lt;</font><font color="#000000"> (</font><font color="#963700">4</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">))  [</font><font color="#0000aa">set</font><font color="#000000"> squaren (</font><font color="#963700">3</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> index)] [
   </font><font color="#0000aa">ifelse</font><font color="#000000"> (index </font><font color="#660096">&lt;</font><font color="#000000"> (</font><font color="#963700">6</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">))  [</font><font color="#0000aa">set</font><font color="#000000"> squaren (</font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> ring)] [</font><font color="#0000aa">set</font><font color="#000000"> squaren (index </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000">)]]]
      
   </font><font color="#5a5a5a">; For triangular lattices, good up to 126 particles</font><font color="#000000">
   </font><font color="#0000aa">ifelse</font><font color="#000000"> (</font><font color="#660096">who</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">)  [</font><font color="#0000aa">set</font><font color="#000000"> ring </font><font color="#963700">1</font><font color="#000000">] [
   </font><font color="#0000aa">ifelse</font><font color="#000000"> (</font><font color="#660096">who</font><font color="#000000"> </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000">)  [</font><font color="#0000aa">set</font><font color="#000000"> ring </font><font color="#963700">2</font><font color="#000000">] [
   </font><font color="#0000aa">ifelse</font><font color="#000000"> (</font><font color="#660096">who</font><font color="#000000"> </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">19</font><font color="#000000">) [</font><font color="#0000aa">set</font><font color="#000000"> ring </font><font color="#963700">3</font><font color="#000000">] [
   </font><font color="#0000aa">ifelse</font><font color="#000000"> (</font><font color="#660096">who</font><font color="#000000"> </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">37</font><font color="#000000">) [</font><font color="#0000aa">set</font><font color="#000000"> ring </font><font color="#963700">4</font><font color="#000000">] [
   </font><font color="#0000aa">ifelse</font><font color="#000000"> (</font><font color="#660096">who</font><font color="#000000"> </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">61</font><font color="#000000">) [</font><font color="#0000aa">set</font><font color="#000000"> ring </font><font color="#963700">5</font><font color="#000000">] [
   </font><font color="#0000aa">ifelse</font><font color="#000000"> (</font><font color="#660096">who</font><font color="#000000"> </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">91</font><font color="#000000">) [</font><font color="#0000aa">set</font><font color="#000000"> ring </font><font color="#963700">6</font><font color="#000000">] [</font><font color="#0000aa">set</font><font color="#000000"> ring </font><font color="#963700">7</font><font color="#000000">]]]]]]

   </font><font color="#0000aa">ifelse</font><font color="#000000"> (</font><font color="#660096">who</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) 
      [</font><font color="#0000aa">set</font><font color="#000000"> index </font><font color="#963700">0</font><font color="#000000">]
      [</font><font color="#0000aa">set</font><font color="#000000"> index (</font><font color="#660096">who</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> ((</font><font color="#963700">3</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">*</font><font color="#000000"> ring) </font><font color="#660096">-</font><font color="#000000"> (</font><font color="#963700">9</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring) </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000">))]

   </font><font color="#0000aa">ifelse</font><font color="#000000"> (index </font><font color="#660096">&lt;</font><font color="#000000"> ring) [</font><font color="#0000aa">set</font><font color="#000000"> hexm (</font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> index </font><font color="#660096">-</font><font color="#000000"> (ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">))] [
   </font><font color="#0000aa">ifelse</font><font color="#000000"> (((</font><font color="#963700">3</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000">) </font><font color="#660096">&lt;=</font><font color="#000000"> index) </font><font color="#660096">and</font><font color="#000000"> (index </font><font color="#660096">&lt;=</font><font color="#000000"> (</font><font color="#963700">4</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000">))) [</font><font color="#0000aa">set</font><font color="#000000"> hexm ((</font><font color="#963700">8</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring) </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">8</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> (</font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> index) </font><font color="#660096">-</font><font color="#000000"> (ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">))] [
   </font><font color="#0000aa">ifelse</font><font color="#000000"> ((ring </font><font color="#660096">&lt;=</font><font color="#000000"> index) </font><font color="#660096">and</font><font color="#000000"> (index </font><font color="#660096">&lt;</font><font color="#000000"> (</font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">))) [</font><font color="#0000aa">set</font><font color="#000000"> hexm index] [
   </font><font color="#0000aa">ifelse</font><font color="#000000"> (index </font><font color="#660096">=</font><font color="#000000"> (</font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">)) [</font><font color="#0000aa">set</font><font color="#000000"> hexm (</font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">)] [
   </font><font color="#0000aa">ifelse</font><font color="#000000"> (((</font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">) </font><font color="#660096">&lt;</font><font color="#000000"> index) </font><font color="#660096">and</font><font color="#000000"> (index </font><font color="#660096">&lt;</font><font color="#000000"> (</font><font color="#963700">3</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000">))) [</font><font color="#0000aa">set</font><font color="#000000"> hexm ((</font><font color="#963700">4</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring) </font><font color="#660096">-</font><font color="#000000"> index </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000">)] [
   </font><font color="#0000aa">ifelse</font><font color="#000000"> (((</font><font color="#963700">4</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000">) </font><font color="#660096">&lt;</font><font color="#000000"> index) </font><font color="#660096">and</font><font color="#000000"> (index </font><font color="#660096">&lt;</font><font color="#000000"> (</font><font color="#963700">5</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">5</font><font color="#000000">))) [</font><font color="#0000aa">set</font><font color="#000000"> hexm (</font><font color="#963700">3</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">-</font><font color="#000000"> index </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000">)] [
   </font><font color="#0000aa">ifelse</font><font color="#000000"> ((</font><font color="#963700">5</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">5</font><font color="#000000">) </font><font color="#660096">&lt;</font><font color="#000000"> index) [</font><font color="#0000aa">set</font><font color="#000000"> hexm (index </font><font color="#660096">-</font><font color="#000000"> (</font><font color="#963700">7</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring) </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000">)] [
   </font><font color="#0000aa">if</font><font color="#000000"> (index </font><font color="#660096">=</font><font color="#000000"> (</font><font color="#963700">5</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">5</font><font color="#000000">)) [</font><font color="#0000aa">set</font><font color="#000000"> hexm (</font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring)]]]]]]]]
      
   </font><font color="#0000aa">ifelse</font><font color="#000000"> (index </font><font color="#660096">&lt;</font><font color="#000000"> ring) [</font><font color="#0000aa">set</font><font color="#000000"> hexn ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">] [
   </font><font color="#0000aa">ifelse</font><font color="#000000"> (((</font><font color="#963700">3</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000">) </font><font color="#660096">&lt;=</font><font color="#000000"> index) </font><font color="#660096">and</font><font color="#000000"> (index </font><font color="#660096">&lt;=</font><font color="#000000"> (</font><font color="#963700">4</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000">))) [</font><font color="#0000aa">set</font><font color="#000000"> hexn </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> ring] [
   </font><font color="#0000aa">ifelse</font><font color="#000000"> ((ring </font><font color="#660096">&lt;=</font><font color="#000000"> index) </font><font color="#660096">and</font><font color="#000000"> (index </font><font color="#660096">&lt;</font><font color="#000000"> (</font><font color="#963700">3</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000">))) [</font><font color="#0000aa">set</font><font color="#000000"> hexn (</font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">-</font><font color="#000000"> index </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">)] [
   </font><font color="#0000aa">if</font><font color="#000000"> (index </font><font color="#660096">&gt;</font><font color="#000000"> (</font><font color="#963700">4</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000">)) [</font><font color="#0000aa">set</font><font color="#000000"> hexn (index </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">5</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">5</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ring)]]]]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">; Attractive force, x- and y-components</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> attract [wx wy]
   </font><font color="#0000aa">set</font><font color="#000000"> Fx (Fx </font><font color="#660096">+</font><font color="#000000"> wx </font><font color="#660096">*</font><font color="#000000"> F </font><font color="#660096">*</font><font color="#000000"> (deltax </font><font color="#660096">/</font><font color="#000000"> r))
   </font><font color="#0000aa">set</font><font color="#000000"> Fy (Fy </font><font color="#660096">+</font><font color="#000000"> wy </font><font color="#660096">*</font><font color="#000000"> F </font><font color="#660096">*</font><font color="#000000"> (deltay </font><font color="#660096">/</font><font color="#000000"> r))
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">; Repulsive force, x- and y-components</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> repulse [wx wy]
   </font><font color="#0000aa">set</font><font color="#000000"> Fx (Fx </font><font color="#660096">-</font><font color="#000000"> wx </font><font color="#660096">*</font><font color="#000000"> F </font><font color="#660096">*</font><font color="#000000"> (deltax </font><font color="#660096">/</font><font color="#000000"> r))
   </font><font color="#0000aa">set</font><font color="#000000"> Fy (Fy </font><font color="#660096">-</font><font color="#000000"> wy </font><font color="#660096">*</font><font color="#000000"> F </font><font color="#660096">*</font><font color="#000000"> (deltay </font><font color="#660096">/</font><font color="#000000"> r))
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> ap-particles                                           </font><font color="#5a5a5a">; Run artificial physics</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> Fx </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> Fy </font><font color="#963700">0</font><font color="#000000">                                      </font><font color="#5a5a5a">; Initialize force components to zero</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> vx (</font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> FR) </font><font color="#660096">*</font><font color="#000000"> vx                                   </font><font color="#5a5a5a">; Slow down according to friction</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> vy (</font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> FR) </font><font color="#660096">*</font><font color="#000000"> vy 
   
   </font><font color="#0000aa">set</font><font color="#000000"> hood [</font><font color="#660096">who</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">other</font><font color="#000000"> particles                      </font><font color="#5a5a5a">; Get the IDs of everyone else</font><font color="#000000">
   </font><font color="#0000aa">foreach</font><font color="#000000"> hood [         
      </font><font color="#0000aa">set</font><font color="#000000"> deltax (([</font><font color="#660096">xcor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> particle ?) </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000">) 
      </font><font color="#0000aa">set</font><font color="#000000"> deltay (([</font><font color="#660096">ycor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> particle ?) </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000">) 
      </font><font color="#0000aa">set</font><font color="#000000"> r </font><font color="#660096">sqrt</font><font color="#000000"> (deltax </font><font color="#660096">*</font><font color="#000000"> deltax </font><font color="#660096">+</font><font color="#000000"> deltay </font><font color="#660096">*</font><font color="#000000"> deltay)
      </font><font color="#0000aa">set</font><font color="#000000"> view </font><font color="#963700">1.5</font><font color="#000000">                                        </font><font color="#5a5a5a">; For triangular lattice </font><font color="#000000">
      </font><font color="#0000aa">if</font><font color="#000000"> (square?) [                                      </font><font color="#5a5a5a">; For square lattice</font><font color="#000000">
      </font><font color="#0000aa">ifelse</font><font color="#000000"> ((</font><font color="#660096">who</font><font color="#000000"> </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">) </font><font color="#660096">=</font><font color="#000000"> (? </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">)) 
         [</font><font color="#0000aa">set</font><font color="#000000"> view </font><font color="#963700">1.3</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> r (r </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#660096">sqrt</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">))]              </font><font color="#5a5a5a">; See Chapter 3 for details</font><font color="#000000">
         [</font><font color="#0000aa">set</font><font color="#000000"> view </font><font color="#963700">1.7</font><font color="#000000">]
      ]
    
      </font><font color="#0000aa">ifelse</font><font color="#000000"> (square?) 
         [</font><font color="#0000aa">set</font><font color="#000000"> pm squarem </font><font color="#0000aa">set</font><font color="#000000"> pn squaren </font><font color="#0000aa">set</font><font color="#000000"> cx </font><font color="#963700">0.5</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> cy </font><font color="#963700">0.5</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> km ([squarem] </font><font color="#660096">of</font><font color="#000000"> particle ?) </font><font color="#0000aa">set</font><font color="#000000"> kn ([squaren] </font><font color="#660096">of</font><font color="#000000"> particle ?)] 
         [</font><font color="#0000aa">set</font><font color="#000000"> pm hexm </font><font color="#0000aa">set</font><font color="#000000"> pn hexn </font><font color="#0000aa">set</font><font color="#000000"> cx </font><font color="#963700">0.25</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> cy </font><font color="#963700">0.433</font><font color="#000000">
           </font><font color="#0000aa">set</font><font color="#000000"> km ([hexm] </font><font color="#660096">of</font><font color="#000000"> particle ?) </font><font color="#0000aa">set</font><font color="#000000"> kn ([hexn] </font><font color="#660096">of</font><font color="#000000"> particle ?)] 
         
      </font><font color="#0000aa">if</font><font color="#000000"> (r </font><font color="#660096">&lt;</font><font color="#000000"> view </font><font color="#660096">*</font><font color="#000000"> D) [                                 </font><font color="#5a5a5a">; The generalized split Newtonian law</font><font color="#000000">
         </font><font color="#0000aa">set</font><font color="#000000"> F (G </font><font color="#660096">*</font><font color="#000000"> mass </font><font color="#660096">*</font><font color="#000000"> ([mass] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">turtle</font><font color="#000000"> ?) </font><font color="#660096">/</font><font color="#000000"> (r </font><font color="#660096">^</font><font color="#000000"> p)) 
         </font><font color="#0000aa">if</font><font color="#000000"> (F </font><font color="#660096">&gt;</font><font color="#000000"> FMAX) [</font><font color="#0000aa">set</font><font color="#000000"> F FMAX]                       </font><font color="#5a5a5a">; Bounds check on force magnitude</font><font color="#000000">

         </font><font color="#0000aa">ifelse</font><font color="#000000"> (r </font><font color="#660096">&gt;</font><font color="#000000"> D) [attract </font><font color="#963700">1</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">] [
         </font><font color="#0000aa">ifelse</font><font color="#000000"> (((deltax </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">and</font><font color="#000000"> (pm </font><font color="#660096">&lt;</font><font color="#000000"> km) </font><font color="#660096">and</font><font color="#000000"> (deltay </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">and</font><font color="#000000"> (pn </font><font color="#660096">&lt;</font><font color="#000000"> kn)) </font><font color="#660096">or</font><font color="#000000">
                 ((deltax </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">and</font><font color="#000000"> (pm </font><font color="#660096">&gt;</font><font color="#000000"> km) </font><font color="#660096">and</font><font color="#000000"> (deltay </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">and</font><font color="#000000"> (pn </font><font color="#660096">&gt;</font><font color="#000000"> kn))) [attract </font><font color="#963700">2</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">] [
         </font><font color="#0000aa">ifelse</font><font color="#000000"> (((deltax </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">and</font><font color="#000000"> (pm </font><font color="#660096">&lt;</font><font color="#000000"> km)) </font><font color="#660096">or</font><font color="#000000"> ((deltax </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">and</font><font color="#000000"> (pm </font><font color="#660096">&gt;</font><font color="#000000"> km))) [attract </font><font color="#963700">2</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">] [
         </font><font color="#0000aa">ifelse</font><font color="#000000"> (((deltay </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">and</font><font color="#000000"> (pn </font><font color="#660096">&lt;</font><font color="#000000"> kn)) </font><font color="#660096">or</font><font color="#000000"> ((deltay </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">and</font><font color="#000000"> (pn </font><font color="#660096">&gt;</font><font color="#000000"> kn))) [attract </font><font color="#963700">2</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">] [
         </font><font color="#0000aa">ifelse</font><font color="#000000"> (((pn </font><font color="#660096">=</font><font color="#000000"> kn) </font><font color="#660096">and</font><font color="#000000"> (</font><font color="#660096">abs</font><font color="#000000">(deltay) </font><font color="#660096">&gt;</font><font color="#000000"> cy </font><font color="#660096">*</font><font color="#000000"> D)) </font><font color="#660096">or</font><font color="#000000"> ((pm </font><font color="#660096">=</font><font color="#000000"> km) </font><font color="#660096">and</font><font color="#000000"> (</font><font color="#660096">abs</font><font color="#000000">(deltax) </font><font color="#660096">&gt;</font><font color="#000000"> cx </font><font color="#660096">*</font><font color="#000000"> D))) [attract </font><font color="#963700">2</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">] [
         </font><font color="#0000aa">ifelse</font><font color="#000000"> ((</font><font color="#660096">not</font><font color="#000000"> square?) </font><font color="#660096">and</font><font color="#000000"> (pn </font><font color="#660096">!=</font><font color="#000000"> kn) </font><font color="#660096">and</font><font color="#000000"> (</font><font color="#660096">abs</font><font color="#000000">(deltay) </font><font color="#660096">&lt;</font><font color="#000000"> cy </font><font color="#660096">*</font><font color="#000000"> D)) [repulse </font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000">] [
         </font><font color="#0000aa">ifelse</font><font color="#000000"> ((</font><font color="#660096">not</font><font color="#000000"> square?) </font><font color="#660096">and</font><font color="#000000"> (pm </font><font color="#660096">!=</font><font color="#000000"> km) </font><font color="#660096">and</font><font color="#000000"> (</font><font color="#660096">abs</font><font color="#000000">(deltax) </font><font color="#660096">&lt;</font><font color="#000000"> cx </font><font color="#660096">*</font><font color="#000000"> D)) [repulse </font><font color="#963700">3</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">] [repulse </font><font color="#963700">1</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">]]]]]]]]
   ]
   
   </font><font color="#0000aa">set</font><font color="#000000"> dvx DeltaT </font><font color="#660096">*</font><font color="#000000"> (Fx </font><font color="#660096">/</font><font color="#000000"> mass)
   </font><font color="#0000aa">set</font><font color="#000000"> dvy DeltaT </font><font color="#660096">*</font><font color="#000000"> (Fy </font><font color="#660096">/</font><font color="#000000"> mass)
   </font><font color="#0000aa">set</font><font color="#000000"> vx  (vx </font><font color="#660096">+</font><font color="#000000"> dvx)                                     </font><font color="#5a5a5a">; The x-component of velocity</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> vy  (vy </font><font color="#660096">+</font><font color="#000000"> dvy)                                     </font><font color="#5a5a5a">; The y-component of velocity</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> v </font><font color="#660096">sqrt</font><font color="#000000"> (vx </font><font color="#660096">*</font><font color="#000000"> vx </font><font color="#660096">+</font><font color="#000000"> vy </font><font color="#660096">*</font><font color="#000000"> vy)

   </font><font color="#0000aa">set</font><font color="#000000"> deltax DeltaT </font><font color="#660096">*</font><font color="#000000"> vx
   </font><font color="#0000aa">set</font><font color="#000000"> deltay DeltaT </font><font color="#660096">*</font><font color="#000000"> vy 
   </font><font color="#0000aa">if</font><font color="#000000"> ((deltax </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (deltay </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">)) 
      [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">heading</font><font color="#000000"> (</font><font color="#660096">atan</font><font color="#000000"> deltax deltay)] 
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> move                                                   </font><font color="#5a5a5a">; Move the turtle</font><font color="#000000">
   </font><font color="#0000aa">fd</font><font color="#000000"> (</font><font color="#660096">sqrt</font><font color="#000000"> (deltax </font><font color="#660096">*</font><font color="#000000"> deltax </font><font color="#660096">+</font><font color="#000000"> deltay </font><font color="#660096">*</font><font color="#000000"> deltay))

   </font><font color="#0000aa">set</font><font color="#000000"> lmx (mass </font><font color="#660096">*</font><font color="#000000"> vx)                                    </font><font color="#5a5a5a">; Linear momentum of the turtle</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> lmy (mass </font><font color="#660096">*</font><font color="#000000"> vy)
   
   </font><font color="#0000aa">set</font><font color="#000000"> lever_arm_x (</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> center_of_mass_x)
   </font><font color="#0000aa">set</font><font color="#000000"> lever_arm_y (</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> center_of_mass_y)
   </font><font color="#0000aa">set</font><font color="#000000"> lever_arm_r </font><font color="#660096">sqrt</font><font color="#000000"> (lever_arm_x </font><font color="#660096">*</font><font color="#000000"> lever_arm_x </font><font color="#660096">+</font><font color="#000000"> lever_arm_y </font><font color="#660096">*</font><font color="#000000"> lever_arm_y)
   </font><font color="#0000aa">if</font><font color="#000000"> (((vx </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (vy </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">)) </font><font color="#660096">and</font><font color="#000000"> ((lever_arm_x </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (lever_arm_y </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">)))
      [</font><font color="#0000aa">set</font><font color="#000000"> theta (</font><font color="#660096">atan</font><font color="#000000"> (mass </font><font color="#660096">*</font><font color="#000000"> vy) (mass </font><font color="#660096">*</font><font color="#000000"> vx)) </font><font color="#660096">-</font><font color="#000000"> (</font><font color="#660096">atan</font><font color="#000000"> lever_arm_y lever_arm_x)]
   </font><font color="#0000aa">set</font><font color="#000000"> angular_mom (lever_arm_r </font><font color="#660096">*</font><font color="#000000"> mass </font><font color="#660096">*</font><font color="#000000"> v </font><font color="#660096">*</font><font color="#000000"> (</font><font color="#660096">sin</font><font color="#000000"> theta)) </font><font color="#5a5a5a">; Angular momentum of the turtle</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> update-info                                            </font><font color="#5a5a5a">; Update information from the sliders</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> G Gravitational_Constant
   </font><font color="#0000aa">set</font><font color="#000000"> p Power
   </font><font color="#0000aa">set</font><font color="#000000"> FMAX Force_Maximum
   </font><font color="#0000aa">set</font><font color="#000000"> FR Friction
   </font><font color="#0000aa">set</font><font color="#000000"> DeltaT Time_Step
   </font><font color="#0000aa">set</font><font color="#000000"> D Desired_Separation
   </font><font color="#0000aa">set</font><font color="#000000"> square? square_button?
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> do-plots
   </font><font color="#0000aa">set-current-plot</font><font color="#000000"> </font><font color="#963700">&quot;Linear and Angular Momenta&quot;</font><font color="#000000">          </font><font color="#5a5a5a">; Select the Momenta plot</font><font color="#000000">
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;Lmx&quot;</font><font color="#000000">                             </font><font color="#5a5a5a">; Select the Lmx pen</font><font color="#000000">
   </font><font color="#0000aa">plot</font><font color="#000000"> total_lmx                                         </font><font color="#5a5a5a">; Plot the linear momentum, x-component</font><font color="#000000">
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;Lmy&quot;</font><font color="#000000">
   </font><font color="#0000aa">plot</font><font color="#000000"> total_lmy                                         </font><font color="#5a5a5a">; Plot the linear momentum, y-component</font><font color="#000000">
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;Angular&quot;</font><font color="#000000">
   </font><font color="#0000aa">plot</font><font color="#000000"> total_angular_mom                                 </font><font color="#5a5a5a">; Plot the angular momentum</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">; Create a new particle</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> one-is-born
   </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">count</font><font color="#000000"> (particles </font><font color="#660096">with</font><font color="#000000"> [mass </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">]) </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) [ 
      </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">one-of</font><font color="#000000"> particles </font><font color="#660096">with</font><font color="#000000"> [mass </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">]
         [</font><font color="#0000aa">hatch</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> deltax </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> deltay </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">pd</font><font color="#000000"> init-m-n  </font><font color="#5a5a5a">; Clone an existing particle</font><font color="#000000">
                   </font><font color="#0000aa">ifelse</font><font color="#000000"> ((</font><font color="#660096">who</font><font color="#000000"> </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">) </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) 
                     [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">white</font><font color="#000000">] 
                     [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">yellow</font><font color="#000000">]                   </font><font color="#5a5a5a">; Different colors for square formations</font><font color="#000000">
                   </font><font color="#0000aa">setxy</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> (</font><font color="#660096">random-normal</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> (D </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">)) 
                         </font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> (</font><font color="#660096">random-normal</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> (D </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">))]]
   ] 
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">; Toggle between triangular and square formations</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> toggle-formation
  </font><font color="#0000aa">if</font><font color="#000000"> (square_button? </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) [</font><font color="#0000aa">set</font><font color="#000000"> square_button? </font><font color="#660096">not</font><font color="#000000"> square_button?]
</font><font color="#007f69">end</font><font color="#000000">
</font>
</pre>

</body>
</html>
