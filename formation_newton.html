<html>
<head>
<title>formation_newton</title>
<style type="text/css">
<!--
/*
    This style sheet is borrowed from the NetLogo User Manual.  However, some of the units were
    changed from em to px because Java's StyleSheet support is limited for relative units such as
    em and % (this will supposively improve with newer versions of the VM) - jrn 7/21/05
    BE VERY VERY CAREFUL when you alter this style sheet -- it's possible to put in
    innocent-looking things that work on some VM's but cause Java exceptions on other for example
    we were using "font-size: 125%" but it caused Java exceptions on Java 1.5 on Windows - ST
    8/25/05
*/
:link { color: rgb(110,0,110); }
:visited { color: rgb(110,0,110); }
body {
    margin-left: 5px;
    font-family: arial, sans-serif;
    background: white;
    font-size: 12pt
}
h1 {
    color: white;
    background: rgb(45,0,45);
    font-size: 18pt;
    margin-bottom: 4px;
    padding-left: 6px;
    padding-right: 6px;
    padding-top: 6px;
    padding-bottom: 6px;
}
h2 {
    margin-top: 15px;
    margin-left: 6px;
    margin-bottom: 4px;
    background: rgb(166,172,255);
    font-size: 15pt;
    padding-left: 6px;
    padding-right: 6px;
    padding-top: 6px;
    padding-bottom: 6px;
}
h3 {
    margin-top: 15px;
    margin-left: 13px;
    margin-bottom: 4px;
    background: rgb(175,175,175);
    font-size: 12pt;
    padding: 0.2em;
    padding-left: 6px;
    padding-right: 6px;
    padding-top: 6px;
    padding-bottom: 6px;
}
h4 {
    margin-top: 15px;
    margin-bottom: 5px;
    margin-left: 15px;
    font-size: 12pt;
}
h5 {
    margin-top: 15px;
    margin-left: 15px;
    font-size: 12pt;
}
h6 {
    margin-top: 15px;
    margin-left: 15px;
    font-size: 12pt;
}
p {
    margin-left: 15px;
    margin-bottom: 3px;
}
pre {
    margin-left: 13px;
    background: rgb(225,225,225);
    font-family: monospace;
    font-size: 12pt;
    padding-left: 10px;
    padding-right: 3px;
    padding-top: 7px;
    padding-bottom: 7px;
    margin-top:9px;
    margin-bottom:0px;
}
code {
    font-family: monospace;
    font-size: 12pt;
}
blockquote {
    border: solid;
    border-style: solid;
    border-width: thin;
    border-color: black;
    background: rgb(250,250,220);
    padding-top: 0px;
    padding-bottom: 7px;
    margin-top: 7px;
    margin-bottom:1px;
}
ol {
   margin-bottom:1px;
}
ul {
   margin-bottom:1px;
}

-->
</style>
</head>
<body>

<p>This page was automatically generated by NetLogo 5.0.</p>

<p>The applet requires Java 5 or higher.
Java must be enabled in your browser settings.
Mac users must have Mac OS X 10.4 or higher.
Windows and Linux users may obtain the latest Java from
<a href="http://java.sun.com/getjava/download.html">Sun's Java site</a>.</p>

<p><hr>

<applet code="org.nlogo.lite.Applet"
        archive="NetLogoLite.jar"
        width="733" height="643">
  <param name="DefaultModel"
         value="formation_newton.nlogo">
  <param name="java_arguments"
         value="-Djnlp.packEnabled=true">
</applet>
</p>

<p>powered by
<a target="_blank" href="http://ccl.northwestern.edu/netlogo/">NetLogo</a></p>

<p>view/download model file:
<a href="formation_newton.nlogo">formation_newton.nlogo</a></p>
<h2>WHAT IS IT?</h2><p>This is our second physics-based model of a swarm, for the book entitled &ldquo;Physicomimetics: Physics-Based Swarm Intelligence.&rdquo;</p><h2>HOW IT WORKS</h2><p>Multiple particles use F = ma and a &ldquo;split Newtonian&rdquo; force law to self-organize into a triangular lattice or a square lattice. </p><h2>WHAT IS NEW</h2><p>As opposed to Hooke&rsquo;s law, this simulation uses a &ldquo;Newtonian&rdquo; force law that has been modified to include a repulsive component in addition to the normal gravitational attraction. It has also been generalized by allowing the force law to be 1/r^p as opposed to just 1/r^2. </p><p>In addition, the simulation model is extended to include square lattices by having two types of particles, as explained in Chapter 3 of the book.</p><p>Finally, notice that clustering of particles occurs in the simulation, whereas it did not when Hooke&rsquo;s law was used. Try lowering the GRAVITATIONAL_CONSTANT. You will notice that the clusters will exhibit a &ldquo;phase transition&rdquo; and fall apart suddenly. The book provides an elegant explanation for why this occurs, and shows that clustering depends on the values of the force parameters. The G PHASE TRANSITION monitor gives the approximate value of the gravitational constant where the phase transition occurs. Above this value, clustering occurs. Below this value, the clusters fall apart. </p><h2>HOW TO USE IT</h2><p>Click SETUP AGENTS to initialize the particles, and click MOVE AGENTS to have them move.</p><p>The CLEAR button will clear the graphics, which becomes handy when particles have their pens down (more on this below).</p><p>The NUMBER_OF_PARTICLES slider allows you to control the number of particles created at initialization. Changing this slider while the simulation is running will have no effect. You can change the number of particles while the simulation is running by using the ONE IS BORN and KILL ONE buttons. However, the ONE IS BORN and KILL ONE buttons do not change the number of initial particles when the simulation is restarted by clicking SETUP AGENTS.</p><p>The ONE IS BORN button creates a new particle.</p><p>The KILL ONE button randomly kills an existing particle.</p><p>There is also a TOGGLE FORMATION button that allows you to choose between square and triangular lattices. A monitor indicates whether the square or triangular lattice has been selected.</p><p>All other sliders will affect the simulation when it is running.</p><h2>THINGS TO NOTICE</h2><p>Particles are initialized in a random cluster in the middle of the graphics pane, and self-organize into a triangular lattice. The lattice is not perfect, but that is OK because we are interested in &ldquo;satisficing systems,&rdquo; as opposed to &ldquo;optimal systems.&rdquo;</p><p>The GRAVITATIONAL_CONSTANT controls the G parameter in the split Newtonian force law. The POWER controls the value of &ldquo;p&rdquo; in the generalized law. The DESIRED_SEPARATION is the desired distance between neighboring particles.</p><p>Again, FRICTION is enabled. This allows the system to stabilize.</p><p>This simulation serves to teach you about physics-based swarms, as well as the Conservation of Linear and Angular Momenta. This is covered in detail in Chapter 3 of the book.</p><p>The red dot in the simulation shows the center of mass of the system. If the Conservation of Linear Momentum holds in both the x- and y-dimensions, the red dot will not move. This simulation includes a monitor for the Angular Momentum and you will see that it does not change over time, if the system is closed.</p><p>This model allows you to add and remove particles. Removing particles allows you to test how robust the system is to particle failure. Adding particles allows you to see how scalable the system is, and illustrates just how nicely new particles are incorporated into the lattice. Adding and removing particles opens the system, and temporary changes in the momenta can occur during these events.</p><p>Although it doesn&rsquo;t look like the linear momentum is shown on the graph, this is because it is overdrawn by the angular momentum curve. If you slow the simulation down (with the speed slider) and add a particle, you will usually see all three curves.</p><h2>THINGS TO TRY</h2><p>See how the FRICTION changes behavior. Click SETUP AGENTS, lower the friction, and click MOVE AGENTS. What happens? </p><p>Similarly, change the GRAVITATIONAL_CONSTANT or the POWER.</p><p>Change the DESIRED_SEPARATION while the system is running. Try changing it slowly and then change it quickly. What happens?</p><p>Add and remove particles.</p><p>See how the G PHASE TRANSITION value is affected when you change the GRAVITATIONAL_CONSTANT, the POWER, and the FORCE_MAXIMUM.</p><p>In &ldquo;formation_hooke.nlogo&rdquo; we noted that unusual behavior can occur with certain parameter settings. Try similar settings with this simulation (which uses the split Newtonian force law). Do you see the same behavior? </p><h2>EXTENDING THE MODEL</h2><p>In this model, all particles have the same mass. What happens if particles have different masses? </p><p>What happens when you change the sensor view? </p><p>What other formations can you create by extending the code to include more types of particles?</p><p>Note, in order to change any NetLogo simulation, you must have the source code (i.e., &ldquo;formation_newton.nlogo&rdquo;) downloaded to your computer, as well as NetLogo itself. You can not change the code when you are running the simulation with your browser.</p><h2>NETLOGO FEATURES</h2><p>This simulation allows the user to create new particles and kill existing ones.</p><p>Killing a particle is accomplished via a call to the NetLogo procedure &ldquo;die.&rdquo;</p><p>To create a particle, the &ldquo;hatch&rdquo; command is used - this clones an existing particle and moves it away from the original. Also, the new particle has the &ldquo;pen down,&rdquo; which means that you will see the path that the particle takes. If the graphics pane becomes too busy, click on the CLEAR button.</p><h2>RELATED MODELS</h2><p>This is our second physics-based swarm simulation, which modifies the force law from Hooke&rsquo;s law to a generalized split Newtonian force law. </p><h2>CREDITS AND REFERENCES</h2><p>To see our implementation on seven simple robots:</p><p>Spears, W. M., Spears, D. F., Hamann, J., and Heil, R. (2004) Distributed, physics-based control of swarms of vehicles. Autonomous Robots, 17 (2-3).</p><p>For an explanation of the phase transition:</p><p>Gordon-Spears, D. F., and Spears, W. M. (2003) Analysis of a phase transition in a physics-based multiagent system. Lecture Notes in Computer Science, Volume 2699.</p><p>To see the first papers that outlined the work presented in this simulation:</p><p>Gordon, D. F., Spears, W. M., Sokolsky, O., and Lee, I. (1999) Distributed spatial control, global monitoring and steering of mobile physical agents. In Proceedings of IEEE International Conference on Information, Intelligence, and Systems.</p><p>Spears, W. M., and Gordon, D. F. (1999) Using Artificial Physics to control agents. In Proceedings of IEEE International Conference on Information, Intelligence, and Systems.</p><h2>HOW TO CITE</h2><p>If you mention this model in an academic publication, we ask that you include these citations for the model itself and for the NetLogo software:<br/>- Spears, W. M. and Spears, D. F. (eds.) Physicomimetics: Physics-Based Swarm Intelligence, Springer-Verlag, (2011).<br/>- Wilensky, U. (1999). NetLogo. <a href="http://ccl.northwestern.edu/netlogo/">http://ccl.northwestern.edu/netlogo/</a>. Center for Connected Learning and Computer-Based Modeling, Northwestern University, Evanston, IL.</p><h2>COPYRIGHT NOTICE</h2><p>Copyright 2011 William M. Spears. All rights reserved.</p><p>Permission to use, modify or redistribute this model is hereby granted, provided that both of the following requirements are followed:<br/>a) this copyright notice is included, and<br/>b) this model will not be redistributed for profit without permission from William M. Spears. Contact William M. Spears for appropriate licenses for redistribution for profit.</p><p><a href="http://www.swarmotics.com">http://www.swarmotics.com</a></p>

<h1>CODE</h1>
<pre><font color="#5a5a5a">; William M. Spears September 2011</font><font color="#000000">
</font><font color="#5a5a5a">; Triangular and Square Lattices Using the Split Newtonian Force Law</font><font color="#000000">
</font><font color="#5a5a5a">; For research and educational use only</font><font color="#000000">

</font><font color="#660096">breed</font><font color="#000000"> [particles particle]                              </font><font color="#5a5a5a">; Introduce the &quot;particle&quot; breed</font><font color="#000000">

</font><font color="#007f69">globals</font><font color="#000000"> [total_lmx total_lmy total_angular_mom G p FR D
         center_of_mass_x center_of_mass_y FMAX DeltaT
         square? square_button? Gt]

</font><font color="#007f69">turtles-own</font><font color="#000000"> [hood deltax deltay r F Fx Fy v vx vy dvx dvy mass view
             lmx lmy theta lever_arm_x lever_arm_y lever_arm_r angular_mom]

</font><font color="#007f69">to</font><font color="#000000"> setup
   </font><font color="#0000aa">clear-all</font><font color="#000000">                                            </font><font color="#5a5a5a">; Clear everything</font><font color="#000000">
                                                        </font><font color="#5a5a5a">; Create and initialize particles</font><font color="#000000">
   create-particles Number_of_Particles [setup-particles]
   </font><font color="#0000aa">set</font><font color="#000000"> square_button? </font><font color="#963700">false</font><font color="#000000">                             </font><font color="#5a5a5a">; Start with a triangular lattice</font><font color="#000000">
   update-info
                                                        </font><font color="#5a5a5a">; Computes center of mass and displays location</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> center_of_mass_x (</font><font color="#660096">sum</font><font color="#000000"> [</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> mass] </font><font color="#660096">of</font><font color="#000000"> particles) </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#660096">sum</font><font color="#000000"> [mass] </font><font color="#660096">of</font><font color="#000000"> particles)
   </font><font color="#0000aa">set</font><font color="#000000"> center_of_mass_y (</font><font color="#660096">sum</font><font color="#000000"> [</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> mass] </font><font color="#660096">of</font><font color="#000000"> particles) </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#660096">sum</font><font color="#000000"> [mass] </font><font color="#660096">of</font><font color="#000000"> particles)
   </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patch</font><font color="#000000"> (</font><font color="#660096">round</font><font color="#000000"> center_of_mass_x) (</font><font color="#660096">round</font><font color="#000000"> center_of_mass_y)
      [</font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">in-radius</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000">]]
   </font><font color="#0000aa">reset-ticks</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> run-and-monitor
   </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) [</font><font color="#0000aa">user-message</font><font color="#000000"> </font><font color="#963700">&quot;Please click HALT and then SETUP AGENTS first&quot;</font><font color="#000000"> </font><font color="#0000aa">stop</font><font color="#000000">]
   update-info
   </font><font color="#0000aa">ask</font><font color="#000000"> particles [ap-particles]
   </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> [move]
                                                        </font><font color="#5a5a5a">; Computes center of mass and displays location</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> center_of_mass_x (</font><font color="#660096">sum</font><font color="#000000"> [</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> mass] </font><font color="#660096">of</font><font color="#000000"> particles) </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#660096">sum</font><font color="#000000"> [mass] </font><font color="#660096">of</font><font color="#000000"> particles)
   </font><font color="#0000aa">set</font><font color="#000000"> center_of_mass_y (</font><font color="#660096">sum</font><font color="#000000"> [</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> mass] </font><font color="#660096">of</font><font color="#000000"> particles) </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#660096">sum</font><font color="#000000"> [mass] </font><font color="#660096">of</font><font color="#000000"> particles)
   </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patch</font><font color="#000000"> (</font><font color="#660096">round</font><font color="#000000"> center_of_mass_x) (</font><font color="#660096">round</font><font color="#000000"> center_of_mass_y)
      [</font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">in-radius</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000">]]

   </font><font color="#0000aa">set</font><font color="#000000"> total_lmx </font><font color="#660096">sum</font><font color="#000000"> [lmx] </font><font color="#660096">of</font><font color="#000000"> particles                 </font><font color="#5a5a5a">; Total linear momentum, x-component</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> total_lmy </font><font color="#660096">sum</font><font color="#000000"> [lmy] </font><font color="#660096">of</font><font color="#000000"> particles                 </font><font color="#5a5a5a">; Total linear momentum, y-component</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> total_angular_mom </font><font color="#660096">sum</font><font color="#000000"> [angular_mom] </font><font color="#660096">of</font><font color="#000000"> particles </font><font color="#5a5a5a">; Total angular momentum of objects</font><font color="#000000">
   </font><font color="#0000aa">tick</font><font color="#000000">
   do-plots
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> setup-particles                                      </font><font color="#5a5a5a">; Set up the particles</font><font color="#000000">
   </font><font color="#0000aa">setxy</font><font color="#000000"> (</font><font color="#660096">random-normal</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">20</font><font color="#000000">) 
         (</font><font color="#660096">random-normal</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">20</font><font color="#000000">)                           </font><font color="#5a5a5a">; Start in a cluster</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">heading</font><font color="#000000"> </font><font color="#660096">random</font><font color="#000000"> </font><font color="#963700">360</font><font color="#000000">                               </font><font color="#5a5a5a">; Everyone has a random heading</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> vx </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> vy </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> mass </font><font color="#963700">1</font><font color="#000000">                         </font><font color="#5a5a5a">; Start with no motion and mass = 1</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> </font><font color="#963700">&quot;circle&quot;</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000"> </font><font color="#963700">5</font><font color="#000000">
   </font><font color="#0000aa">ifelse</font><font color="#000000"> ((</font><font color="#660096">who</font><font color="#000000"> </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">) </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) 
      [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">white</font><font color="#000000">] 
      [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">yellow</font><font color="#000000">]                                </font><font color="#5a5a5a">; Different colors for square formations</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> theta </font><font color="#963700">0</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> ap-particles                                         </font><font color="#5a5a5a">; Run artificial physics</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> Fx </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> Fy </font><font color="#963700">0</font><font color="#000000">                                    </font><font color="#5a5a5a">; Initialize force components to zero</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> vx (</font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> FR) </font><font color="#660096">*</font><font color="#000000"> vx                                 </font><font color="#5a5a5a">; Slow down according to friction</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> vy (</font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> FR) </font><font color="#660096">*</font><font color="#000000"> vy 
   
   </font><font color="#0000aa">set</font><font color="#000000"> hood [</font><font color="#660096">who</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">other</font><font color="#000000"> particles                    </font><font color="#5a5a5a">; Get the IDs of your neighbors</font><font color="#000000">
   </font><font color="#0000aa">foreach</font><font color="#000000"> hood [         
      </font><font color="#0000aa">set</font><font color="#000000"> deltax (([</font><font color="#660096">xcor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> particle ?) </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000">) 
      </font><font color="#0000aa">set</font><font color="#000000"> deltay (([</font><font color="#660096">ycor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> particle ?) </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000">) 
      </font><font color="#0000aa">set</font><font color="#000000"> r </font><font color="#660096">sqrt</font><font color="#000000"> (deltax </font><font color="#660096">*</font><font color="#000000"> deltax </font><font color="#660096">+</font><font color="#000000"> deltay </font><font color="#660096">*</font><font color="#000000"> deltay)
      </font><font color="#0000aa">set</font><font color="#000000"> view </font><font color="#963700">1.5</font><font color="#000000">                                      </font><font color="#5a5a5a">; For triangular lattice </font><font color="#000000">
      </font><font color="#0000aa">if</font><font color="#000000"> (square?) [                                    </font><font color="#5a5a5a">; For square lattice</font><font color="#000000">
      </font><font color="#0000aa">ifelse</font><font color="#000000"> ((</font><font color="#660096">who</font><font color="#000000"> </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">) </font><font color="#660096">=</font><font color="#000000"> (? </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">)) 
         [</font><font color="#0000aa">set</font><font color="#000000"> view </font><font color="#963700">1.3</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> r (r </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#660096">sqrt</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">))]            </font><font color="#5a5a5a">; See Chapter 3 for details</font><font color="#000000">
         [</font><font color="#0000aa">set</font><font color="#000000"> view </font><font color="#963700">1.7</font><font color="#000000">]
      ]
    
      </font><font color="#0000aa">if</font><font color="#000000"> (r </font><font color="#660096">&lt;</font><font color="#000000"> view </font><font color="#660096">*</font><font color="#000000"> D) [                               </font><font color="#5a5a5a">; The generalized split Newtonian law</font><font color="#000000">
         </font><font color="#0000aa">set</font><font color="#000000"> F (G </font><font color="#660096">*</font><font color="#000000"> mass </font><font color="#660096">*</font><font color="#000000"> ([mass] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">turtle</font><font color="#000000"> ?) </font><font color="#660096">/</font><font color="#000000"> (r </font><font color="#660096">^</font><font color="#000000"> p)) 
         </font><font color="#0000aa">if</font><font color="#000000"> (F </font><font color="#660096">&gt;</font><font color="#000000"> FMAX) [</font><font color="#0000aa">set</font><font color="#000000"> F FMAX]                     </font><font color="#5a5a5a">; Bounds check on force magnitude</font><font color="#000000">
         </font><font color="#0000aa">ifelse</font><font color="#000000"> (r </font><font color="#660096">&gt;</font><font color="#000000"> D) 
            [</font><font color="#0000aa">set</font><font color="#000000"> Fx (Fx </font><font color="#660096">+</font><font color="#000000"> F </font><font color="#660096">*</font><font color="#000000"> (deltax </font><font color="#660096">/</font><font color="#000000"> r))             </font><font color="#5a5a5a">; Attractive force, x-component</font><font color="#000000">
             </font><font color="#0000aa">set</font><font color="#000000"> Fy (Fy </font><font color="#660096">+</font><font color="#000000"> F </font><font color="#660096">*</font><font color="#000000"> (deltay </font><font color="#660096">/</font><font color="#000000"> r))]            </font><font color="#5a5a5a">; Attractive force, y-component</font><font color="#000000">
            [</font><font color="#0000aa">set</font><font color="#000000"> Fx (Fx </font><font color="#660096">-</font><font color="#000000"> F </font><font color="#660096">*</font><font color="#000000"> (deltax </font><font color="#660096">/</font><font color="#000000"> r))             </font><font color="#5a5a5a">; Repulsive force, x-component</font><font color="#000000">
             </font><font color="#0000aa">set</font><font color="#000000"> Fy (Fy </font><font color="#660096">-</font><font color="#000000"> F </font><font color="#660096">*</font><font color="#000000"> (deltay </font><font color="#660096">/</font><font color="#000000"> r))]            </font><font color="#5a5a5a">; Repulsive force, y-component</font><font color="#000000">
      ]
   ]
   
   </font><font color="#0000aa">set</font><font color="#000000"> dvx DeltaT </font><font color="#660096">*</font><font color="#000000"> (Fx </font><font color="#660096">/</font><font color="#000000"> mass)
   </font><font color="#0000aa">set</font><font color="#000000"> dvy DeltaT </font><font color="#660096">*</font><font color="#000000"> (Fy </font><font color="#660096">/</font><font color="#000000"> mass)
   </font><font color="#0000aa">set</font><font color="#000000"> vx  (vx </font><font color="#660096">+</font><font color="#000000"> dvx)                                   </font><font color="#5a5a5a">; The x-component of velocity</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> vy  (vy </font><font color="#660096">+</font><font color="#000000"> dvy)                                   </font><font color="#5a5a5a">; The y-component of velocity</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> v </font><font color="#660096">sqrt</font><font color="#000000"> (vx </font><font color="#660096">*</font><font color="#000000"> vx </font><font color="#660096">+</font><font color="#000000"> vy </font><font color="#660096">*</font><font color="#000000"> vy)

   </font><font color="#0000aa">set</font><font color="#000000"> deltax DeltaT </font><font color="#660096">*</font><font color="#000000"> vx
   </font><font color="#0000aa">set</font><font color="#000000"> deltay DeltaT </font><font color="#660096">*</font><font color="#000000"> vy 
   </font><font color="#0000aa">if</font><font color="#000000"> ((deltax </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (deltay </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">)) 
      [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">heading</font><font color="#000000"> (</font><font color="#660096">atan</font><font color="#000000"> deltax deltay)] 
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> move                                                 </font><font color="#5a5a5a">; Move the turtle</font><font color="#000000">
   </font><font color="#0000aa">fd</font><font color="#000000"> (</font><font color="#660096">sqrt</font><font color="#000000"> (deltax </font><font color="#660096">*</font><font color="#000000"> deltax </font><font color="#660096">+</font><font color="#000000"> deltay </font><font color="#660096">*</font><font color="#000000"> deltay))

   </font><font color="#0000aa">set</font><font color="#000000"> lmx (mass </font><font color="#660096">*</font><font color="#000000"> vx)                                  </font><font color="#5a5a5a">; Linear momentum of the turtle</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> lmy (mass </font><font color="#660096">*</font><font color="#000000"> vy)
   
   </font><font color="#0000aa">set</font><font color="#000000"> lever_arm_x (</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> center_of_mass_x)
   </font><font color="#0000aa">set</font><font color="#000000"> lever_arm_y (</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> center_of_mass_y)
   </font><font color="#0000aa">set</font><font color="#000000"> lever_arm_r </font><font color="#660096">sqrt</font><font color="#000000"> (lever_arm_x </font><font color="#660096">*</font><font color="#000000"> lever_arm_x </font><font color="#660096">+</font><font color="#000000"> lever_arm_y </font><font color="#660096">*</font><font color="#000000"> lever_arm_y)
   </font><font color="#0000aa">if</font><font color="#000000"> (((vx </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (vy </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">)) </font><font color="#660096">and</font><font color="#000000"> ((lever_arm_x </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (lever_arm_y </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">)))
      [</font><font color="#0000aa">set</font><font color="#000000"> theta (</font><font color="#660096">atan</font><font color="#000000"> (mass </font><font color="#660096">*</font><font color="#000000"> vy) (mass </font><font color="#660096">*</font><font color="#000000"> vx)) </font><font color="#660096">-</font><font color="#000000"> (</font><font color="#660096">atan</font><font color="#000000"> lever_arm_y lever_arm_x)]
   </font><font color="#0000aa">set</font><font color="#000000"> angular_mom (lever_arm_r </font><font color="#660096">*</font><font color="#000000"> mass </font><font color="#660096">*</font><font color="#000000"> v </font><font color="#660096">*</font><font color="#000000"> (</font><font color="#660096">sin</font><font color="#000000"> theta)) </font><font color="#5a5a5a">; Angular momentum of the turtle</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> update-info                                          </font><font color="#5a5a5a">; Update information from the sliders </font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> G Gravitational_Constant
   </font><font color="#0000aa">set</font><font color="#000000"> p Power
   </font><font color="#0000aa">set</font><font color="#000000"> FMAX Force_Maximum
   </font><font color="#0000aa">set</font><font color="#000000"> FR Friction
   </font><font color="#0000aa">set</font><font color="#000000"> DeltaT Time_Step
   </font><font color="#0000aa">set</font><font color="#000000"> D Desired_Separation
   </font><font color="#0000aa">set</font><font color="#000000"> square? square_button?
   </font><font color="#0000aa">ifelse</font><font color="#000000"> square?                                       </font><font color="#5a5a5a">; G phase transition computation, for</font><font color="#000000">
      [</font><font color="#0000aa">set</font><font color="#000000"> Gt (FMAX </font><font color="#660096">*</font><font color="#000000"> (D </font><font color="#660096">^</font><font color="#000000"> p) </font><font color="#660096">/</font><font color="#000000"> ((</font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000">(</font><font color="#963700">2</font><font color="#000000">)) </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">))]   </font><font color="#5a5a5a">; square lattice, and for</font><font color="#000000">
      [</font><font color="#0000aa">set</font><font color="#000000"> Gt (FMAX </font><font color="#660096">*</font><font color="#000000"> (D </font><font color="#660096">^</font><font color="#000000"> p) </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000">(</font><font color="#963700">3</font><font color="#000000">)))]         </font><font color="#5a5a5a">; triangular lattice (see Chapter 3 for details)</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> do-plots
   </font><font color="#0000aa">set-current-plot</font><font color="#000000"> </font><font color="#963700">&quot;Linear and Angular Momenta&quot;</font><font color="#000000">        </font><font color="#5a5a5a">; Select the Momenta plot</font><font color="#000000">
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;Lmx&quot;</font><font color="#000000">                           </font><font color="#5a5a5a">; Select the Lmx pen</font><font color="#000000">
   </font><font color="#0000aa">plot</font><font color="#000000"> total_lmx                                       </font><font color="#5a5a5a">; Plot the linear momentum, x-component</font><font color="#000000">
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;Lmy&quot;</font><font color="#000000">                         
   </font><font color="#0000aa">plot</font><font color="#000000"> total_lmy                                       </font><font color="#5a5a5a">; Plot the linear momentum, y-component</font><font color="#000000">
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;Angular&quot;</font><font color="#000000">
   </font><font color="#0000aa">plot</font><font color="#000000"> total_angular_mom                               </font><font color="#5a5a5a">; Plot the angular momentum</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">; Kill a particle</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> one-dies
   </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">count</font><font color="#000000"> (particles </font><font color="#660096">with</font><font color="#000000"> [mass </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">]) </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) [         </font><font color="#5a5a5a">; Don't kill last particle</font><font color="#000000">
      </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">one-of</font><font color="#000000"> particles </font><font color="#660096">with</font><font color="#000000"> [mass </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">] [</font><font color="#0000aa">die</font><font color="#000000">]        </font><font color="#5a5a5a">; Ask one particle to die</font><font color="#000000">
      </font><font color="#0000aa">clear-drawing</font><font color="#000000">                                     </font><font color="#5a5a5a">; A little cleanup is required</font><font color="#000000">
   ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">; Create a new particle</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> one-is-born
   </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">count</font><font color="#000000"> (particles </font><font color="#660096">with</font><font color="#000000"> [mass </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">]) </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) [ 
      </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">one-of</font><font color="#000000"> particles </font><font color="#660096">with</font><font color="#000000"> [mass </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">]
         [</font><font color="#0000aa">hatch</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> deltax </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> deltay </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">pd</font><font color="#000000">         </font><font color="#5a5a5a">; Clone an existing particle</font><font color="#000000">
                   </font><font color="#0000aa">ifelse</font><font color="#000000"> ((</font><font color="#660096">who</font><font color="#000000"> </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">) </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) 
                     [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">white</font><font color="#000000">] 
                     [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">yellow</font><font color="#000000">]                 </font><font color="#5a5a5a">; Different colors for square formations</font><font color="#000000">
                   </font><font color="#0000aa">setxy</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> (</font><font color="#660096">random-normal</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> (D </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">)) 
                         </font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> (</font><font color="#660096">random-normal</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> (D </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">))]]
   ] 
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">; Toggle between triangular and square formations</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> toggle-formation
  </font><font color="#0000aa">if</font><font color="#000000"> (square_button? </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) [</font><font color="#0000aa">set</font><font color="#000000"> square_button? </font><font color="#660096">not</font><font color="#000000"> square_button?]
</font><font color="#007f69">end</font>
</pre>

</body>
</html>
