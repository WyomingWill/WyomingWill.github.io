<html>
<head>
<title>lopf</title>
<style type="text/css">
<!--
/*
    This style sheet is borrowed from the NetLogo User Manual.  However, some of the units were
    changed from em to px because Java's StyleSheet support is limited for relative units such as
    em and % (this will supposively improve with newer versions of the VM) - jrn 7/21/05
    BE VERY VERY CAREFUL when you alter this style sheet -- it's possible to put in
    innocent-looking things that work on some VM's but cause Java exceptions on other for example
    we were using "font-size: 125%" but it caused Java exceptions on Java 1.5 on Windows - ST
    8/25/05
*/
:link { color: rgb(110,0,110); }
:visited { color: rgb(110,0,110); }
body {
    margin-left: 5px;
    font-family: arial, sans-serif;
    background: white;
    font-size: 12pt
}
h1 {
    color: white;
    background: rgb(45,0,45);
    font-size: 18pt;
    margin-bottom: 4px;
    padding-left: 6px;
    padding-right: 6px;
    padding-top: 6px;
    padding-bottom: 6px;
}
h2 {
    margin-top: 15px;
    margin-left: 6px;
    margin-bottom: 4px;
    background: rgb(166,172,255);
    font-size: 15pt;
    padding-left: 6px;
    padding-right: 6px;
    padding-top: 6px;
    padding-bottom: 6px;
}
h3 {
    margin-top: 15px;
    margin-left: 13px;
    margin-bottom: 4px;
    background: rgb(175,175,175);
    font-size: 12pt;
    padding: 0.2em;
    padding-left: 6px;
    padding-right: 6px;
    padding-top: 6px;
    padding-bottom: 6px;
}
h4 {
    margin-top: 15px;
    margin-bottom: 5px;
    margin-left: 15px;
    font-size: 12pt;
}
h5 {
    margin-top: 15px;
    margin-left: 15px;
    font-size: 12pt;
}
h6 {
    margin-top: 15px;
    margin-left: 15px;
    font-size: 12pt;
}
p {
    margin-left: 15px;
    margin-bottom: 3px;
}
pre {
    margin-left: 13px;
    background: rgb(225,225,225);
    font-family: monospace;
    font-size: 12pt;
    padding-left: 10px;
    padding-right: 3px;
    padding-top: 7px;
    padding-bottom: 7px;
    margin-top:9px;
    margin-bottom:0px;
}
code {
    font-family: monospace;
    font-size: 12pt;
}
blockquote {
    border: solid;
    border-style: solid;
    border-width: thin;
    border-color: black;
    background: rgb(250,250,220);
    padding-top: 0px;
    padding-bottom: 7px;
    margin-top: 7px;
    margin-bottom:1px;
}
ol {
   margin-bottom:1px;
}
ul {
   margin-bottom:1px;
}

-->
</style>
</head>
<body>

<p>This page was automatically generated by NetLogo 5.0.</p>

<p>The applet requires Java 5 or higher.
Java must be enabled in your browser settings.
Mac users must have Mac OS X 10.4 or higher.
Windows and Linux users may obtain the latest Java from
<a href="http://java.sun.com/getjava/download.html">Sun's Java site</a>.</p>

<p><hr>

<applet code="org.nlogo.lite.Applet"
        archive="NetLogoLite.jar,array/array.jar"
        width="1178" height="636">
  <param name="DefaultModel"
         value="lopf.nlogo">
  <param name="java_arguments"
         value="-Djnlp.packEnabled=true">
</applet>
</p>

<p>powered by
<a target="_blank" href="http://ccl.northwestern.edu/netlogo/">NetLogo</a></p>

<p>view/download model file:
<a href="lopf.nlogo">lopf.nlogo</a></p>
<h2>WHAT IS IT?</h2><p>This program shows a group of robots creating five different deployments: Hexagonal, Square, Line, Star and Tree.</p><h2>HOW IT WORKS</h2><p>A group of robots, depicted as square of 7cm, moves through an arena of 2x2 m^2. Different deployment can be tested, so as different cohordination properties.<br/>The robot interact using two type of forces: the Artificial Physics and the force from Local Oriented Potential Fields (a potential field centered on each robot of the simulation and affecting its neighbors).</p><h2>HOW TO USE IT</h2><p>SETUP sets up the model according to the values indicated by all the sliders and the switch. GO is a forever button that executes the model continually. Press the Add robot button and click on the arena to add a robot in the selected point.</p><p>Basic Inputs:<br/>- Number_Of_Robots affects the initial set of robots.<br/>- Deployment decides which deployment the robots will assume.</p><p>Force Parameters:<br/>- G_Force represents the Gravitational constant of the Newton&rsquo;s Law of Universal Gravitation (used by the Artificial Physics paradigm)<br/>- LOPF_Force represents the force arising from the Local Oriented Potential Fields paradigm<br/>- R represents the radius of the Newton&rsquo;s Law of Universal Gravitation (used by the Artificial Physics paradigm)<br/>- Homing_Force affects the force attracting the robots to their home (either the center of the arena, the leader or the barycenter)</p><p>Coordination Flags:<br/>- Aggregation lets the aggregation behavior between the robots be not active (0) or active (1)<br/>- Dispersion lets the dispersion behavior between the robots be not active (0) or active (1)<br/>- Homing lets the dispersion behavior between the robots be not active (0) or active (1)</p><p>Deployment Properties:<br/>- Angle can be used to change the angle between the robots when they are deployed in the Star and the Tree deployment (while changing it, give time to the robots to re-assemble!)<br/>- Max_level corresponds to the maximum number of raws composing the Tree deployment (try to change its value to avoid robots getting stucked in local optima)<br/>- Noise_level affects the level of noise disturbing the movements of the robots<br/>- Halo shows the detection radius of the robots (represents the range of the proximity sensors)</p><p>This model has been constructed so that all changes in the sliders and switches will take effect in the model during execution. So, while the GO button is still down, you can change the values of the sliders and the switch, and you can see these changes immediately in the view.</p><h2>THINGS TO KNOW</h2><p>The Star and the Tree deployments make use of a routine assigning a level to each robot depending on their position (angle and distance) respect to the Leader. The Leader is the robot in black, and by definition is not affected by any force. Each level corresponds to a different color.</p><h2>THINGS TO TRY</h2><p>Study how different initial position of the robots affect the deployment. For instance, try to start with a certain number of robots and then add some others through the Add robots button while the simulation is running. Then, compare the perfomance when you use as initial position another deployment. For instance, wait for the robots to deploy as an hexagon and then call the star deployment. Which is the best way to start the deployment?</p><h2>HOW TO CITE</h2><p>If you mention this model in an academic publication, we ask that you include these citations for the model itself and for the NetLogo software:<br/>- Spears, W. M. and Spears, D. F. (eds.) Physics-based Swarm Intelligence: From Theory to Practice, Springer-Verlag, (2011).<br/>- Wilensky, U. (1999). NetLogo. <a href="http://ccl.northwestern.edu/netlogo/">http://ccl.northwestern.edu/netlogo/</a>. Center for Connected Learning and Computer-Based Modeling, Northwestern University, Evanston, IL.</p><h2>COPYRIGHT NOTICE</h2><p>Copyright 2011 Andrea Bravi. All rights reserved.</p><p>Permission to use, modify or redistribute this model is hereby granted, provided that both of the following requirements are followed:<br/>a) this copyright notice is included.<br/>b) this model will not be redistributed for profit without permission from Andrea Bravi. Contact Andrea Bravi for appropriate licenses for redistribution for profit.</p><p><a href="http://aix2.uottawa.ca/~abrav103/">http://aix2.uottawa.ca/~abrav103/</a></p>

<h1>CODE</h1>
<pre><font color="#5a5a5a">;;Dettagli sull'arena:</font><font color="#000000">
</font><font color="#5a5a5a">;;Le dimensioni sono di 2x2 m^2. Ogni patch rappresenta 1 cm. La grandezza della patch, per questioni</font><font color="#000000">
</font><font color="#5a5a5a">;;di visualizzazione, ï¿½ stata fissata a 3 pixel.Come time-step, si prende 1 secondo.</font><font color="#000000">

</font><font color="#5a5a5a">;;Initialization of the model</font><font color="#000000">
</font><font color="#007f69">extensions</font><font color="#000000"> [array]

</font><font color="#660096">breed</font><font color="#000000"> [scouts scout]

</font><font color="#007f69">globals</font><font color="#000000"> [
  GIR.radius    </font><font color="#5a5a5a">;;standard proximity sensors detection radius</font><font color="#000000">
  dt </font><font color="#5a5a5a">;;time variable</font><font color="#000000">
  previous_deployment </font><font color="#5a5a5a">;;used to update the simulation when the Deployment is changed</font><font color="#000000">
]

</font><font color="#007f69">turtles-own</font><font color="#000000"> [
  </font><font color="#5a5a5a">;; Hardware parameters</font><font color="#000000">
  IR.radius  </font><font color="#5a5a5a">;;proximity sensors detection radius</font><font color="#000000">
  Fmax  </font><font color="#5a5a5a">;;Needed to limit maximal acceleration</font><font color="#000000">
  Vmax  </font><font color="#5a5a5a">;;Needed to limit maximal velocity</font><font color="#000000">
  vel </font><font color="#5a5a5a">;;modulus of the velocity vector</font><font color="#000000">
  alpha </font><font color="#5a5a5a">;;phase of the velocity vector</font><font color="#000000">
  mass </font><font color="#5a5a5a">;;mass</font><font color="#000000">
  
  </font><font color="#5a5a5a">;; Force parameters</font><font color="#000000">
  epsilon  
  d
  c
  
  </font><font color="#5a5a5a">;; Other</font><font color="#000000">
  distanceX </font><font color="#5a5a5a">;;distance with the other robots - x axes</font><font color="#000000">
  distanceY </font><font color="#5a5a5a">;;distance with the other robots - y axes</font><font color="#000000">
  posX </font><font color="#5a5a5a">;;distance from the barycenter of the deployment (used in the Tree and the Star deployment) - x axes</font><font color="#000000">
  posY </font><font color="#5a5a5a">;;distance from the barycenter of the deployment (used in the Tree and the Star deployment) - y axes</font><font color="#000000">
  interArray </font><font color="#5a5a5a">;;array of booleans identifying whether there is or not an interaction with the ?-th robot</font><font color="#000000">
  interLevel </font><font color="#5a5a5a">;;containing the lower level of the neighbor robots</font><font color="#000000">
  force </font><font color="#5a5a5a">;;force</font><font color="#000000">
  deltaX </font><font color="#5a5a5a">;;distance of the next movement on the x axes</font><font color="#000000">
  deltaY </font><font color="#5a5a5a">;;distance of the next movement on the y axes</font><font color="#000000">
  interaction </font><font color="#5a5a5a">;;true if there is an interaction with another robot, false otherwise</font><font color="#000000">
  pLx </font><font color="#5a5a5a">;; relative position respect to the leader (0 if on the same x axes, 1 if at his right, -1 if at his left)</font><font color="#000000">
  pLy </font><font color="#5a5a5a">;; relative position respect to the leader (0 if on the same y axes, 1 if at his top, -1 if at his bottom)</font><font color="#000000">
  dL </font><font color="#5a5a5a">;; distance from the leader</font><font color="#000000">
  lvl </font><font color="#5a5a5a">;; Level of interaction, lvl=0 is the leader</font><font color="#000000">
  canChange </font><font color="#5a5a5a">;;flag used to allow the level change</font><font color="#000000">
]

</font><font color="#007f69">to</font><font color="#000000"> setup-global-variables
  </font><font color="#0000aa">set</font><font color="#000000"> GIR.radius </font><font color="#963700">8</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">3.5</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">3.5</font><font color="#000000">    </font><font color="#5a5a5a">;;setting it to 8 cm, plus two times half the dimension of a robot (3.5+3.5)</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> R </font><font color="#963700">6</font><font color="#000000"> 
  </font><font color="#0000aa">set</font><font color="#000000"> dT </font><font color="#963700">0.1</font><font color="#000000"> 
  </font><font color="#0000aa">set</font><font color="#000000"> previous_deployment Deployment 
  </font><font color="#0000aa">set</font><font color="#000000"> Angle </font><font color="#963700">0</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> G_force </font><font color="#963700">0.3</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> LOPF_force </font><font color="#963700">0.3</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> Homing_force </font><font color="#963700">0.3</font><font color="#000000">  
  </font><font color="#0000aa">set</font><font color="#000000"> Max_level </font><font color="#963700">3</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> Noise_level </font><font color="#963700">1</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> setup-scouts
  create-scouts Number_of_robots
</font><font color="#5a5a5a">;;  ask scouts [ setxy random-xcor / 2 + 50 random-ycor / 2 + 50 set color grey]</font><font color="#000000">
  </font><font color="#0000aa">ask</font><font color="#000000"> scouts [ </font><font color="#0000aa">setxy</font><font color="#000000"> </font><font color="#660096">random-xcor</font><font color="#000000"> </font><font color="#660096">random-ycor</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">grey</font><font color="#000000">]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> setup-turtles
</font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> [
  </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000"> </font><font color="#963700">9</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> IR.radius GIR.radius </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">random-normal</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#963700">0.5</font><font color="#000000"> </font><font color="#5a5a5a">;;the detection radius of each robot is changed adding a random term</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> epsilon G_Force
  </font><font color="#0000aa">set</font><font color="#000000"> r R
  </font><font color="#0000aa">set</font><font color="#000000"> pLx </font><font color="#963700">0</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> pLy </font><font color="#963700">0</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> dL </font><font color="#963700">0</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> mass </font><font color="#963700">0.05</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> Vmax </font><font color="#963700">12.5</font><font color="#000000"> </font><font color="#5a5a5a">;;maximum velocity [cm/s]</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> Fmax Vmax </font><font color="#660096">*</font><font color="#000000"> mass </font><font color="#660096">/</font><font color="#000000"> dT </font><font color="#5a5a5a">;;ï¿½ pari a 7 N</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> vel </font><font color="#963700">0</font><font color="#000000"> </font><font color="#5a5a5a">;;assuming robots start the simulation from a resting position</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> interaction </font><font color="#963700">FALSE</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> force </font><font color="#660096">array:from-list</font><font color="#000000"> </font><font color="#660096">n-values</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> [</font><font color="#963700">0</font><font color="#000000">]
  correct_angle </font><font color="#660096">random</font><font color="#000000"> </font><font color="#963700">180</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> lvl </font><font color="#963700">9</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> interLevel </font><font color="#963700">-1</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> canChange </font><font color="#963700">1</font><font color="#000000"> </font><font color="#5a5a5a">;;allowed to change</font><font color="#000000">
]
</font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtle</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">[
  </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#963700">100</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#963700">100</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> vel </font><font color="#963700">0</font><font color="#000000">
  </font><font color="#0000aa">if</font><font color="#000000"> Deployment </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">&quot;Hexagonal Lattice&quot;</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> Deployment </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">&quot;Square Lattice&quot;</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> Deployment </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">&quot;Line&quot;</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">40</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> lvl </font><font color="#963700">0</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#963700">125</font><font color="#000000">] </font><font color="#5a5a5a">;;creating the Leader for Tree and Star deployments</font><font color="#000000">
]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> setup-patches
  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000">  [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">33.1</font><font color="#000000">]
</font><font color="#007f69">end</font><font color="#000000">


</font><font color="#5a5a5a">;;Beginning the simulation</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> setup
  </font><font color="#0000aa">clear-all</font><font color="#000000">
  </font><font color="#0000aa">set-default-shape</font><font color="#000000"> scouts </font><font color="#963700">&quot;scout&quot;</font><font color="#000000">
  setup-global-variables
  setup-scouts  </font><font color="#5a5a5a">;;scouts setup</font><font color="#000000">
  setup-turtles  </font><font color="#5a5a5a">;;setup for all the types of robots (other robots than the scouts could be added in the future)</font><font color="#000000">
  setup-patches
  </font><font color="#0000aa">reset-ticks</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> go
  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">not</font><font color="#000000"> halo [</font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> [</font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">56</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">33.1</font><font color="#000000">]]]
  halo-movements
  force-effect
  </font><font color="#0000aa">if</font><font color="#000000"> Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Tree&quot;</font><font color="#000000"> [barycenter-computation]
  update-sliders-parameters
  </font><font color="#0000aa">tick</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">


</font><font color="#5a5a5a">;;Routine to compute the effect of the forces during the interactions between the robots (the effects of the LOPFs is computed in halo-movements)</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> force-effect 
  
  </font><font color="#5a5a5a">;;Variables needed to describe the interactions with the Leader</font><font color="#000000">
  </font><font color="#0000aa">let</font><font color="#000000"> L </font><font color="#963700">0</font><font color="#000000"> 
  </font><font color="#0000aa">let</font><font color="#000000"> Lx </font><font color="#963700">0</font><font color="#000000">
  </font><font color="#0000aa">let</font><font color="#000000"> Ly </font><font color="#963700">0</font><font color="#000000">
  </font><font color="#0000aa">let</font><font color="#000000"> bx </font><font color="#963700">0</font><font color="#000000">
  </font><font color="#0000aa">let</font><font color="#000000"> by </font><font color="#963700">0</font><font color="#000000">
  
  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000">  [</font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">66</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> bx </font><font color="#660096">pxcor</font><font color="#5a5a5a">;; barycenter coordinates</font><font color="#000000">
                                </font><font color="#0000aa">set</font><font color="#000000"> by </font><font color="#660096">pycor</font><font color="#000000">]] 
  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> [</font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">40</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> L </font><font color="#660096">who</font><font color="#000000">
                              </font><font color="#0000aa">set</font><font color="#000000"> Lx </font><font color="#660096">xcor</font><font color="#000000">
                              </font><font color="#0000aa">set</font><font color="#000000"> Ly </font><font color="#660096">ycor</font><font color="#000000">]]
  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000">[  
    </font><font color="#0000aa">set</font><font color="#000000"> canChange </font><font color="#963700">1</font><font color="#000000">
    </font><font color="#0000aa">ifelse</font><font color="#000000"> </font><font color="#660096">any?</font><font color="#000000"> </font><font color="#660096">other</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#660096">in-radius</font><font color="#000000"> IR.radius </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">40</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> lvl </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [</font><font color="#5a5a5a">;; the Leader (lvl=0) is not affected by the other robots</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> interaction </font><font color="#963700">TRUE</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> pLx leader_x-position </font><font color="#660096">xcor</font><font color="#000000"> Lx
      </font><font color="#0000aa">set</font><font color="#000000"> pLy leader_y-position </font><font color="#660096">ycor</font><font color="#000000"> Ly
      </font><font color="#0000aa">set</font><font color="#000000"> dL vecotr-abs (</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> Lx) (</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> Ly)
    
      </font><font color="#5a5a5a">;;needed to deal with the issue that Netlogo memorize the date from in-radius randomly, changing xcor and ycor</font><font color="#000000">
      </font><font color="#0000aa">let</font><font color="#000000"> temp [</font><font color="#660096">who</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">other</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#660096">in-radius</font><font color="#000000"> IR.radius
      </font><font color="#0000aa">set</font><font color="#000000"> distanceX temp
      </font><font color="#0000aa">set</font><font color="#000000"> distanceY temp
      </font><font color="#0000aa">set</font><font color="#000000"> posX temp
      </font><font color="#0000aa">set</font><font color="#000000"> posY temp
      </font><font color="#0000aa">let</font><font color="#000000"> levels temp
      </font><font color="#0000aa">set</font><font color="#000000"> interArray temp
      </font><font color="#0000aa">set</font><font color="#000000"> temp </font><font color="#660096">array:from-list</font><font color="#000000"> temp
      </font><font color="#0000aa">set</font><font color="#000000"> distanceX </font><font color="#660096">array:from-list</font><font color="#000000"> distanceX
      </font><font color="#0000aa">set</font><font color="#000000"> distanceY </font><font color="#660096">array:from-list</font><font color="#000000"> distanceY
      </font><font color="#0000aa">set</font><font color="#000000"> posX </font><font color="#660096">array:from-list</font><font color="#000000"> posX
      </font><font color="#0000aa">set</font><font color="#000000"> posY </font><font color="#660096">array:from-list</font><font color="#000000"> posY
      </font><font color="#0000aa">set</font><font color="#000000"> levels </font><font color="#660096">array:from-list</font><font color="#000000"> levels
      </font><font color="#0000aa">set</font><font color="#000000"> interArray </font><font color="#660096">array:from-list</font><font color="#000000"> interArray
      </font><font color="#0000aa">foreach</font><font color="#000000"> </font><font color="#660096">n-values</font><font color="#000000"> </font><font color="#660096">array:length</font><font color="#000000"> temp [?] [
        </font><font color="#0000aa">array:set</font><font color="#000000"> distanceX ? [</font><font color="#660096">xcor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">other</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">who</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> temp ?]
        </font><font color="#0000aa">array:set</font><font color="#000000"> distanceY ? [</font><font color="#660096">ycor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">other</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">who</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> temp ?]
        </font><font color="#0000aa">array:set</font><font color="#000000"> levels ? [lvl] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">other</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">who</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> temp ?]
      ]
      </font><font color="#0000aa">set</font><font color="#000000"> force </font><font color="#660096">array:from-list</font><font color="#000000"> </font><font color="#660096">n-values</font><font color="#000000"> </font><font color="#660096">array:length</font><font color="#000000"> distanceX [</font><font color="#963700">0</font><font color="#000000">]

      </font><font color="#5a5a5a">;; Takes from the array of the distances the ?-th value and insert it at the ?-th position in the array force the resultant force</font><font color="#000000">
      </font><font color="#0000aa">foreach</font><font color="#000000"> </font><font color="#660096">n-values</font><font color="#000000"> </font><font color="#660096">array:length</font><font color="#000000"> distanceX [?] [                      
           
           </font><font color="#0000aa">let</font><font color="#000000"> templvl (</font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> levels ?) </font><font color="#5a5a5a">;;storing the minimum level of the neighbor robot, if the level is not 9</font><font color="#000000">
           </font><font color="#0000aa">if</font><font color="#000000"> templvl </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">9</font><font color="#000000"> [</font><font color="#0000aa">if</font><font color="#000000"> interLevel </font><font color="#660096">&lt;</font><font color="#000000"> templvl [</font><font color="#0000aa">set</font><font color="#000000"> interLevel templvl]]
           
           </font><font color="#0000aa">let</font><font color="#000000"> check ((Lx </font><font color="#660096">=</font><font color="#000000"> </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> distanceX ?) </font><font color="#660096">and</font><font color="#000000"> (Ly </font><font color="#660096">=</font><font color="#000000"> </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> distanceY ?)) </font><font color="#5a5a5a">;; true when the interaction is with the Leader</font><font color="#000000">

           </font><font color="#0000aa">array:set</font><font color="#000000"> posX ? (</font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> distanceX ?) </font><font color="#660096">-</font><font color="#000000"> bx </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">random-normal</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> Noise_level</font><font color="#5a5a5a">;;the error from the odometer sensor and the positioning system is simulated adding noise</font><font color="#000000">
           </font><font color="#0000aa">array:set</font><font color="#000000"> posY ? (</font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> distanceY ?) </font><font color="#660096">-</font><font color="#000000"> by </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">random-normal</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> Noise_level 
            
           </font><font color="#0000aa">array:set</font><font color="#000000"> distanceX ? (</font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> distanceX ?) </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">random-normal</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> Noise_level </font><font color="#5a5a5a">;;adding noise to simulate the error in the IR sensors measurements</font><font color="#000000">
           </font><font color="#0000aa">array:set</font><font color="#000000"> distanceY ? (</font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> distanceY ?) </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">random-normal</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> Noise_level 

           </font><font color="#5a5a5a">;;Newtonian Law of Universal Gravitation </font><font color="#000000">
           </font><font color="#0000aa">array:set</font><font color="#000000"> force ? N-force (vecotr-abs </font><font color="#660096">array:item</font><font color="#000000"> distanceX ? </font><font color="#660096">array:item</font><font color="#000000"> distanceY ?) epsilon
           
           </font><font color="#0000aa">ifelse</font><font color="#000000"> (Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Star&quot;</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Tree&quot;</font><font color="#000000">) [             

               </font><font color="#5a5a5a">;;In the Star deployment, robots belonging to level n interact with robots of level n and n-1</font><font color="#000000">
               </font><font color="#0000aa">if</font><font color="#000000"> (Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Star&quot;</font><font color="#000000">) [ </font><font color="#0000aa">ifelse</font><font color="#000000"> (lvl </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> levels ? </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (lvl </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> levels ? </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) [</font><font color="#0000aa">array:set</font><font color="#000000"> interArray ? </font><font color="#963700">1</font><font color="#000000">]
                                                                                                                                  [</font><font color="#0000aa">array:set</font><font color="#000000"> interArray ? </font><font color="#963700">0</font><font color="#000000">]
                                          </font><font color="#0000aa">if</font><font color="#000000"> lvl </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">9</font><font color="#000000"> [</font><font color="#0000aa">ifelse</font><font color="#000000"> (lvl </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> levels ? </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) [</font><font color="#0000aa">array:set</font><font color="#000000"> force ? </font><font color="#963700">-1</font><font color="#000000"> </font><font color="#0000aa">array:set</font><font color="#000000"> interArray ? </font><font color="#963700">1</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> canChange </font><font color="#963700">0</font><font color="#000000">]                                                                       
                                                                                                    [</font><font color="#0000aa">array:set</font><font color="#000000"> force ? </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">array:set</font><font color="#000000"> interArray ? </font><font color="#963700">1</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> canChange </font><font color="#963700">1</font><font color="#000000">]]                                                                                        
                                                                                                                                  
                                                                                                                                  
                                        ]
               </font><font color="#5a5a5a">;;In the Tree deployment, robots belonging to level n interact with robots of level n-1 and are </font><font color="#000000">
               </font><font color="#0000aa">if</font><font color="#000000"> (Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Tree&quot;</font><font color="#000000">) [ </font><font color="#0000aa">ifelse</font><font color="#000000"> (lvl </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> levels ? </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) [</font><font color="#0000aa">array:set</font><font color="#000000"> interArray ? </font><font color="#963700">1</font><font color="#000000">]
                                                                                         [</font><font color="#0000aa">array:set</font><font color="#000000"> interArray ? </font><font color="#963700">0</font><font color="#000000">]
                                          </font><font color="#0000aa">if</font><font color="#000000"> (lvl </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> levels ? </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) [</font><font color="#0000aa">array:set</font><font color="#000000"> force ? </font><font color="#963700">-1</font><font color="#000000"> </font><font color="#0000aa">array:set</font><font color="#000000"> interArray ? </font><font color="#963700">1</font><font color="#000000">]
                                          </font><font color="#0000aa">if</font><font color="#000000"> lvl </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">9</font><font color="#000000"> [</font><font color="#0000aa">ifelse</font><font color="#000000"> (lvl </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> levels ? </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (Max_level </font><font color="#660096">=</font><font color="#000000"> </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> levels ?)  [</font><font color="#0000aa">array:set</font><font color="#000000"> force ? </font><font color="#963700">-1</font><font color="#000000"> </font><font color="#0000aa">array:set</font><font color="#000000"> interArray ? </font><font color="#963700">1</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> canChange </font><font color="#963700">0</font><font color="#000000">]                                                                       
                                                                                                                                               [</font><font color="#0000aa">array:set</font><font color="#000000"> force ? </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">array:set</font><font color="#000000"> interArray ? </font><font color="#963700">1</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> canChange </font><font color="#963700">1</font><font color="#000000">]]

                                        ]

               </font><font color="#5a5a5a">;;Robots belonging to level 9 get repulsed from other robots belonging to lvl 9,</font><font color="#000000">
               </font><font color="#5a5a5a">;;and suffer only of the LOPF when interacting with robots of other levels (no Newtonian interactions)</font><font color="#000000">
               </font><font color="#5a5a5a">;;The variable canChange is used so that a robot can change level only when it interacts with robots of another level</font><font color="#000000">

           ][</font><font color="#0000aa">array:set</font><font color="#000000"> interArray ? </font><font color="#963700">1</font><font color="#000000">]
                                                                                                                            
      ]
    ]
    [</font><font color="#0000aa">set</font><font color="#000000"> interaction </font><font color="#963700">FALSE</font><font color="#000000">
        </font><font color="#0000aa">foreach</font><font color="#000000"> </font><font color="#660096">n-values</font><font color="#000000"> </font><font color="#660096">array:length</font><font color="#000000"> force [?] [  
        </font><font color="#0000aa">array:set</font><font color="#000000"> force ? </font><font color="#963700">0</font><font color="#000000">
        ]
      </font><font color="#0000aa">set</font><font color="#000000"> distanceX []
      </font><font color="#0000aa">set</font><font color="#000000"> distanceY []
    ]
]    
</font><font color="#007f69">end</font><font color="#000000">

  

</font><font color="#007f69">to</font><font color="#000000"> halo-movements
 </font><font color="#0000aa">let</font><font color="#000000"> L </font><font color="#963700">0</font><font color="#000000"> </font><font color="#5a5a5a">;;needed for the interactions with the Leader</font><font color="#000000">
 </font><font color="#0000aa">let</font><font color="#000000"> Lx </font><font color="#963700">0</font><font color="#000000">
 </font><font color="#0000aa">let</font><font color="#000000"> Ly </font><font color="#963700">0</font><font color="#000000">
 </font><font color="#0000aa">let</font><font color="#000000"> bx </font><font color="#963700">0</font><font color="#000000"> </font><font color="#5a5a5a">;;barycenter coordinates</font><font color="#000000">
 </font><font color="#0000aa">let</font><font color="#000000"> by </font><font color="#963700">0</font><font color="#000000">
 </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000">  [</font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">66</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> bx </font><font color="#660096">pxcor</font><font color="#000000">
                               </font><font color="#0000aa">set</font><font color="#000000"> by </font><font color="#660096">pycor</font><font color="#000000">]] 
 </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> [</font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">40</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> L </font><font color="#660096">who</font><font color="#000000">
                             </font><font color="#0000aa">set</font><font color="#000000"> Lx </font><font color="#660096">xcor</font><font color="#000000">
                             </font><font color="#0000aa">set</font><font color="#000000"> Ly </font><font color="#660096">ycor</font><font color="#000000">]]
  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000">[</font><font color="#5a5a5a">;;the halo is destroyed</font><font color="#000000">
              </font><font color="#0000aa">if</font><font color="#000000"> halo [</font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">in-radius</font><font color="#000000"> IR.radius [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">33.1</font><font color="#000000">]]                                        
              
              </font><font color="#5a5a5a">;;if there is an interaction</font><font color="#000000">
              </font><font color="#0000aa">ifelse</font><font color="#000000"> interaction [

              </font><font color="#5a5a5a">;;changing the levels</font><font color="#000000">
              </font><font color="#0000aa">if</font><font color="#000000"> canChange </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> [</font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">40</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> lvl change-level </font><font color="#660096">atan</font><font color="#000000"> (Ly </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000">) (Lx </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000">) pLx pLy dL]] </font><font color="#5a5a5a">;; the Leader never changes</font><font color="#000000">
              
                   </font><font color="#0000aa">foreach</font><font color="#000000"> </font><font color="#660096">n-values</font><font color="#000000"> </font><font color="#660096">array:length</font><font color="#000000"> force [?] [
                      </font><font color="#0000aa">let</font><font color="#000000"> Tv </font><font color="#660096">array:item</font><font color="#000000"> force ? </font><font color="#5a5a5a">;;utility variable</font><font color="#000000">
                      </font><font color="#5a5a5a">;;implementing the effect of the forces</font><font color="#000000">
                          </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000">(Tv) </font><font color="#660096">&gt;</font><font color="#000000"> Fmax [</font><font color="#0000aa">set</font><font color="#000000"> Tv Fmax </font><font color="#660096">*</font><font color="#000000"> Tv </font><font color="#660096">/</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000">(Tv)] </font><font color="#5a5a5a">;;setting to Fmax, keeping the sign</font><font color="#000000">
                          </font><font color="#0000aa">set</font><font color="#000000"> vel friction vel
                          </font><font color="#0000aa">let</font><font color="#000000"> vx vel </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">cos</font><font color="#000000">(alpha)
                          </font><font color="#0000aa">let</font><font color="#000000"> vy vel </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">sin</font><font color="#000000">(alpha)
                          </font><font color="#5a5a5a">;;initialization</font><font color="#000000">
                          </font><font color="#0000aa">let</font><font color="#000000"> dvx </font><font color="#963700">0</font><font color="#000000">
                          </font><font color="#0000aa">let</font><font color="#000000"> dvy </font><font color="#963700">0</font><font color="#000000">
                          </font><font color="#0000aa">let</font><font color="#000000"> fvx </font><font color="#963700">0</font><font color="#000000">
                          </font><font color="#0000aa">let</font><font color="#000000"> fvy </font><font color="#963700">0</font><font color="#000000">                    
           
                          </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> interArray ? </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> [
                            </font><font color="#0000aa">if</font><font color="#000000"> Deployment </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">&quot;Tree&quot;</font><font color="#000000">  </font><font color="#660096">and</font><font color="#000000"> Deployment </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">&quot;Star&quot;</font><font color="#000000"> [ 
                              </font><font color="#0000aa">set</font><font color="#000000"> dvx Tv </font><font color="#660096">*</font><font color="#000000"> dT </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">cos</font><font color="#000000">(</font><font color="#660096">atan</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> distanceY ? </font><font color="#660096">array:item</font><font color="#000000"> distanceX ?) </font><font color="#660096">/</font><font color="#000000"> mass
                              </font><font color="#0000aa">set</font><font color="#000000"> dvy Tv </font><font color="#660096">*</font><font color="#000000"> dT </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">sin</font><font color="#000000">(</font><font color="#660096">atan</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> distanceY ? </font><font color="#660096">array:item</font><font color="#000000"> distanceX ?) </font><font color="#660096">/</font><font color="#000000"> mass
                              </font><font color="#0000aa">set</font><font color="#000000"> fvx latticex dvx </font><font color="#660096">atan</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> distanceY ? </font><font color="#660096">array:item</font><font color="#000000"> distanceX ? </font><font color="#5a5a5a">;; Adding the effect of the LOPF</font><font color="#000000">
                              </font><font color="#0000aa">set</font><font color="#000000"> fvy latticey dvy </font><font color="#660096">atan</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> distanceY ? </font><font color="#660096">array:item</font><font color="#000000"> distanceX ?] </font><font color="#5a5a5a">;; Adding the effect of the LOPF</font><font color="#000000">

                            </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> interArray ? </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> Deployment </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">&quot;Hexagonal Lattice&quot;</font><font color="#000000">  </font><font color="#660096">and</font><font color="#000000"> Deployment </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">&quot;Square Lattice&quot;</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> Deployment </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">&quot;Line&quot;</font><font color="#000000">[
                              </font><font color="#0000aa">set</font><font color="#000000"> dvx Tv </font><font color="#660096">*</font><font color="#000000"> dT </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">cos</font><font color="#000000">(</font><font color="#660096">atan</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> distanceY ? </font><font color="#660096">array:item</font><font color="#000000"> distanceX ?) </font><font color="#660096">/</font><font color="#000000"> mass
                              </font><font color="#0000aa">set</font><font color="#000000"> dvy Tv </font><font color="#660096">*</font><font color="#000000"> dT </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">sin</font><font color="#000000">(</font><font color="#660096">atan</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> distanceY ? </font><font color="#660096">array:item</font><font color="#000000"> distanceX ?) </font><font color="#660096">/</font><font color="#000000"> mass
                              </font><font color="#0000aa">set</font><font color="#000000"> fvx Deploymentx </font><font color="#660096">atan</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> distanceY ? </font><font color="#660096">array:item</font><font color="#000000"> distanceX ? pLx pLy dL </font><font color="#660096">array:item</font><font color="#000000"> posX ? </font><font color="#660096">array:item</font><font color="#000000"> posY ? </font><font color="#5a5a5a">;; Adding the effect of the LOPF</font><font color="#000000">
                              </font><font color="#0000aa">set</font><font color="#000000"> fvy Deploymenty </font><font color="#660096">atan</font><font color="#000000"> </font><font color="#660096">array:item</font><font color="#000000"> distanceY ? </font><font color="#660096">array:item</font><font color="#000000"> distanceX ? pLx pLy dL </font><font color="#660096">array:item</font><font color="#000000"> posX ? </font><font color="#660096">array:item</font><font color="#000000"> posY ?] </font><font color="#5a5a5a">;; Adding the effect of the LOPF</font><font color="#000000">
                             ] 
                                    
                          </font><font color="#0000aa">let</font><font color="#000000"> fhx </font><font color="#963700">0</font><font color="#000000">
                          </font><font color="#0000aa">let</font><font color="#000000"> fhy </font><font color="#963700">0</font><font color="#000000">
                          
                          </font><font color="#0000aa">if</font><font color="#000000"> Homing </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000">  Deployment </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">&quot;Star&quot;</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000">  Deployment </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">&quot;Tree&quot;</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> lvl </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">9</font><font color="#000000">[
                             </font><font color="#0000aa">set</font><font color="#000000"> fhx (</font><font color="#963700">100</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">0.0001</font><font color="#000000">) </font><font color="#660096">*</font><font color="#000000"> Homing_Force </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">100</font><font color="#000000"> </font><font color="#5a5a5a">;;0.0001 is used to avoid dividing for 0 when computing the force on the leader</font><font color="#000000">
                             </font><font color="#0000aa">set</font><font color="#000000"> fhy (</font><font color="#963700">100</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">0.0001</font><font color="#000000">) </font><font color="#660096">*</font><font color="#000000"> Homing_Force </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">100</font><font color="#000000">]                           
                          
                          </font><font color="#0000aa">if</font><font color="#000000"> Homing </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000">  Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Star&quot;</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> lvl </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">9</font><font color="#000000">[
                             </font><font color="#0000aa">set</font><font color="#000000"> fhx (Lx </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">0.0001</font><font color="#000000">) </font><font color="#660096">*</font><font color="#000000"> Homing_Force </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">100</font><font color="#000000"> </font><font color="#5a5a5a">;;0.0001 is used to avoid dividing for 0 when computing the force on the leader</font><font color="#000000">
                             </font><font color="#0000aa">set</font><font color="#000000"> fhy (Lx </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">0.0001</font><font color="#000000">) </font><font color="#660096">*</font><font color="#000000"> Homing_Force </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">100</font><font color="#000000">] 

                          </font><font color="#5a5a5a">;;in the case of Tree or Star pattern the robots are attracted to the barycenter of the formation (the leader is the only one not affected)</font><font color="#000000">
                          </font><font color="#0000aa">if</font><font color="#000000"> Homing </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000">  Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Tree&quot;</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> lvl </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">9</font><font color="#000000"> [ 
                             </font><font color="#0000aa">set</font><font color="#000000"> fhx (bx </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">0.0001</font><font color="#000000">) </font><font color="#660096">*</font><font color="#000000"> Homing_Force </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">100</font><font color="#000000">
                             </font><font color="#0000aa">set</font><font color="#000000"> fhy (by </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">0.0001</font><font color="#000000">) </font><font color="#660096">*</font><font color="#000000"> Homing_Force </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">100</font><font color="#000000">]                 
                          </font><font color="#0000aa">set</font><font color="#000000"> vx vx </font><font color="#660096">+</font><font color="#000000"> dvx </font><font color="#660096">+</font><font color="#000000"> fvx </font><font color="#660096">+</font><font color="#000000"> fhx
                          </font><font color="#0000aa">set</font><font color="#000000"> vy vy </font><font color="#660096">+</font><font color="#000000"> dvy </font><font color="#660096">+</font><font color="#000000"> fvy </font><font color="#660096">+</font><font color="#000000"> fhy
                          </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000">(vx) </font><font color="#660096">&gt;</font><font color="#000000"> Vmax [</font><font color="#0000aa">set</font><font color="#000000"> vx Vmax </font><font color="#660096">*</font><font color="#000000"> vx </font><font color="#660096">/</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000">(vx)]
                          </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000">(vy) </font><font color="#660096">&gt;</font><font color="#000000"> Vmax [</font><font color="#0000aa">set</font><font color="#000000"> vy Vmax </font><font color="#660096">*</font><font color="#000000"> vy </font><font color="#660096">/</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000">(vy)] 
                          </font><font color="#0000aa">if</font><font color="#000000"> vx </font><font color="#660096">+</font><font color="#000000"> vy </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [
                            correct_angle </font><font color="#660096">atan</font><font color="#000000"> vy vx]             
                                                             
                          </font><font color="#0000aa">set</font><font color="#000000"> vel vecotr-abs vx vy </font><font color="#5a5a5a">;;new absolute value of the velocity</font><font color="#000000">
                          </font><font color="#0000aa">let</font><font color="#000000"> spostamentox vx </font><font color="#660096">*</font><font color="#000000"> dT
                          </font><font color="#0000aa">let</font><font color="#000000"> spostamentoy vy </font><font color="#660096">*</font><font color="#000000"> dT
                          </font><font color="#0000aa">setxy</font><font color="#000000"> (</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> spostamentox) (</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> spostamentoy)
                     ]
              ] </font><font color="#5a5a5a">;;If no interaction: (there is no friction, so the robots can keep moving)</font><font color="#000000">
              [</font><font color="#0000aa">let</font><font color="#000000"> fhx </font><font color="#963700">0</font><font color="#000000">
               </font><font color="#0000aa">let</font><font color="#000000"> fhy </font><font color="#963700">0</font><font color="#000000">               
               </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">who</font><font color="#000000"> </font><font color="#660096">!=</font><font color="#000000"> L [</font><font color="#0000aa">set</font><font color="#000000"> lvl </font><font color="#963700">9</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">grey</font><font color="#000000">]               
               </font><font color="#0000aa">set</font><font color="#000000"> interArray </font><font color="#963700">0</font><font color="#000000">
               </font><font color="#0000aa">if</font><font color="#000000"> Homing </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000">  Deployment </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">&quot;Star&quot;</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000">  Deployment </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">&quot;Tree&quot;</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> lvl </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">9</font><font color="#000000">[
                             </font><font color="#0000aa">set</font><font color="#000000"> fhx (</font><font color="#963700">100</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">0.0001</font><font color="#000000">) </font><font color="#660096">*</font><font color="#000000"> Homing_Force </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">100</font><font color="#000000"> </font><font color="#5a5a5a">;;0.0001 is used to avoid dividing for 0 when computing the force on the leader</font><font color="#000000">
                             </font><font color="#0000aa">set</font><font color="#000000"> fhy (</font><font color="#963700">100</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">0.0001</font><font color="#000000">) </font><font color="#660096">*</font><font color="#000000"> Homing_Force </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">100</font><font color="#000000">]            
               </font><font color="#0000aa">if</font><font color="#000000"> Homing </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Star&quot;</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> lvl </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">9</font><font color="#000000">[
                             </font><font color="#0000aa">set</font><font color="#000000"> fhx (Lx </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">0.0001</font><font color="#000000">) </font><font color="#660096">*</font><font color="#000000"> Homing_Force </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">100</font><font color="#000000">
                             </font><font color="#0000aa">set</font><font color="#000000"> fhy (Ly </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">0.0001</font><font color="#000000">) </font><font color="#660096">*</font><font color="#000000"> Homing_Force </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">100</font><font color="#000000">] 
               </font><font color="#0000aa">if</font><font color="#000000"> Homing </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000">  Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Tree&quot;</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> lvl </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">9</font><font color="#000000">[ 
                             </font><font color="#0000aa">set</font><font color="#000000"> fhx (bx </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">0.0001</font><font color="#000000">) </font><font color="#660096">*</font><font color="#000000"> Homing_Force </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">100</font><font color="#000000"> </font><font color="#5a5a5a">;;the robots are attracted toward the barycenter</font><font color="#000000">
                             </font><font color="#0000aa">set</font><font color="#000000"> fhy (by </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">0.0001</font><font color="#000000">) </font><font color="#660096">*</font><font color="#000000"> Homing_Force </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">100</font><font color="#000000">
                             </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">grey</font><font color="#000000">  </font><font color="#5a5a5a">;; the robots that are not interacting join level 9</font><font color="#000000">
                            </font><font color="#5a5a5a">; set lvl 9</font><font color="#000000">
                             ]                                                                                                                     
               </font><font color="#5a5a5a">;;if random 100 &gt;= 99 [ ;;si ha una probabilitï¿½ del 1% di spostarsi in una direzione a caso ripartendo con una certa velocitï¿½           </font><font color="#000000">
                 </font><font color="#5a5a5a">;;correct_angle random 360]</font><font color="#000000">
               </font><font color="#0000aa">let</font><font color="#000000"> vx vel </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">cos</font><font color="#000000">(alpha) </font><font color="#660096">+</font><font color="#000000"> fhx 
               </font><font color="#0000aa">let</font><font color="#000000"> vy vel </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">sin</font><font color="#000000">(alpha) </font><font color="#660096">+</font><font color="#000000"> fhy
               </font><font color="#0000aa">if</font><font color="#000000"> vx </font><font color="#660096">+</font><font color="#000000"> vy </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [
                correct_angle </font><font color="#660096">atan</font><font color="#000000"> vy vx]
               </font><font color="#0000aa">set</font><font color="#000000"> vel vecotr-abs vx vy </font><font color="#5a5a5a">;;new absolute value of the velocity       </font><font color="#000000">
               </font><font color="#0000aa">let</font><font color="#000000"> spostamentox vx </font><font color="#660096">*</font><font color="#000000"> dT
               </font><font color="#0000aa">let</font><font color="#000000"> spostamentoy vy </font><font color="#660096">*</font><font color="#000000"> dT
               </font><font color="#0000aa">setxy</font><font color="#000000"> (</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> spostamentox) (</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> spostamentoy)
               
              ]
                          
              </font><font color="#5a5a5a">;;creating the halo</font><font color="#000000">
              </font><font color="#0000aa">if</font><font color="#000000"> halo [
                 </font><font color="#0000aa">let</font><font color="#000000"> tx </font><font color="#660096">xcor</font><font color="#000000">
                 </font><font color="#0000aa">let</font><font color="#000000"> ty </font><font color="#660096">ycor</font><font color="#000000">
                 </font><font color="#0000aa">let</font><font color="#000000"> I IR.radius
                 </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">in-radius</font><font color="#000000"> IR.radius [
                   </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">distancexy</font><font color="#000000"> tx ty </font><font color="#660096">&gt;</font><font color="#000000"> (I </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">0.3</font><font color="#000000">) </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">distancexy</font><font color="#000000"> tx ty </font><font color="#660096">&lt;=</font><font color="#000000"> I [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">56</font><font color="#000000">]            
                 ]] 

  ]
</font><font color="#007f69">end</font><font color="#000000">
  
  
</font><font color="#007f69">to</font><font color="#000000"> update-sliders-parameters
</font><font color="#0000aa">let</font><font color="#000000"> bx </font><font color="#963700">0</font><font color="#000000">
</font><font color="#0000aa">let</font><font color="#000000"> by </font><font color="#963700">0</font><font color="#000000">
</font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000">  [</font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">66</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> bx </font><font color="#660096">pxcor</font><font color="#5a5a5a">;; barycenter coordinates</font><font color="#000000">
                              </font><font color="#0000aa">set</font><font color="#000000"> by </font><font color="#660096">pycor</font><font color="#000000">]] 
</font><font color="#0000aa">if</font><font color="#000000"> Homing </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> Deployment </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">&quot;Tree&quot;</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> Deployment </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">&quot;Star&quot;</font><font color="#000000"> [
    </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000">  [</font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">pxcor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">100</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">pycor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">100</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">plabel</font><font color="#000000"> </font><font color="#963700">&quot;home&quot;</font><font color="#000000">]]]
</font><font color="#0000aa">if</font><font color="#000000"> Homing </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [
    </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000">  [</font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">pxcor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">100</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">pycor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">100</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">plabel</font><font color="#000000"> </font><font color="#963700">&quot;&quot;</font><font color="#000000">]]]          

</font><font color="#0000aa">if</font><font color="#000000"> previous_deployment </font><font color="#660096">!=</font><font color="#000000"> Deployment[  
  </font><font color="#0000aa">set</font><font color="#000000"> previous_deployment Deployment
  </font><font color="#0000aa">set</font><font color="#000000"> Angle </font><font color="#963700">0</font><font color="#000000">

  </font><font color="#0000aa">if</font><font color="#000000"> Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Tree&quot;</font><font color="#000000"> </font><font color="#660096">or</font><font color="#000000"> Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Star&quot;</font><font color="#000000"> [</font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">grey</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> lvl </font><font color="#963700">9</font><font color="#000000">] 
    </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtle</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">40</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> lvl </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> vel </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> interaction </font><font color="#963700">False</font><font color="#000000">]
    </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000">  [</font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">pxcor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">100</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">pycor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">100</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">plabel</font><font color="#000000"> </font><font color="#963700">&quot;&quot;</font><font color="#000000">]]
    ]
    
  </font><font color="#0000aa">if</font><font color="#000000"> Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Hexagonal Lattice&quot;</font><font color="#000000"> </font><font color="#660096">or</font><font color="#000000"> Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Square Lattice&quot;</font><font color="#000000"> </font><font color="#660096">or</font><font color="#000000">  Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Line&quot;</font><font color="#000000">  [</font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">grey</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> lvl </font><font color="#963700">9</font><font color="#000000">  ]    
    ]
  
  
  ]
                                                                                            
</font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> [
  </font><font color="#0000aa">set</font><font color="#000000"> epsilon G_Force
  ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> correct_angle[ang] </font><font color="#5a5a5a">;; correctin the angle for used the reference system</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> alpha ang
  </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">heading</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> ang
</font><font color="#007f69">end</font><font color="#000000">
  
</font><font color="#007f69">to-report</font><font color="#000000"> friction[fv]  </font><font color="#5a5a5a">;;reducing the speed because of the friction</font><font color="#000000">
</font><font color="#0000aa">ifelse</font><font color="#000000"> (fv </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000">(fv) </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">1.5</font><font color="#000000">)[
   </font><font color="#0000aa">report</font><font color="#000000"> fv </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">1.5</font><font color="#000000">
]
[</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">;;Local Oriented Potential Field effect</font><font color="#000000">
</font><font color="#007f69">to-report</font><font color="#000000"> latticex[ax a]
</font><font color="#0000aa">if</font><font color="#000000"> Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Hexagonal Lattice&quot;</font><font color="#000000"> [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">]

</font><font color="#0000aa">if</font><font color="#000000"> Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Square Lattice&quot;</font><font color="#000000"> [</font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000">(((a </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">45</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">22.5</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">22.5</font><font color="#000000">)) </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">0.9</font><font color="#000000"> [ </font><font color="#5a5a5a">;;this condition is needed to avoid robots getting stuck in the middle of two different ares of the LOPF</font><font color="#000000">
          </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">45</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">270</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">315</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">-6</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force] </font><font color="#5a5a5a">;;per LOPF_Force=0.64 si passa dalla formazione esagonale a quella quadrata con facilitï¿½, altrimenti LOPF_Force=0.51 ï¿½ sufficiente (ed ha pure la proprietï¿½ di mantenere il sistema stabile)</font><font color="#000000">
          </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">135</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">225</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">270</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">6</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]] </font><font color="#5a5a5a">;;un'idea potrebbe essere quella di fare partire LOPF_Force da 0.64 e farlo diminuire fino a 0.51 col frame_delay. Idem per G, che parte da 20 o 24, e diminuisce fino a 3.</font><font color="#000000">
          </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">] </font><font color="#5a5a5a">;;caso quadrato</font><font color="#000000">
          
</font><font color="#0000aa">if</font><font color="#000000"> Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Line&quot;</font><font color="#000000"> [</font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000">(((a </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">45</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">45</font><font color="#000000">)) </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">0.9</font><font color="#000000"> [ </font><font color="#5a5a5a">;;this condition is needed to avoid robots getting stuck in the middle of two different ares of the LOPF</font><font color="#000000">
          </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">270</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">360</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">-6</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]
          </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">270</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">6</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]]
          </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">]
</font><font color="#007f69">end</font><font color="#000000">
          
</font><font color="#5a5a5a">;;Local Oriented Potential Field effect</font><font color="#000000">
</font><font color="#007f69">to-report</font><font color="#000000"> Deploymentx[a p_x p_y d_ p2_x p2_y]
</font><font color="#0000aa">set</font><font color="#000000"> a (a </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">180</font><font color="#000000">) </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">360</font><font color="#000000"> </font><font color="#5a5a5a">;; adapting the angle to the used reference system</font><font color="#000000">

</font><font color="#0000aa">if</font><font color="#000000"> Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Tree&quot;</font><font color="#000000"> [
          </font><font color="#0000aa">if</font><font color="#000000"> p_x </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">[                   
              </font><font color="#0000aa">if</font><font color="#000000">  (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">180</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">-2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]    
              </font><font color="#0000aa">if</font><font color="#000000">  (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]]
          </font><font color="#0000aa">if</font><font color="#000000"> p_x </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">[                   
              </font><font color="#0000aa">if</font><font color="#000000">  (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">180</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]    
              </font><font color="#0000aa">if</font><font color="#000000">  (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]]
          </font><font color="#0000aa">if</font><font color="#000000"> p_x </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">-1</font><font color="#000000">[                   
              </font><font color="#0000aa">if</font><font color="#000000">  (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">180</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">-2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]    
              </font><font color="#0000aa">if</font><font color="#000000">  (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">-2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]]
          
          </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000">((((a </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">45</font><font color="#000000">) </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">45</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">45</font><font color="#000000">)) </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">0.95</font><font color="#000000">  [
              </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">225</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> Angle </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">270</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">315</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> Angle </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">360</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">-2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]
              </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">180</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">225</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> Angle) </font><font color="#660096">or</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">270</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">315</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> Angle) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]                              
      ]
          </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">]       

</font><font color="#0000aa">if</font><font color="#000000"> Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Star&quot;</font><font color="#000000"> [

          </font><font color="#0000aa">if</font><font color="#000000"> (dL </font><font color="#660096">/</font><font color="#000000"> (R </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000">)) </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">1.3</font><font color="#000000"> [
          </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000">((((a </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">30</font><font color="#000000">) </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">120</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">60</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">60</font><font color="#000000">)) </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">0.95</font><font color="#000000">  [
              </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">210</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">270</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">330</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">360</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">-2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]
              </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">210</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">270</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">330</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]]]
          </font><font color="#0000aa">if</font><font color="#000000"> (dL </font><font color="#660096">/</font><font color="#000000"> (R </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000">)) </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">1.3</font><font color="#000000">  [
             </font><font color="#0000aa">if</font><font color="#000000"> (p_x </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">-1</font><font color="#000000"> </font><font color="#660096">or</font><font color="#000000"> p_x </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">and</font><font color="#000000"> (p_y </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">-1</font><font color="#000000"> </font><font color="#660096">or</font><font color="#000000"> p_y </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) [ 
                  </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">30</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">210</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> Angle) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">cos</font><font color="#000000">(</font><font color="#963700">60</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> Angle) </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]
                  </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">210</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> Angle </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">360</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">30</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">-2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">cos</font><font color="#000000">(</font><font color="#963700">60</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> Angle) </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]]
              </font><font color="#0000aa">if</font><font color="#000000"> p_x </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> (p_y </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">-1</font><font color="#000000"> </font><font color="#660096">or</font><font color="#000000"> p_y </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) [ 
                  </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">150</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">330</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> Angle) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">cos</font><font color="#000000">(</font><font color="#963700">60</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> Angle) </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]
                  </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">150</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">330</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> Angle </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">360</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">-2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">cos</font><font color="#000000">(</font><font color="#963700">60</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> Angle) </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]]     
              </font><font color="#0000aa">if</font><font color="#000000"> p_y </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> [ 
                  </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">270</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">360</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">-2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]          
                  </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">270</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]]]
          </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">]          
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">;;Local Oriented Potential Field effect</font><font color="#000000">
</font><font color="#007f69">to-report</font><font color="#000000"> latticey[ay a]
</font><font color="#0000aa">if</font><font color="#000000"> Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Hexagonal Lattice&quot;</font><font color="#000000"> </font><font color="#660096">or</font><font color="#000000"> Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Line&quot;</font><font color="#000000"> [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">] </font><font color="#5a5a5a">;;caso esagonale</font><font color="#000000">

</font><font color="#0000aa">if</font><font color="#000000"> Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Square Lattice&quot;</font><font color="#000000"> [</font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000">(((a </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">45</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">22.5</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">22.5</font><font color="#000000">)) </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">0.9</font><font color="#000000"> [
          </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">45</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">135</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">180</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">-6</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]
          </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">180</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">225</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">315</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">360</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">6</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]]
          </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">] </font><font color="#5a5a5a">;;caso quadrato</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">;;Local Oriented Potential Field effect</font><font color="#000000">
</font><font color="#007f69">to-report</font><font color="#000000"> Deploymenty[a p_x p_y d_ p2_x p2_y]
</font><font color="#0000aa">set</font><font color="#000000"> a (a </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">180</font><font color="#000000">) </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">360</font><font color="#000000"> </font><font color="#5a5a5a">;; si ristabilisce la giusta prospettiva per il calcolo delle forze</font><font color="#000000">
</font><font color="#0000aa">if</font><font color="#000000"> Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Tree&quot;</font><font color="#000000"> [
          </font><font color="#0000aa">if</font><font color="#000000">  (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">180</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">-2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]    
          </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000">((((a </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">45</font><font color="#000000">) </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">45</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">45</font><font color="#000000">)) </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">0.95</font><font color="#000000">  [                        
              </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">180</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">225</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> Angle) </font><font color="#660096">or</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">315</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> Angle </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">360</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">-2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]
              </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">225</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> Angle </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">270</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">270</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">315</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> Angle) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]                                                                                     
             ]
          
          </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">]
    

</font><font color="#0000aa">if</font><font color="#000000"> Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Star&quot;</font><font color="#000000"> [
          </font><font color="#0000aa">if</font><font color="#000000"> (dL </font><font color="#660096">/</font><font color="#000000"> (R </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000">)) </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">1.3</font><font color="#000000">[
          </font><font color="#0000aa">if</font><font color="#000000"> p_x </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> p_y </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">-1</font><font color="#000000"> [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">-1</font><font color="#000000">]
              </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000">((((a </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">30</font><font color="#000000">) </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">120</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">60</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">60</font><font color="#000000">)) </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">0.95</font><font color="#000000"> [
                  </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">180</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">210</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">330</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">360</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">-2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]
                  </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">210</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">330</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">180</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]]]
          </font><font color="#0000aa">if</font><font color="#000000"> (dL </font><font color="#660096">/</font><font color="#000000"> (R </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000">)) </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">1.3</font><font color="#000000"> [
              </font><font color="#0000aa">if</font><font color="#000000"> p_x </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">-1</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> (p_y </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">-1</font><font color="#000000"> </font><font color="#660096">or</font><font color="#000000"> p_y </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) [ 
                  </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">30</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">210</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> Angle) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">-2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">sin</font><font color="#000000">(</font><font color="#963700">60</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> Angle) </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]
                  </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">210</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> Angle </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">360</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">30</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">sin</font><font color="#000000">(</font><font color="#963700">60</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> Angle) </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]]
              </font><font color="#0000aa">if</font><font color="#000000"> p_x </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> (p_y </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">-1</font><font color="#000000"> </font><font color="#660096">or</font><font color="#000000"> p_y </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) [ 
                  </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">150</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">330</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> Angle) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">sin</font><font color="#000000">(</font><font color="#963700">60</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> Angle) </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]
                  </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">150</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">330</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> Angle </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">360</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">-2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">sin</font><font color="#000000">(</font><font color="#963700">60</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> Angle) </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]]
              </font><font color="#0000aa">if</font><font color="#000000"> p_y </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> [ 
                  </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]          
                  </font><font color="#0000aa">if</font><font color="#000000"> (a </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> a </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">180</font><font color="#000000">) [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> LOPF_Force]]]       
</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">]          
</font><font color="#007f69">end</font><font color="#000000">


</font><font color="#5a5a5a">;; rutine needed to understand in which are of the LOPF coordinate system the leader is placed </font><font color="#000000">
</font><font color="#007f69">to-report</font><font color="#000000"> leader_x-position[ax lx]
</font><font color="#0000aa">ifelse</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000">(ax </font><font color="#660096">-</font><font color="#000000"> lx) </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">5</font><font color="#000000"> [</font><font color="#0000aa">report</font><font color="#000000"> (ax </font><font color="#660096">-</font><font color="#000000"> lx) </font><font color="#660096">/</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000"> (ax </font><font color="#660096">-</font><font color="#000000"> lx)] </font><font color="#5a5a5a">;; -1 is left, +1 is right</font><font color="#000000">
       [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">;; rutine needed to understand in which are of the LOPF coordinate system the leader is placed </font><font color="#000000">
</font><font color="#007f69">to-report</font><font color="#000000"> leader_y-position[ay ly]
</font><font color="#0000aa">ifelse</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000">(ay </font><font color="#660096">-</font><font color="#000000"> ly) </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">5</font><font color="#000000"> [</font><font color="#0000aa">report</font><font color="#000000"> (ay </font><font color="#660096">-</font><font color="#000000"> ly) </font><font color="#660096">/</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000"> (ay </font><font color="#660096">-</font><font color="#000000"> ly)] </font><font color="#5a5a5a">;; -1 is below, +1 is above</font><font color="#000000">
       [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">]
</font><font color="#007f69">end</font><font color="#000000">


</font><font color="#5a5a5a">;;rutine to add a new robot</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> add_robot
  </font><font color="#0000aa">let</font><font color="#000000"> a </font><font color="#963700">FALSE</font><font color="#000000">
  </font><font color="#0000aa">while</font><font color="#000000"> [</font><font color="#660096">mouse-down?</font><font color="#000000">]
    [ </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">not</font><font color="#000000"> a[
      create-scouts </font><font color="#963700">1</font><font color="#000000">
      [</font><font color="#0000aa">setxy</font><font color="#000000"> </font><font color="#660096">mouse-xcor</font><font color="#000000"> </font><font color="#660096">mouse-ycor</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">grey</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000"> </font><font color="#963700">9</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> IR.radius GIR.radius </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">random-normal</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#963700">0.5</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> epsilon G_Force
      </font><font color="#0000aa">set</font><font color="#000000"> r R
      </font><font color="#0000aa">set</font><font color="#000000"> pLx </font><font color="#963700">0</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> pLy </font><font color="#963700">0</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> dL </font><font color="#963700">0</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> lvl </font><font color="#963700">9</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> mass </font><font color="#963700">0.1</font><font color="#000000"> 
      </font><font color="#0000aa">set</font><font color="#000000"> Vmax </font><font color="#963700">12.5</font><font color="#000000"> </font><font color="#5a5a5a">;;[cm/s]</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> Fmax Vmax </font><font color="#660096">*</font><font color="#000000"> mass </font><font color="#660096">/</font><font color="#000000"> dT 
      </font><font color="#0000aa">set</font><font color="#000000"> vel </font><font color="#963700">0</font><font color="#000000"> </font><font color="#5a5a5a">;;assuming new robots are standing still</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> interaction </font><font color="#963700">FALSE</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> force </font><font color="#660096">array:from-list</font><font color="#000000"> </font><font color="#660096">n-values</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> [</font><font color="#963700">0</font><font color="#000000">]
      correct_angle </font><font color="#660096">random</font><font color="#000000"> </font><font color="#963700">180</font><font color="#000000">]
      </font><font color="#0000aa">display</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> a </font><font color="#963700">TRUE</font><font color="#000000">
     ]  ]
</font><font color="#007f69">end</font><font color="#000000">


</font><font color="#5a5a5a">;;test: show abs(((((ac + 180) mod 360 + 30) mod 120 - 60) / 60))</font><font color="#000000">
</font><font color="#007f69">to-report</font><font color="#000000"> change-level [ac pc_x pc_y dc_] </font><font color="#5a5a5a">;;needed to assign the level to the robots in the Star and Tree deployments</font><font color="#000000">


</font><font color="#0000aa">set</font><font color="#000000"> ac (ac </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">180</font><font color="#000000">) </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">360</font><font color="#000000"> 
</font><font color="#0000aa">let</font><font color="#000000"> newlvl </font><font color="#963700">9</font><font color="#000000">
</font><font color="#0000aa">if</font><font color="#000000"> Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Star&quot;</font><font color="#000000"> [
        </font><font color="#0000aa">if</font><font color="#000000"> (dc_ </font><font color="#660096">/</font><font color="#000000"> (R </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000">)) </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">1.3</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000">((((ac </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">30</font><font color="#000000">) </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">120</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">60</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">60</font><font color="#000000">)) </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">0.9</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> newlvl </font><font color="#963700">1</font><font color="#000000">]
        </font><font color="#0000aa">if</font><font color="#000000"> Angle </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [</font><font color="#0000aa">if</font><font color="#000000"> (dc_ </font><font color="#660096">/</font><font color="#000000"> (R </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000">)) </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">1.3</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000">((((ac </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">30</font><font color="#000000">) </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">120</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">60</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">60</font><font color="#000000">)) </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">0.9</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> newlvl </font><font color="#963700">2</font><font color="#000000">]] </font><font color="#5a5a5a">;;the thresholds need to be changed if a higher number of robots is used</font><font color="#000000">
        </font><font color="#0000aa">if</font><font color="#000000"> Angle </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [</font><font color="#0000aa">if</font><font color="#000000"> (dc_ </font><font color="#660096">/</font><font color="#000000"> (R </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000">)) </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">1.3</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> newlvl </font><font color="#963700">2</font><font color="#000000">]] </font><font color="#5a5a5a">;;the thresholds need to be changed if a higher number of robots is used</font><font color="#000000">
  ]
</font><font color="#0000aa">if</font><font color="#000000"> Deployment </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Tree&quot;</font><font color="#000000"> [
        </font><font color="#0000aa">let</font><font color="#000000"> dLx dc_ </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">cos</font><font color="#000000">(ac)
        </font><font color="#0000aa">let</font><font color="#000000"> dLy dc_ </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">sin</font><font color="#000000">(ac) 
        </font><font color="#0000aa">if</font><font color="#000000"> (dc_ </font><font color="#660096">/</font><font color="#000000"> (R </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000">)) </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">1.5</font><font color="#000000"> [
           </font><font color="#0000aa">if</font><font color="#000000"> Angle </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> newlvl </font><font color="#963700">1</font><font color="#000000">]
           </font><font color="#0000aa">if</font><font color="#000000"> Angle </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [</font><font color="#0000aa">if</font><font color="#000000"> (ac </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">180</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> ac </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">360</font><font color="#000000">) </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000">((((ac </font><font color="#660096">+</font><font color="#000000"> Angle </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">45</font><font color="#000000">) </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">45</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">45</font><font color="#000000">)) </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">0.85</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> newlvl </font><font color="#963700">1</font><font color="#000000">]]
        ]
        </font><font color="#0000aa">if</font><font color="#000000"> Angle </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">11</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> Angle </font><font color="#963700">11</font><font color="#000000">]
        </font><font color="#0000aa">let</font><font color="#000000"> threshold_y (R </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">6.5</font><font color="#000000">) </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">cos</font><font color="#000000">(</font><font color="#963700">45</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> Angle) 
        </font><font color="#0000aa">let</font><font color="#000000"> threshold_x (R </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">10</font><font color="#000000">) </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">sin</font><font color="#000000">(</font><font color="#963700">45</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> Angle)
        </font><font color="#0000aa">let</font><font color="#000000"> range </font><font color="#660096">round</font><font color="#000000"> (</font><font color="#660096">abs</font><font color="#000000">(dLy) </font><font color="#660096">/</font><font color="#000000"> threshold_y) </font><font color="#5a5a5a">;;utility variable to assign the level</font><font color="#000000">
        </font><font color="#0000aa">if</font><font color="#000000"> (dc_ </font><font color="#660096">/</font><font color="#000000"> (R </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000">)) </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">1.3</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> range </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000">(dLx) </font><font color="#660096">&lt;=</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000">(threshold_x </font><font color="#660096">*</font><font color="#000000"> range) [ 
           </font><font color="#0000aa">if</font><font color="#000000"> (ac </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">180</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> ac </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">360</font><font color="#000000">) [</font><font color="#0000aa">set</font><font color="#000000"> newlvl range </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> (</font><font color="#963700">10</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> range </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">15</font><font color="#000000">)]
           </font><font color="#0000aa">if</font><font color="#000000"> range </font><font color="#660096">&gt;</font><font color="#000000"> Max_level [</font><font color="#0000aa">set</font><font color="#000000"> newlvl </font><font color="#963700">9</font><font color="#000000">]
        ]                     
  ]
</font><font color="#0000aa">if</font><font color="#000000"> newlvl </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">15</font><font color="#000000">]
</font><font color="#0000aa">if</font><font color="#000000"> newlvl </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">25</font><font color="#000000">]
</font><font color="#0000aa">if</font><font color="#000000"> newlvl </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">45</font><font color="#000000">] 
</font><font color="#0000aa">if</font><font color="#000000"> newlvl </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">9</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">grey</font><font color="#000000">]

</font><font color="#0000aa">report</font><font color="#000000"> newlvl

</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> barycenter-computation
</font><font color="#0000aa">let</font><font color="#000000"> n </font><font color="#963700">3</font><font color="#000000">
</font><font color="#0000aa">let</font><font color="#000000"> a </font><font color="#963700">0</font><font color="#000000">
</font><font color="#0000aa">let</font><font color="#000000"> b </font><font color="#963700">0</font><font color="#000000">
</font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> [</font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">40</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> a </font><font color="#660096">xcor</font><font color="#000000">
                             </font><font color="#0000aa">set</font><font color="#000000"> b </font><font color="#660096">ycor</font><font color="#000000">]]
</font><font color="#5a5a5a">;;computing the apotema</font><font color="#000000">
</font><font color="#0000aa">let</font><font color="#000000"> L (R </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">cos</font><font color="#000000">(</font><font color="#963700">180</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> (n </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> (n </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">))) )                    
                                
</font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000">  [</font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">pxcor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#660096">ceiling</font><font color="#000000"> a </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">pycor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#660096">ceiling</font><font color="#000000"> (b </font><font color="#660096">-</font><font color="#000000"> L) [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">66</font><font color="#000000">]]</font><font color="#5a5a5a">;; [set pcolor 33.1]]                                                                                                </font><font color="#000000">
                              
</font><font color="#007f69">end</font><font color="#000000">


</font><font color="#5a5a5a">;;Newtonian Law of Universal Gravitation </font><font color="#000000">
</font><font color="#007f69">to-report</font><font color="#000000"> N-force [rN Nepsilon]
 </font><font color="#0000aa">ifelse</font><font color="#000000"> rN </font><font color="#660096">&gt;=</font><font color="#000000"> R </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000"> [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">15</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> Aggregation </font><font color="#660096">*</font><font color="#000000"> Nepsilon </font><font color="#660096">/</font><font color="#000000"> (rN </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">0.75</font><font color="#000000">)] 
                 [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">-10</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> Dispersion </font><font color="#660096">*</font><font color="#000000"> Nepsilon </font><font color="#660096">/</font><font color="#000000"> (rN </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">0.75</font><font color="#000000">)]
</font><font color="#007f69">end</font><font color="#000000">


</font><font color="#007f69">to-report</font><font color="#000000"> vecotr-abs[xmod1 ymod1]
  </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000"> (xmod1 </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> ymod1 </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">)
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to-report</font><font color="#000000"> vecotr-abs-modificato[xmod ymod] </font><font color="#5a5a5a">;;it is needed to take into account that the true position of the robots needs to be diminished by 3.5 + 3.5 cm (two times half the size of a robot)</font><font color="#000000">
  </font><font color="#0000aa">ifelse</font><font color="#000000"> xmod </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> xmod xmod </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000">]      
  [</font><font color="#0000aa">set</font><font color="#000000"> xmod xmod </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000">]
  </font><font color="#0000aa">ifelse</font><font color="#000000"> ymod </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> ymod ymod </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000">]
  [</font><font color="#0000aa">set</font><font color="#000000"> ymod ymod </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000">]
  </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000"> (xmod </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> ymod </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">)
</font><font color="#007f69">end</font>
</pre>

</body>
</html>
