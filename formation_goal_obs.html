<html>
<head>
<title>formation_goal_obs</title>
<style type="text/css">
<!--
  :link { color: rgb(110, 0, 110); } 
  :visited { color: rgb(110, 0, 110); } 
  body { margin-left: 5px; font-family: arial, sans-serif; 
         background: white; font-size: 12pt } 
  h2 { background: rgb(166,172,255); 
       font-size: 15pt; 
       padding-left: 6px; padding-right: 6px; padding-top: 6px; 
       padding-bottom: 6px; } 
  p { margin-left: 10px; } 
  pre { margin-left: 13px; background: rgb(225,225,225); 
        font-family: monospace; padding-left: 3px; padding-right: 3px; 
        padding-top: 3px; padding-bottom: 3px; } 
-->
</style>
</head>
<body>

<p>This page was automatically generated by NetLogo 4.1.3.</p>

<p>The applet requires Java 5 or higher.
Java must be enabled in your browser settings.
Mac users must have Mac OS X 10.4 or higher.
Windows and Linux users may obtain the latest Java from
<a href="http://java.sun.com/getjava/download.html">Sun's Java site</a>.</p>

<p>
<applet code="org.nlogo.lite.Applet"
        archive="NetLogoLite.jar"
        width="1035" height="703">
  <param name="DefaultModel"
         value="formation_goal_obs.nlogo">
</applet>
</p>

<p>powered by
<a target="_blank" href="http://ccl.northwestern.edu/netlogo/">NetLogo</a></p>

<p>view/download model file:
<a href="formation_goal_obs.nlogo">formation_goal_obs.nlogo</a>
</p>
<h2>WHAT IS IT?</h2>
<p>This is our third physics-based model of a swarm, for the book entitled &quot;Physicomimetics: Physics-Based Swarm Intelligence.&quot; This simulation is an extension of &quot;formation_newton.nlogo&quot; that includes a goal and obstacles.</p><br>
<h2>HOW IT WORKS</h2>
<p>Multiple particles use F = ma and a &quot;split Newtonian&quot; force law to self-organize into a triangular lattice or a square lattice. </p>
<p>A goal provides an attractive force and obstacles provide a repulsive force.</p><br>
<h2>WHAT IS NEW</h2>
<p>This simulation extends &quot;formation_newton.nlogo&quot; in several ways.  </p>
<p>First, particles can become disabled.  This is different from killing particles because the particles remain in the system (and are sensed by neighboring particles), but they can not move.</p>
<p>Second, a goal has been added to the system (shown as a blue dot on the left side of the environment).  This goal is attactive. The GOAL_FORCE slider controls the strength of the goal force.</p>
<p>Third, you can place obstacles in the environment with your mouse, to create an obstacle course. The OBSTACLE_FORCE slider controls the size of the obstacles (i.e., the extent at which the repulsive obstacle force is felt). See Chapter 3 for more details.</p><br>
<h2>HOW TO USE IT</h2>
<p>Click SETUP AGENTS to initialize the particles, and click MOVE AGENTS to have them move.</p>
<p>The CLEAR button will clear the graphics, which becomes handy when particles have their pens down (more on this below).</p>
<p>The NUMBER_OF_PARTICLES slider allows you to control the number of particles created at initialization. Changing this slider after the simulation is running will have no effect. You can change the number of particles while the simulation is running by using the ONE IS BORN and KILL ONE buttons. However, the ONE IS BORN and KILL ONE buttons do not change the number of initial particles when the simulation is restarted by clicking SETUP AGENTS.</p>
<p>The ONE IS BORN button creates a new particle.</p>
<p>The KILL ONE button randomly kills an existing particle.</p>
<p>The DISABLE ONE button randomly disables an existing particle. This particle remains in the system but can not move.</p>
<p>There is also a TOGGLE FORMATION button that allows you to choose between square and triangular lattices. A monitor indicates whether the square or triangular lattice has been selected.</p>
<p>The TOGGLE GOAL button turns the goal force on and off. The strength of the force is controlled with the GOAL_FORCE slider.</p>
<p>Obstacles can be placed in the environment by placing the mouse where you want the obstacle to be, and then clicking the mouse. The obstacle is shown as a green disk. The OBSTACLE_FORCE slider changes the size of the obstacle.  This affects all obstacles and the change is shown visually as the sizes of the disks change.</p>
<p>All other sliders will affect the simulation when it is running.</p><br>
<h2>THINGS TO NOTICE</h2>
<p>Particles are initialized in a random cluster at the right of the graphics pane, and self-organize into a triangular lattice. The lattice is not perfect, but that is ok because we are interested in &quot;satisficing systems,&quot; as opposed to &quot;optimal systems.&quot;</p>
<p>The GRAVITATIONAL_CONSTANT controls the G parameter in the split Newtonian force law. The POWER controls the value of &quot;p&quot; in the generalized law. The DESIRED_SEPARATION is the desired distance between neighboring particles.</p>
<p>Again, FRICTION is enabled. This allows the system to stabilize.</p>
<p>This simulation serves to teach you about physics-based swarms, as well as the Conservation of Linear and Angular Momenta. This is covered in detail in Chapter 3 of the book.</p>
<p>The red dot in the simulation shows the center of mass of the system. If the Conservation of Linear Momentum holds in both the x- and y-dimensions, the red dot will not move. This simulation includes a monitor for the Angular Momentum and you will see that it does not change over time, if the system is closed.</p>
<p>This model allows you to add and remove particles. Removing particles allows you to test how robust the system is to particle failure. Adding particles allows you to see how scalable the system is, and illustrates just how nicely new particles are incorporated into the lattice. Adding, disabling, or removing particles opens the system, and temporary changes in the momenta can occur during those events. </p>
<p>Similarly, turning the goal force on and off, as well as adding obstacles, opens the system. The center of mass will move when this happens.</p>
<p>Chapter 3 discusses how to balance the goal and obstacle forces properly.</p><br>
<h2>THINGS TO TRY</h2>
<p>See how the FRICTION changes behavior. Click SETUP AGENTS, lower the friction, and click MOVE AGENTS.  What happens?  </p>
<p>Similarly, change the GRAVITATIONAL_CONSTANT or the POWER.</p>
<p>Change the DESIRED_SEPARATION while the system is running. Try changing it slowly and then change it quickly. What happens?</p>
<p>See how the G PHASE TRANSITION value is affected when you change the GRAVITATIONAL_CONSTANT, the POWER, and the FORCE_MAXIMUM.</p>
<p>Add and remove particles. After you add a particle, turn on the goal force. Since the pen will be down on the newly added particle, you can watch the trajectory as it moves.</p>
<p>Try different obstacle courses.  Increase the number of obstacles and increase the size of the obstacles. What happens?</p><br>
<h2>EXTENDING THE MODEL</h2>
<p>Currently all obstacles in one environment have the same size. Modify the code to allow each obstacle to have a different unique size.</p>
<p>Try having multiple goals. What happens?</p>
<p>Note, in order to change any NetLogo simulation, you must have the source code (i.e., &quot;formation_goal_obs.nlogo&quot;) downloaded to your computer, as well as NetLogo itself. You can not change the code when you are running the simulation with your browser.</p><br>
<h2>NETLOGO FEATURES</h2>
<p>This simulation allows the user to create new particles and kill existing ones.</p>
<p>Killing a particle is accomplished via a call to the NetLogo procedure &quot;die.&quot;</p>
<p>To create a particle, the &quot;hatch&quot; command is used - this clones an existing particle and moves it away from the original. Also, the new particle has the &quot;pen down,&quot; which means that you will see the path that the particle takes. If the graphics pane becomes too busy, click on the CLEAR button.</p>
<p>This simulation makes use of NetLogo mouse events to allow the user to place obstacles in the environment.</p><br>
<h2>RELATED MODELS</h2>
<p>This is our third physics-based swarm simulation, which adds a goal and obstacles to the environment.</p><br>
<h2>CREDITS AND REFERENCES</h2>
<p>To see our implementation on seven simple robots moving towards a goal:</p>
<p>Spears, W. M., Spears, D. F., Hamann, J., and Heil, R. (2004) Distributed, physics-based control of swarms of vehicles. Autonomous Robots, 17 (2-3).</p>
<p>* The video &quot;odm.avi&quot; shows our testing of an Obstacle Detection Module for our more complex robots. *</p>
<p>For an explanation of the phase transition:</p>
<p>Gordon-Spears, D. F., and Spears, W. M. (2003) Analysis of a phase transition in a physics-based multiagent system. Lecture Notes in Computer Science, Volume 2699.</p>
<p>To see the first papers that outlined the work presented in this simulation:</p>
<p>Gordon, D. F., Spears, W. M., Sokolsky, O., and Lee, I. (1999) Distributed spatial control, global monitoring and steering of mobile physical agents. In Proceedings of IEEE International Conference on Information, Intelligence, and Systems.</p>
<p>Spears, W. M., and Gordon, D. F. (1999) Using Artificial Physics to control agents. In Proceedings of IEEE International Conference on Information, Intelligence, and Systems.</p><br>
<h2>HOW TO CITE</h2>
<p>If you mention this model in an academic publication, we ask that you include these citations for the model itself and for the NetLogo software:<br>- Spears, W. M. and Spears, D. F. (eds.) Physicomimetics: Physics-Based Swarm Intelligence, Springer-Verlag, (2011).<br>- Wilensky, U. (1999). NetLogo. <a href="http://ccl.northwestern.edu/netlogo/">http://ccl.northwestern.edu/netlogo/</a>. Center for Connected Learning and Computer-Based Modeling, Northwestern University, Evanston, IL.</p><br>
<h2>COPYRIGHT NOTICE</h2>
<p>Copyright 2011 William M. Spears. All rights reserved.</p>
<p>Permission to use, modify or redistribute this model is hereby granted, provided that both of the following requirements are followed:<br>a) this copyright notice is included, and<br>b) this model will not be redistributed for profit without permission from William M. Spears. Contact William M. Spears for appropriate licenses for redistribution for profit.</p>
<p><a href="http://www.swarmotics.com">http://www.swarmotics.com</a></p><br>
<h2>PROCEDURES</h2>
<pre><font color="#5a5a5a">; William M. Spears September 2011</font><font color="#000000">
</font><font color="#5a5a5a">; Triangular and Square Lattices and a Goal Force with Obstacles!</font><font color="#000000">
</font><font color="#5a5a5a">; You introduce the obstacles with your mouse.</font><font color="#000000">
</font><font color="#5a5a5a">; For research and educational use only</font><font color="#000000">

</font><font color="#660096">breed</font><font color="#000000"> [particles particle]                            </font><font color="#5a5a5a">; Introduce the &quot;particle&quot; breed</font><font color="#000000">
</font><font color="#660096">breed</font><font color="#000000"> [goals goal]                                    </font><font color="#5a5a5a">; Introduce the &quot;goal&quot; breed</font><font color="#000000">
</font><font color="#660096">breed</font><font color="#000000"> [obstacles obstacle]                            </font><font color="#5a5a5a">; Introduce the &quot;obstacle&quot; breed</font><font color="#000000">

</font><font color="#007f69">globals</font><font color="#000000"> [total_lmx total_lmy total_angular_mom G p FR D objects
         center_of_mass_x center_of_mass_y FMAX DeltaT obstacleF
         square? square_button? goalF goal? goal_button? Gt Gf heavy disabled]

</font><font color="#007f69">turtles-own</font><font color="#000000"> [hood deltax deltay r F Fx Fy v vx vy dvx dvy mass view
             lmx lmy theta lever_arm_x lever_arm_y lever_arm_r angular_mom]

</font><font color="#007f69">to</font><font color="#000000"> setup
   </font><font color="#0000aa">clear-all</font><font color="#000000">                                          </font><font color="#5a5a5a">; Clear everything</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> disabled </font><font color="#963700">0</font><font color="#000000">                                     </font><font color="#5a5a5a">; No one disabled at the start </font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> heavy </font><font color="#963700">100000</font><font color="#000000">                                   </font><font color="#5a5a5a">; Used for disabled particles, goals, and obstacles</font><font color="#000000">
                                                      </font><font color="#5a5a5a">; Create and initialize particles</font><font color="#000000">
   create-particles Number_of_Particles [setup-particles]
                                                      </font><font color="#5a5a5a">; Create blue goal on the left side</font><font color="#000000">
   create-goals </font><font color="#963700">1</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">sky</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000"> </font><font color="#963700">5</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> </font><font color="#963700">&quot;circle&quot;</font><font color="#000000"> 
                   </font><font color="#0000aa">set</font><font color="#000000"> mass heavy </font><font color="#0000aa">setxy</font><font color="#000000"> (</font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">world-width</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000">) </font><font color="#963700">0</font><font color="#000000">]
      
   </font><font color="#0000aa">set</font><font color="#000000"> square_button? </font><font color="#963700">false</font><font color="#000000">                           </font><font color="#5a5a5a">; Start with a triangular lattice</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> goal_button? </font><font color="#963700">false</font><font color="#000000">                             </font><font color="#5a5a5a">; Start with goal force off</font><font color="#000000">
   update-info
 
   </font><font color="#0000aa">ifelse</font><font color="#000000"> goal? 
      [</font><font color="#0000aa">set</font><font color="#000000"> objects (</font><font color="#660096">turtle-set</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000">)]              </font><font color="#5a5a5a">; If goal? need to include all entities </font><font color="#000000">
      [</font><font color="#0000aa">set</font><font color="#000000"> objects (</font><font color="#660096">turtle-set</font><font color="#000000"> particles obstacles)]  </font><font color="#5a5a5a">; Otherwise, just particles and obstacles</font><font color="#000000">
                                                      </font><font color="#5a5a5a">; Computes center of mass and displays location</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> center_of_mass_x (</font><font color="#660096">sum</font><font color="#000000"> [</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> mass] </font><font color="#660096">of</font><font color="#000000"> objects) </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#660096">sum</font><font color="#000000"> [mass] </font><font color="#660096">of</font><font color="#000000"> objects)
   </font><font color="#0000aa">set</font><font color="#000000"> center_of_mass_y (</font><font color="#660096">sum</font><font color="#000000"> [</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> mass] </font><font color="#660096">of</font><font color="#000000"> objects) </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#660096">sum</font><font color="#000000"> [mass] </font><font color="#660096">of</font><font color="#000000"> objects)
   </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patch</font><font color="#000000"> (</font><font color="#660096">round</font><font color="#000000"> center_of_mass_x) (</font><font color="#660096">round</font><font color="#000000"> center_of_mass_y)
      [</font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">in-radius</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000">]]  
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> run-and-monitor
   </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) [</font><font color="#0000aa">user-message</font><font color="#000000"> </font><font color="#963700">&quot;Please click HALT and then SETUP AGENTS first&quot;</font><font color="#000000"> </font><font color="#0000aa">stop</font><font color="#000000">]
   update-info
   </font><font color="#0000aa">ask</font><font color="#000000"> particles [ap-particles]
   </font><font color="#0000aa">ask</font><font color="#000000"> goals     [ap-goals]
   </font><font color="#0000aa">ask</font><font color="#000000"> obstacles [ap-obstacles]
   </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000">   [move]

   </font><font color="#5a5a5a">; Use mouse click to create obstacles. Must make sure that mouse is within black graphics pane.</font><font color="#000000">
   </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">mouse-down?</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">mouse-inside?</font><font color="#000000">) [
      </font><font color="#0000aa">ifelse</font><font color="#000000"> ((</font><font color="#660096">count</font><font color="#000000"> obstacles) </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) 
          [create-obstacles </font><font color="#963700">1</font><font color="#000000"> [</font><font color="#0000aa">setxy</font><font color="#000000"> </font><font color="#660096">mouse-xcor</font><font color="#000000"> </font><font color="#660096">mouse-ycor</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> vx </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> vy </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> </font><font color="#963700">&quot;circle&quot;</font><font color="#000000"> 
                               </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000"> (</font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> obstacleF) </font><font color="#0000aa">set</font><font color="#000000"> mass heavy </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">green</font><font color="#000000">]]
          [</font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">one-of</font><font color="#000000"> obstacles [</font><font color="#0000aa">hatch</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> [</font><font color="#0000aa">setxy</font><font color="#000000"> </font><font color="#660096">mouse-xcor</font><font color="#000000"> </font><font color="#660096">mouse-ycor</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> vx </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> vy </font><font color="#963700">0</font><font color="#000000">]]]
      </font><font color="#0000aa">wait</font><font color="#000000"> </font><font color="#963700">0.2</font><font color="#000000">                                        </font><font color="#5a5a5a">; Pause so don't get a bunch of obstacles at once</font><font color="#000000">
   ]
   
   </font><font color="#0000aa">ifelse</font><font color="#000000"> goal? 
      [</font><font color="#0000aa">set</font><font color="#000000"> objects (</font><font color="#660096">turtle-set</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000">)]              </font><font color="#5a5a5a">; If goal? need to include all entities</font><font color="#000000">
      [</font><font color="#0000aa">set</font><font color="#000000"> objects (</font><font color="#660096">turtle-set</font><font color="#000000"> particles obstacles)]  </font><font color="#5a5a5a">; Otherwise, just particles and obstacles</font><font color="#000000">
                                                      </font><font color="#5a5a5a">; Computes center of mass and displays location</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> center_of_mass_x (</font><font color="#660096">sum</font><font color="#000000"> [</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> mass] </font><font color="#660096">of</font><font color="#000000"> objects) </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#660096">sum</font><font color="#000000"> [mass] </font><font color="#660096">of</font><font color="#000000"> objects)
   </font><font color="#0000aa">set</font><font color="#000000"> center_of_mass_y (</font><font color="#660096">sum</font><font color="#000000"> [</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> mass] </font><font color="#660096">of</font><font color="#000000"> objects) </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#660096">sum</font><font color="#000000"> [mass] </font><font color="#660096">of</font><font color="#000000"> objects)
   </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patch</font><font color="#000000"> (</font><font color="#660096">round</font><font color="#000000"> center_of_mass_x) (</font><font color="#660096">round</font><font color="#000000"> center_of_mass_y)
      [</font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">in-radius</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000">]]
      
   </font><font color="#0000aa">set</font><font color="#000000"> total_lmx </font><font color="#660096">sum</font><font color="#000000"> [lmx] </font><font color="#660096">of</font><font color="#000000"> objects                 </font><font color="#5a5a5a">; Total linear momentum, x-component</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> total_lmy </font><font color="#660096">sum</font><font color="#000000"> [lmy] </font><font color="#660096">of</font><font color="#000000"> objects                 </font><font color="#5a5a5a">; Total linear momentum, y-component</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> total_angular_mom </font><font color="#660096">sum</font><font color="#000000"> [angular_mom] </font><font color="#660096">of</font><font color="#000000"> objects </font><font color="#5a5a5a">; Total angular momentum of objects</font><font color="#000000">
   </font><font color="#0000aa">tick</font><font color="#000000">
   do-plots
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> setup-particles                                    </font><font color="#5a5a5a">; Set up the particles</font><font color="#000000">
   </font><font color="#0000aa">setxy</font><font color="#000000"> ((</font><font color="#660096">world-width</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000">) </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">random-normal</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">20</font><font color="#000000">) 
         (</font><font color="#660096">random-normal</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">20</font><font color="#000000">)                         </font><font color="#5a5a5a">; Start in a cluster on the right side</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">heading</font><font color="#000000"> </font><font color="#660096">random</font><font color="#000000"> </font><font color="#963700">360</font><font color="#000000">                             </font><font color="#5a5a5a">; Everyone has a random heading</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> vx </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> vy </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> mass </font><font color="#963700">1</font><font color="#000000">                       </font><font color="#5a5a5a">; Start with no motion and mass = 1</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> </font><font color="#963700">&quot;circle&quot;</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000"> </font><font color="#963700">5</font><font color="#000000">
   </font><font color="#0000aa">ifelse</font><font color="#000000"> ((</font><font color="#660096">who</font><font color="#000000"> </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">) </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) 
      [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">white</font><font color="#000000">] 
      [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">yellow</font><font color="#000000">]                              </font><font color="#5a5a5a">; Different colors for square formations</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> theta </font><font color="#963700">0</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> ap-particles                                       </font><font color="#5a5a5a">; Run artificial physics on the particles</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> Fx </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> Fy </font><font color="#963700">0</font><font color="#000000">                                  </font><font color="#5a5a5a">; Initialize force components to zero</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> vx (</font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> FR) </font><font color="#660096">*</font><font color="#000000"> vx                               </font><font color="#5a5a5a">; Slow down according to friction</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> vy (</font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> FR) </font><font color="#660096">*</font><font color="#000000"> vy 
   
   </font><font color="#0000aa">set</font><font color="#000000"> hood [</font><font color="#660096">who</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">other</font><font color="#000000"> particles                  </font><font color="#5a5a5a">; Get the IDs of all other particles</font><font color="#000000">
   </font><font color="#0000aa">foreach</font><font color="#000000"> hood [         
      </font><font color="#0000aa">set</font><font color="#000000"> deltax (([</font><font color="#660096">xcor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> particle ?) </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000">) 
      </font><font color="#0000aa">set</font><font color="#000000"> deltay (([</font><font color="#660096">ycor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> particle ?) </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000">) 
      </font><font color="#0000aa">set</font><font color="#000000"> r </font><font color="#660096">sqrt</font><font color="#000000"> (deltax </font><font color="#660096">*</font><font color="#000000"> deltax </font><font color="#660096">+</font><font color="#000000"> deltay </font><font color="#660096">*</font><font color="#000000"> deltay)
      </font><font color="#0000aa">set</font><font color="#000000"> view </font><font color="#963700">1.5</font><font color="#000000">                                    </font><font color="#5a5a5a">; For triangular lattice </font><font color="#000000">
      </font><font color="#0000aa">if</font><font color="#000000"> (square?) [                                  </font><font color="#5a5a5a">; For square lattice</font><font color="#000000">
      </font><font color="#0000aa">ifelse</font><font color="#000000"> ((</font><font color="#660096">who</font><font color="#000000"> </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">) </font><font color="#660096">=</font><font color="#000000"> (? </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">)) 
         [</font><font color="#0000aa">set</font><font color="#000000"> view </font><font color="#963700">1.3</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> r (r </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#660096">sqrt</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">))]          </font><font color="#5a5a5a">; See Chapter 3 for details</font><font color="#000000">
         [</font><font color="#0000aa">set</font><font color="#000000"> view </font><font color="#963700">1.7</font><font color="#000000">]
      ]
    
      </font><font color="#0000aa">if</font><font color="#000000"> (r </font><font color="#660096">&lt;</font><font color="#000000"> view </font><font color="#660096">*</font><font color="#000000"> D) [                             </font><font color="#5a5a5a">; The generalized split Newtonian law</font><font color="#000000">
         </font><font color="#0000aa">set</font><font color="#000000"> F (G </font><font color="#660096">*</font><font color="#000000"> mass </font><font color="#660096">*</font><font color="#000000"> ([mass] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">turtle</font><font color="#000000"> ?) </font><font color="#660096">/</font><font color="#000000"> (r </font><font color="#660096">^</font><font color="#000000"> p)) 
         </font><font color="#0000aa">if</font><font color="#000000"> (F </font><font color="#660096">&gt;</font><font color="#000000"> FMAX) [</font><font color="#0000aa">set</font><font color="#000000"> F FMAX]                   </font><font color="#5a5a5a">; Bounds check on force magnitude</font><font color="#000000">
         </font><font color="#0000aa">ifelse</font><font color="#000000"> (r </font><font color="#660096">&gt;</font><font color="#000000"> D) 
            [</font><font color="#0000aa">set</font><font color="#000000"> Fx (Fx </font><font color="#660096">+</font><font color="#000000"> F </font><font color="#660096">*</font><font color="#000000"> (deltax </font><font color="#660096">/</font><font color="#000000"> r))           </font><font color="#5a5a5a">; Attractive force, x-component</font><font color="#000000">
             </font><font color="#0000aa">set</font><font color="#000000"> Fy (Fy </font><font color="#660096">+</font><font color="#000000"> F </font><font color="#660096">*</font><font color="#000000"> (deltay </font><font color="#660096">/</font><font color="#000000"> r))]          </font><font color="#5a5a5a">; Attractive force, y-component</font><font color="#000000">
            [</font><font color="#0000aa">set</font><font color="#000000"> Fx (Fx </font><font color="#660096">-</font><font color="#000000"> F </font><font color="#660096">*</font><font color="#000000"> (deltax </font><font color="#660096">/</font><font color="#000000"> r))           </font><font color="#5a5a5a">; Repulsive force, x-component</font><font color="#000000">
             </font><font color="#0000aa">set</font><font color="#000000"> Fy (Fy </font><font color="#660096">-</font><font color="#000000"> F </font><font color="#660096">*</font><font color="#000000"> (deltay </font><font color="#660096">/</font><font color="#000000"> r))]          </font><font color="#5a5a5a">; Repulsive force, y-component</font><font color="#000000">
      ]
   ]
   
   </font><font color="#5a5a5a">; Now include obstacles</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> hood [</font><font color="#660096">who</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> obstacles                        </font><font color="#5a5a5a">; Get the IDs of obstacles</font><font color="#000000">
   </font><font color="#0000aa">foreach</font><font color="#000000"> hood [         
      </font><font color="#0000aa">set</font><font color="#000000"> deltax (([</font><font color="#660096">xcor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> obstacle ?) </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000">) 
      </font><font color="#0000aa">set</font><font color="#000000"> deltay (([</font><font color="#660096">ycor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> obstacle ?) </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000">) 
      </font><font color="#0000aa">set</font><font color="#000000"> r </font><font color="#660096">sqrt</font><font color="#000000"> (deltax </font><font color="#660096">*</font><font color="#000000"> deltax </font><font color="#660096">+</font><font color="#000000"> deltay </font><font color="#660096">*</font><font color="#000000"> deltay)
      </font><font color="#0000aa">if</font><font color="#000000"> (r </font><font color="#660096">&lt;=</font><font color="#000000"> obstacleF) [
         </font><font color="#0000aa">set</font><font color="#000000"> F (obstacleF </font><font color="#660096">-</font><font color="#000000"> r)                        </font><font color="#5a5a5a">; Simple linear force law</font><font color="#000000">
         </font><font color="#0000aa">set</font><font color="#000000"> Fx (Fx </font><font color="#660096">-</font><font color="#000000"> (F </font><font color="#660096">*</font><font color="#000000"> (deltax </font><font color="#660096">/</font><font color="#000000"> r)))             </font><font color="#5a5a5a">; Repulsive force, x-component</font><font color="#000000">
         </font><font color="#0000aa">set</font><font color="#000000"> Fy (Fy </font><font color="#660096">-</font><font color="#000000"> (F </font><font color="#660096">*</font><font color="#000000"> (deltay </font><font color="#660096">/</font><font color="#000000"> r)))             </font><font color="#5a5a5a">; Repulsive force, y-component</font><font color="#000000">
      ]
   ]
   
   </font><font color="#5a5a5a">; Now include goal force, if toggled on</font><font color="#000000">
   </font><font color="#0000aa">if</font><font color="#000000"> (goal?) [
      </font><font color="#0000aa">set</font><font color="#000000"> hood [</font><font color="#660096">who</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> goals                         </font><font color="#5a5a5a">; Get the IDs of goals</font><font color="#000000">
      </font><font color="#0000aa">foreach</font><font color="#000000"> hood [         
         </font><font color="#0000aa">set</font><font color="#000000"> deltax (([</font><font color="#660096">xcor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> goal ?) </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000">) 
         </font><font color="#0000aa">set</font><font color="#000000"> deltay (([</font><font color="#660096">ycor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> goal ?) </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000">) 
         </font><font color="#0000aa">set</font><font color="#000000"> r </font><font color="#660096">sqrt</font><font color="#000000"> (deltax </font><font color="#660096">*</font><font color="#000000"> deltax </font><font color="#660096">+</font><font color="#000000"> deltay </font><font color="#660096">*</font><font color="#000000"> deltay)
         </font><font color="#0000aa">set</font><font color="#000000"> F goalF                                  </font><font color="#5a5a5a">; Constant force magnitude</font><font color="#000000">
         </font><font color="#0000aa">set</font><font color="#000000"> Fx (Fx </font><font color="#660096">+</font><font color="#000000"> (F </font><font color="#660096">*</font><font color="#000000"> (deltax </font><font color="#660096">/</font><font color="#000000"> r)))             </font><font color="#5a5a5a">; Attractive force, x-component</font><font color="#000000">
         </font><font color="#0000aa">set</font><font color="#000000"> Fy (Fy </font><font color="#660096">+</font><font color="#000000"> (F </font><font color="#660096">*</font><font color="#000000"> (deltay </font><font color="#660096">/</font><font color="#000000"> r)))             </font><font color="#5a5a5a">; Attractive force, y-component</font><font color="#000000">
      ]
   ]
   
   </font><font color="#0000aa">set</font><font color="#000000"> dvx DeltaT </font><font color="#660096">*</font><font color="#000000"> (Fx </font><font color="#660096">/</font><font color="#000000"> mass)
   </font><font color="#0000aa">set</font><font color="#000000"> dvy DeltaT </font><font color="#660096">*</font><font color="#000000"> (Fy </font><font color="#660096">/</font><font color="#000000"> mass)
   </font><font color="#0000aa">set</font><font color="#000000"> vx  (vx </font><font color="#660096">+</font><font color="#000000"> dvx)                                 </font><font color="#5a5a5a">; The x-component of velocity</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> vy  (vy </font><font color="#660096">+</font><font color="#000000"> dvy)                                 </font><font color="#5a5a5a">; The y-component of velocity</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> v </font><font color="#660096">sqrt</font><font color="#000000"> (vx </font><font color="#660096">*</font><font color="#000000"> vx </font><font color="#660096">+</font><font color="#000000"> vy </font><font color="#660096">*</font><font color="#000000"> vy)

   </font><font color="#0000aa">set</font><font color="#000000"> deltax DeltaT </font><font color="#660096">*</font><font color="#000000"> vx
   </font><font color="#0000aa">set</font><font color="#000000"> deltay DeltaT </font><font color="#660096">*</font><font color="#000000"> vy 
   </font><font color="#0000aa">if</font><font color="#000000"> ((deltax </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (deltay </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">)) 
      [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">heading</font><font color="#000000"> (</font><font color="#660096">atan</font><font color="#000000"> deltax deltay)] 
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> ap-goals                                           </font><font color="#5a5a5a">; Run artificial physics on the goal</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> Fx </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> Fy </font><font color="#963700">0</font><font color="#000000">                                  </font><font color="#5a5a5a">; Initialize force components to zero</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> vx (</font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> FR) </font><font color="#660096">*</font><font color="#000000"> vx                               </font><font color="#5a5a5a">; Slow down according to friction</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> vy (</font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> FR) </font><font color="#660096">*</font><font color="#000000"> vy 
   
   </font><font color="#0000aa">set</font><font color="#000000"> hood [</font><font color="#660096">who</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> particles                        </font><font color="#5a5a5a">; Get the IDs of all particles</font><font color="#000000">
   </font><font color="#0000aa">foreach</font><font color="#000000"> hood [         
      </font><font color="#0000aa">set</font><font color="#000000"> deltax (([</font><font color="#660096">xcor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> particle ?) </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000">) 
      </font><font color="#0000aa">set</font><font color="#000000"> deltay (([</font><font color="#660096">ycor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> particle ?) </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000">) 
      </font><font color="#0000aa">set</font><font color="#000000"> r </font><font color="#660096">sqrt</font><font color="#000000"> (deltax </font><font color="#660096">*</font><font color="#000000"> deltax </font><font color="#660096">+</font><font color="#000000"> deltay </font><font color="#660096">*</font><font color="#000000"> deltay)
      </font><font color="#0000aa">set</font><font color="#000000"> F goalF                                     </font><font color="#5a5a5a">; Constant force magnitude</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> Fx (Fx </font><font color="#660096">+</font><font color="#000000"> F </font><font color="#660096">*</font><font color="#000000"> (deltax </font><font color="#660096">/</font><font color="#000000"> r))                  </font><font color="#5a5a5a">; Attractive force, x-component</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> Fy (Fy </font><font color="#660096">+</font><font color="#000000"> F </font><font color="#660096">*</font><font color="#000000"> (deltay </font><font color="#660096">/</font><font color="#000000"> r))                  </font><font color="#5a5a5a">; Attractive force, y-component</font><font color="#000000">
   ]
      
   </font><font color="#0000aa">set</font><font color="#000000"> dvx DeltaT </font><font color="#660096">*</font><font color="#000000"> (Fx </font><font color="#660096">/</font><font color="#000000"> mass)
   </font><font color="#0000aa">set</font><font color="#000000"> dvy DeltaT </font><font color="#660096">*</font><font color="#000000"> (Fy </font><font color="#660096">/</font><font color="#000000"> mass)
   </font><font color="#0000aa">set</font><font color="#000000"> vx  (vx </font><font color="#660096">+</font><font color="#000000"> dvx)                                 </font><font color="#5a5a5a">; The x-component of velocity</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> vy  (vy </font><font color="#660096">+</font><font color="#000000"> dvy)                                 </font><font color="#5a5a5a">; The y-component of velocity</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> v </font><font color="#660096">sqrt</font><font color="#000000"> (vx </font><font color="#660096">*</font><font color="#000000"> vx </font><font color="#660096">+</font><font color="#000000"> vy </font><font color="#660096">*</font><font color="#000000"> vy)

   </font><font color="#0000aa">set</font><font color="#000000"> deltax DeltaT </font><font color="#660096">*</font><font color="#000000"> vx
   </font><font color="#0000aa">set</font><font color="#000000"> deltay DeltaT </font><font color="#660096">*</font><font color="#000000"> vy 
   </font><font color="#0000aa">if</font><font color="#000000"> ((deltax </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (deltay </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">)) 
      [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">heading</font><font color="#000000"> (</font><font color="#660096">atan</font><font color="#000000"> deltax deltay)] 
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> ap-obstacles                                       </font><font color="#5a5a5a">; Run artificial physics on the obstacles</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> Fx </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> Fy </font><font color="#963700">0</font><font color="#000000">                                  </font><font color="#5a5a5a">; Initialize force components to zero</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> vx (</font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> FR) </font><font color="#660096">*</font><font color="#000000"> vx                               </font><font color="#5a5a5a">; Slow down according to friction</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> vy (</font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> FR) </font><font color="#660096">*</font><font color="#000000"> vy 
   
   </font><font color="#0000aa">set</font><font color="#000000"> hood [</font><font color="#660096">who</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> particles                        </font><font color="#5a5a5a">; Get the IDs of all particles</font><font color="#000000">
   </font><font color="#0000aa">foreach</font><font color="#000000"> hood [         
      </font><font color="#0000aa">set</font><font color="#000000"> deltax (([</font><font color="#660096">xcor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> particle ?) </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000">) 
      </font><font color="#0000aa">set</font><font color="#000000"> deltay (([</font><font color="#660096">ycor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> particle ?) </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000">) 
      </font><font color="#0000aa">set</font><font color="#000000"> r </font><font color="#660096">sqrt</font><font color="#000000"> (deltax </font><font color="#660096">*</font><font color="#000000"> deltax </font><font color="#660096">+</font><font color="#000000"> deltay </font><font color="#660096">*</font><font color="#000000"> deltay)
      </font><font color="#0000aa">if</font><font color="#000000"> (r </font><font color="#660096">&lt;=</font><font color="#000000"> obstacleF) [
         </font><font color="#0000aa">set</font><font color="#000000"> F (obstacleF </font><font color="#660096">-</font><font color="#000000"> r)                        </font><font color="#5a5a5a">; Simple linear force law</font><font color="#000000">
         </font><font color="#0000aa">set</font><font color="#000000"> Fx (Fx </font><font color="#660096">-</font><font color="#000000"> F </font><font color="#660096">*</font><font color="#000000"> (deltax </font><font color="#660096">/</font><font color="#000000"> r))               </font><font color="#5a5a5a">; Repulsive force, x-component</font><font color="#000000">
         </font><font color="#0000aa">set</font><font color="#000000"> Fy (Fy </font><font color="#660096">-</font><font color="#000000"> F </font><font color="#660096">*</font><font color="#000000"> (deltay </font><font color="#660096">/</font><font color="#000000"> r))               </font><font color="#5a5a5a">; Repulsive force, y-component</font><font color="#000000">
      ]
   ]
      
   </font><font color="#0000aa">set</font><font color="#000000"> dvx DeltaT </font><font color="#660096">*</font><font color="#000000"> (Fx </font><font color="#660096">/</font><font color="#000000"> mass)
   </font><font color="#0000aa">set</font><font color="#000000"> dvy DeltaT </font><font color="#660096">*</font><font color="#000000"> (Fy </font><font color="#660096">/</font><font color="#000000"> mass)
   </font><font color="#0000aa">set</font><font color="#000000"> vx  (vx </font><font color="#660096">+</font><font color="#000000"> dvx)                                 </font><font color="#5a5a5a">; The x-component of velocity</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> vy  (vy </font><font color="#660096">+</font><font color="#000000"> dvy)                                 </font><font color="#5a5a5a">; The y-component of velocity</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> v </font><font color="#660096">sqrt</font><font color="#000000"> (vx </font><font color="#660096">*</font><font color="#000000"> vx </font><font color="#660096">+</font><font color="#000000"> vy </font><font color="#660096">*</font><font color="#000000"> vy)

   </font><font color="#0000aa">set</font><font color="#000000"> deltax DeltaT </font><font color="#660096">*</font><font color="#000000"> vx
   </font><font color="#0000aa">set</font><font color="#000000"> deltay DeltaT </font><font color="#660096">*</font><font color="#000000"> vy 
   </font><font color="#0000aa">if</font><font color="#000000"> ((deltax </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (deltay </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">)) 
      [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">heading</font><font color="#000000"> (</font><font color="#660096">atan</font><font color="#000000"> deltax deltay)] 
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> move
   </font><font color="#0000aa">fd</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000"> (deltax </font><font color="#660096">*</font><font color="#000000"> deltax </font><font color="#660096">+</font><font color="#000000"> deltay </font><font color="#660096">*</font><font color="#000000"> deltay)        </font><font color="#5a5a5a">; Move the turtle</font><font color="#000000">

   </font><font color="#0000aa">set</font><font color="#000000"> lmx (mass </font><font color="#660096">*</font><font color="#000000"> vx)                                </font><font color="#5a5a5a">; Linear momentum of the turtle</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> lmy (mass </font><font color="#660096">*</font><font color="#000000"> vy)
   
   </font><font color="#0000aa">set</font><font color="#000000"> lever_arm_x (</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> center_of_mass_x)
   </font><font color="#0000aa">set</font><font color="#000000"> lever_arm_y (</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> center_of_mass_y)
   </font><font color="#0000aa">set</font><font color="#000000"> lever_arm_r </font><font color="#660096">sqrt</font><font color="#000000"> (lever_arm_x </font><font color="#660096">*</font><font color="#000000"> lever_arm_x </font><font color="#660096">+</font><font color="#000000"> lever_arm_y </font><font color="#660096">*</font><font color="#000000"> lever_arm_y)
   </font><font color="#0000aa">if</font><font color="#000000"> (((vx </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (vy </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">)) </font><font color="#660096">and</font><font color="#000000"> ((lever_arm_x </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (lever_arm_y </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">)))
      [</font><font color="#0000aa">set</font><font color="#000000"> theta (</font><font color="#660096">atan</font><font color="#000000"> (mass </font><font color="#660096">*</font><font color="#000000"> vy) (mass </font><font color="#660096">*</font><font color="#000000"> vx)) </font><font color="#660096">-</font><font color="#000000"> (</font><font color="#660096">atan</font><font color="#000000"> lever_arm_y lever_arm_x)]
   </font><font color="#0000aa">set</font><font color="#000000"> angular_mom (lever_arm_r </font><font color="#660096">*</font><font color="#000000"> mass </font><font color="#660096">*</font><font color="#000000"> v </font><font color="#660096">*</font><font color="#000000"> (</font><font color="#660096">sin</font><font color="#000000"> theta)) </font><font color="#5a5a5a">; Angular momentum of the turtle</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> update-info                                        </font><font color="#5a5a5a">; Update information from the sliders</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> G Gravitational_Constant
   </font><font color="#0000aa">set</font><font color="#000000"> p Power
   </font><font color="#0000aa">set</font><font color="#000000"> FMAX Force_Maximum
   </font><font color="#0000aa">set</font><font color="#000000"> FR Friction
   </font><font color="#0000aa">set</font><font color="#000000"> DeltaT Time_Step
   </font><font color="#0000aa">set</font><font color="#000000"> D Desired_Separation
   </font><font color="#0000aa">set</font><font color="#000000"> goalF Goal_Force
   </font><font color="#0000aa">set</font><font color="#000000"> obstacleF Obstacle_Force
   </font><font color="#0000aa">set</font><font color="#000000"> goal? goal_button?
   </font><font color="#0000aa">set</font><font color="#000000"> square? square_button?
   </font><font color="#0000aa">ifelse</font><font color="#000000"> square?                                     </font><font color="#5a5a5a">; G phase transition computation, for</font><font color="#000000">
      [</font><font color="#0000aa">set</font><font color="#000000"> Gt (FMAX </font><font color="#660096">*</font><font color="#000000"> (D </font><font color="#660096">^</font><font color="#000000"> p) </font><font color="#660096">/</font><font color="#000000"> ((</font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000">(</font><font color="#963700">2</font><font color="#000000">)) </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">))] </font><font color="#5a5a5a">; square lattice, and for</font><font color="#000000">
      [</font><font color="#0000aa">set</font><font color="#000000"> Gt (FMAX </font><font color="#660096">*</font><font color="#000000"> (D </font><font color="#660096">^</font><font color="#000000"> p) </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000">(</font><font color="#963700">3</font><font color="#000000">)))]       </font><font color="#5a5a5a">; triangular lattice (see Chapter 3 for details)</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> Gf ((G </font><font color="#660096">*</font><font color="#000000"> heavy) </font><font color="#660096">/</font><font color="#000000"> (D </font><font color="#660096">^</font><font color="#000000"> p))                     </font><font color="#5a5a5a">; Need to pull away from a disabled particle,</font><font color="#000000">
   </font><font color="#0000aa">if</font><font color="#000000"> (Gf </font><font color="#660096">&gt;</font><font color="#000000"> FMAX) [</font><font color="#0000aa">set</font><font color="#000000"> Gf FMAX]                       </font><font color="#5a5a5a">; but we still need to think about FMAX</font><font color="#000000">
   </font><font color="#0000aa">ask</font><font color="#000000"> obstacles [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000"> (</font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> obstacleF)]           </font><font color="#5a5a5a">; Update obstacle size if necessary</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> do-plots
   </font><font color="#0000aa">set-current-plot</font><font color="#000000"> </font><font color="#963700">&quot;Linear and Angular Momenta&quot;</font><font color="#000000">      </font><font color="#5a5a5a">; Select the Momenta plot</font><font color="#000000">
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;Lmx&quot;</font><font color="#000000">                         </font><font color="#5a5a5a">; Select the Lmx pen</font><font color="#000000">
   </font><font color="#0000aa">plot</font><font color="#000000"> total_lmx                                     </font><font color="#5a5a5a">; Plot the linear momentum, x-component</font><font color="#000000">
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;Lmy&quot;</font><font color="#000000">
   </font><font color="#0000aa">plot</font><font color="#000000"> total_lmy                                     </font><font color="#5a5a5a">; Plot the linear momentum, y-component</font><font color="#000000">
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;Angular&quot;</font><font color="#000000">
   </font><font color="#0000aa">plot</font><font color="#000000"> total_angular_mom                             </font><font color="#5a5a5a">; Plot the angular momentum</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">; Kill a particle</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> one-dies
   </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">count</font><font color="#000000"> (particles </font><font color="#660096">with</font><font color="#000000"> [mass </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">]) </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) [       </font><font color="#5a5a5a">; Don't kill last particle</font><font color="#000000">
      </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">one-of</font><font color="#000000"> particles </font><font color="#660096">with</font><font color="#000000"> [mass </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">] [</font><font color="#0000aa">die</font><font color="#000000">]      </font><font color="#5a5a5a">; Ask one particle to die</font><font color="#000000">
      </font><font color="#0000aa">clear-drawing</font><font color="#000000">                                   </font><font color="#5a5a5a">; A little cleanup is required</font><font color="#000000">
   ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">; Disable a particle by giving it a heavy mass so it can't move</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> one-is-disabled
   </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">count</font><font color="#000000"> (particles </font><font color="#660096">with</font><font color="#000000"> [mass </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">]) </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) [       
      </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">one-of</font><font color="#000000"> particles </font><font color="#660096">with</font><font color="#000000"> [mass </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">]
         [</font><font color="#0000aa">set</font><font color="#000000"> mass heavy </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">violet</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> disabled disabled </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">]
      ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">; Create a new particle</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> one-is-born
   </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">count</font><font color="#000000"> (particles </font><font color="#660096">with</font><font color="#000000"> [mass </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">]) </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) [ 
      </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">one-of</font><font color="#000000"> particles </font><font color="#660096">with</font><font color="#000000"> [mass </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">]
         [</font><font color="#0000aa">hatch</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> deltax </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> deltay </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">pd</font><font color="#000000">       </font><font color="#5a5a5a">; Clone an existing particle </font><font color="#000000">
                   </font><font color="#0000aa">ifelse</font><font color="#000000"> ((</font><font color="#660096">who</font><font color="#000000"> </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">) </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) 
                     [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">white</font><font color="#000000">] 
                     [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">yellow</font><font color="#000000">]               </font><font color="#5a5a5a">; Different colors for square formations</font><font color="#000000">
                   </font><font color="#0000aa">setxy</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> (</font><font color="#660096">random-normal</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> (D </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">)) 
                         </font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> (</font><font color="#660096">random-normal</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> (D </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">))]]
   ] 
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">; Toggle between triangular and square formations</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> toggle-formation
  </font><font color="#0000aa">if</font><font color="#000000"> (square_button? </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) [</font><font color="#0000aa">set</font><font color="#000000"> square_button? </font><font color="#660096">not</font><font color="#000000"> square_button?]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">; Toggle the goal</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> toggle-goal
  </font><font color="#0000aa">if</font><font color="#000000"> (goal_button? </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) [</font><font color="#0000aa">set</font><font color="#000000"> goal_button? </font><font color="#660096">not</font><font color="#000000"> goal_button?]
</font><font color="#007f69">end</font><font color="#000000">

  
</font>
</pre>

</body>
</html>
