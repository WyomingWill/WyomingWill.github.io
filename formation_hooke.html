<html>
<head>
<title>formation_hooke</title>
<style type="text/css">
<!--
/*
    This style sheet is borrowed from the NetLogo User Manual.  However, some of the units were
    changed from em to px because Java's StyleSheet support is limited for relative units such as
    em and % (this will supposively improve with newer versions of the VM) - jrn 7/21/05
    BE VERY VERY CAREFUL when you alter this style sheet -- it's possible to put in
    innocent-looking things that work on some VM's but cause Java exceptions on other for example
    we were using "font-size: 125%" but it caused Java exceptions on Java 1.5 on Windows - ST
    8/25/05
*/
:link { color: rgb(110,0,110); }
:visited { color: rgb(110,0,110); }
body {
    margin-left: 5px;
    font-family: arial, sans-serif;
    background: white;
    font-size: 12pt
}
h1 {
    color: white;
    background: rgb(45,0,45);
    font-size: 18pt;
    margin-bottom: 4px;
    padding-left: 6px;
    padding-right: 6px;
    padding-top: 6px;
    padding-bottom: 6px;
}
h2 {
    margin-top: 15px;
    margin-left: 6px;
    margin-bottom: 4px;
    background: rgb(166,172,255);
    font-size: 15pt;
    padding-left: 6px;
    padding-right: 6px;
    padding-top: 6px;
    padding-bottom: 6px;
}
h3 {
    margin-top: 15px;
    margin-left: 13px;
    margin-bottom: 4px;
    background: rgb(175,175,175);
    font-size: 12pt;
    padding: 0.2em;
    padding-left: 6px;
    padding-right: 6px;
    padding-top: 6px;
    padding-bottom: 6px;
}
h4 {
    margin-top: 15px;
    margin-bottom: 5px;
    margin-left: 15px;
    font-size: 12pt;
}
h5 {
    margin-top: 15px;
    margin-left: 15px;
    font-size: 12pt;
}
h6 {
    margin-top: 15px;
    margin-left: 15px;
    font-size: 12pt;
}
p {
    margin-left: 15px;
    margin-bottom: 3px;
}
pre {
    margin-left: 13px;
    background: rgb(225,225,225);
    font-family: monospace;
    font-size: 12pt;
    padding-left: 10px;
    padding-right: 3px;
    padding-top: 7px;
    padding-bottom: 7px;
    margin-top:9px;
    margin-bottom:0px;
}
code {
    font-family: monospace;
    font-size: 12pt;
}
blockquote {
    border: solid;
    border-style: solid;
    border-width: thin;
    border-color: black;
    background: rgb(250,250,220);
    padding-top: 0px;
    padding-bottom: 7px;
    margin-top: 7px;
    margin-bottom:1px;
}
ol {
   margin-bottom:1px;
}
ul {
   margin-bottom:1px;
}

-->
</style>
</head>
<body>

<p>This page was automatically generated by NetLogo 5.0.</p>

<p>The applet requires Java 5 or higher.
Java must be enabled in your browser settings.
Mac users must have Mac OS X 10.4 or higher.
Windows and Linux users may obtain the latest Java from
<a href="http://java.sun.com/getjava/download.html">Sun's Java site</a>.</p>

<p><hr>

<applet code="org.nlogo.lite.Applet"
        archive="NetLogoLite.jar"
        width="733" height="643">
  <param name="DefaultModel"
         value="formation_hooke.nlogo">
  <param name="java_arguments"
         value="-Djnlp.packEnabled=true">
</applet>
</p>

<p>powered by
<a target="_blank" href="http://ccl.northwestern.edu/netlogo/">NetLogo</a></p>

<p>view/download model file:
<a href="formation_hooke.nlogo">formation_hooke.nlogo</a></p>
<h2>WHAT IS IT?</h2><p>This is our first physics-based model of a swarm, for the book entitled &ldquo;Physicomimetics: Physics-Based Swarm Intelligence.&rdquo;</p><h2>HOW IT WORKS</h2><p>Multiple particles use F = ma and Hooke&rsquo;s law to self-organize into a triangular lattice.</p><h2>HOW TO USE IT</h2><p>Click SETUP AGENTS to initialize the particles, and click MOVE AGENTS to have them move.</p><p>The CLEAR button will clear the graphics, which becomes handy when particles have their pens down (more on this below).</p><p>The NUMBER_OF_PARTICLES slider allows you to control the number of particles created at initialization. Changing this slider while the simulation is running will have no effect. You can change the number of particles while the simulation is running by using the ONE IS BORN and KILL ONE buttons. However, the ONE IS BORN and KILL ONE buttons do not change the number of initial particles when the simulation is restarted by clicking SETUP AGENTS.</p><p>The ONE IS BORN button creates a new particle.</p><p>The KILL ONE button randomly kills an existing particle. </p><p>All other sliders will affect the simulation when it is running.</p><h2>THINGS TO NOTICE</h2><p>Particles are initialized in a random cluster in the middle of the graphics pane, and self-organize into a triangular lattice. The lattice is not perfect, but that is OK because we are interested in &ldquo;satisficing systems,&rdquo; as opposed to &ldquo;optimal systems.&rdquo;</p><p>The SPRING_CONSTANT controls the stiffness of the springs that connect all pairs of particles that are within sensor range. The DESIRED_SEPARATION is the same as the desired spring length between particles.</p><p>Unlike the prior models, FRICTION is enabled by default. This allows the system to stabilize.</p><p>This simulation serves to teach you about physics-based swarms, as well as the Conservation of Linear and Angular Momenta. This is covered in detail in Chapter 3 of the book. </p><p>The red dot in the simulation shows the center of mass of the system. If the Conservation of Linear Momentum holds in both the x- and y-dimensions, the red dot will not move. This simulation includes a monitor for the Angular Momentum and you will see that it does not change over time, if the system is closed.</p><p>This model allows you to add and remove particles. Removing particles allows you to test how robust the system is to particle failure. Adding particles allows you to see how scalable the system is, and illustrates just how nicely new particles are incorporated into the lattice. Adding and removing particles opens the system, and temporary changes in the momenta can occur during those events.</p><p>Although it doesn&rsquo;t look like the linear momentum is shown on the graph, this is because it is overdrawn by the angular momentum curve. If you slow the simulation down (with the speed slider) and add a particle, you will usually see all three curves.</p><h2>THINGS TO TRY</h2><p>See how the FRICTION changes behavior. Click SETUP AGENTS, lower the friction, and click MOVE AGENTS. What happens? </p><p>Similarly, change the SPRING_CONSTANT.</p><p>Change the DESIRED_SEPARATION while the system is running. Try changing it slowly and then change it quickly. What happens?</p><p>Add and remove particles.</p><p>Set the NUMBER_OF_PARTICLES to five and maximize the other sliders (slide them to the right). Also, increase the speed with the speed slider at the top of the simulation. What happens? Why does it happen? You may need to try this a couple of times to get a connected formation with all five particles. What if only four particles are used?</p><h2>EXTENDING THE MODEL</h2><p>In this model all particles have the same mass. What happens if particles have different masses? </p><p>What happens when you change the sensor view?</p><p>What happens if you change the force law?</p><p>Note, in order to change any NetLogo simulation, you must have the source code (i.e., &ldquo;formation_hooke.nlogo&rdquo;) downloaded to your computer, as well as NetLogo itself. You can not change the code when you are running the simulation with your browser.</p><h2>NETLOGO FEATURES</h2><p>This simulation allows the user to create new particles and kill existing ones. </p><p>Killing a particle is accomplished via a call to the NetLogo procedure &ldquo;die.&rdquo; </p><p>To create a particle, the &ldquo;hatch&rdquo; command is used - this clones an existing particle and moves it away from the original. Also, the new particle has the &ldquo;pen down,&rdquo; which means that you will see the path that the particle takes. If the graphics pane becomes too busy, click on the CLEAR button.</p><h2>RELATED MODELS</h2><p>This is our first physics-based swarm simulation. However, it builds naturally on our early two-particle physics models from Chapter 2.</p><h2>CREDITS AND REFERENCES</h2><h2>HOW TO CITE</h2><p>If you mention this model in an academic publication, we ask that you include these citations for the model itself and for the NetLogo software:<br/>- Spears, William M. and Spears, Diana F. (eds.) Physicomimetics: Physics-Based Swarm Intelligence, Springer-Verlag, (2011).<br/>- Wilensky, U. (1999). NetLogo. <a href="http://ccl.northwestern.edu/netlogo/">http://ccl.northwestern.edu/netlogo/</a>. Center for Connected Learning and Computer-Based Modeling, Northwestern University, Evanston, IL.</p><h2>COPYRIGHT NOTICE</h2><p>Copyright 2011 William M. Spears. All rights reserved.</p><p>Permission to use, modify or redistribute this model is hereby granted, provided that both of the following requirements are followed:<br/>a) this copyright notice is included, and<br/>b) this model will not be redistributed for profit without permission from William M. Spears. Contact William M. Spears for appropriate licenses for redistribution for profit.</p><p><a href="http://www.swarmotics.com">http://www.swarmotics.com</a></p>

<h1>CODE</h1>
<pre><font color="#5a5a5a">; William M. Spears September 2011</font><font color="#000000">
</font><font color="#5a5a5a">; Triangular Lattice using Hooke's Law Tutorial Code</font><font color="#000000">
</font><font color="#5a5a5a">; For research and educational use only</font><font color="#000000">

</font><font color="#660096">breed</font><font color="#000000"> [particles particle]                        </font><font color="#5a5a5a">; Introduce the &quot;particle&quot; breed</font><font color="#000000">

</font><font color="#007f69">globals</font><font color="#000000"> [total_lmx total_lmy total_angular_mom k FR D
         center_of_mass_x center_of_mass_y FMAX DeltaT]

</font><font color="#007f69">turtles-own</font><font color="#000000"> [hood deltax deltay r F Fx Fy v vx vy dvx dvy mass
             lmx lmy theta lever_arm_x lever_arm_y lever_arm_r angular_mom]

</font><font color="#007f69">to</font><font color="#000000"> setup
   </font><font color="#0000aa">clear-all</font><font color="#000000">                                      </font><font color="#5a5a5a">; Clear everything</font><font color="#000000">
                                                  </font><font color="#5a5a5a">; Create and initialize particles</font><font color="#000000">
   create-particles Number_of_Particles [setup-particles]
   update-info
                                                  </font><font color="#5a5a5a">; Computes center of mass and displays location</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> center_of_mass_x (</font><font color="#660096">sum</font><font color="#000000"> [</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> mass] </font><font color="#660096">of</font><font color="#000000"> particles) </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#660096">sum</font><font color="#000000"> [mass] </font><font color="#660096">of</font><font color="#000000"> particles)
   </font><font color="#0000aa">set</font><font color="#000000"> center_of_mass_y (</font><font color="#660096">sum</font><font color="#000000"> [</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> mass] </font><font color="#660096">of</font><font color="#000000"> particles) </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#660096">sum</font><font color="#000000"> [mass] </font><font color="#660096">of</font><font color="#000000"> particles)
   </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patch</font><font color="#000000"> (</font><font color="#660096">round</font><font color="#000000"> center_of_mass_x) (</font><font color="#660096">round</font><font color="#000000"> center_of_mass_y)
      [</font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">in-radius</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000">]]
   </font><font color="#0000aa">reset-ticks</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> run-and-monitor
   </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) [</font><font color="#0000aa">user-message</font><font color="#000000"> </font><font color="#963700">&quot;Please click HALT and then SETUP AGENTS first&quot;</font><font color="#000000"> </font><font color="#0000aa">stop</font><font color="#000000">]
   update-info
   </font><font color="#0000aa">ask</font><font color="#000000"> particles [ap-particles]
   </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> [move]
                                                  </font><font color="#5a5a5a">; Computes center of mass and displays location</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> center_of_mass_x (</font><font color="#660096">sum</font><font color="#000000"> [</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> mass] </font><font color="#660096">of</font><font color="#000000"> particles) </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#660096">sum</font><font color="#000000"> [mass] </font><font color="#660096">of</font><font color="#000000"> particles)
   </font><font color="#0000aa">set</font><font color="#000000"> center_of_mass_y (</font><font color="#660096">sum</font><font color="#000000"> [</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> mass] </font><font color="#660096">of</font><font color="#000000"> particles) </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#660096">sum</font><font color="#000000"> [mass] </font><font color="#660096">of</font><font color="#000000"> particles)
   </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patch</font><font color="#000000"> (</font><font color="#660096">round</font><font color="#000000"> center_of_mass_x) (</font><font color="#660096">round</font><font color="#000000"> center_of_mass_y)
      [</font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">in-radius</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000">]]

   </font><font color="#0000aa">set</font><font color="#000000"> total_lmx </font><font color="#660096">sum</font><font color="#000000"> [lmx] </font><font color="#660096">of</font><font color="#000000"> particles           </font><font color="#5a5a5a">; Total linear momentum, x-component</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> total_lmy </font><font color="#660096">sum</font><font color="#000000"> [lmy] </font><font color="#660096">of</font><font color="#000000"> particles           </font><font color="#5a5a5a">; Total linear momentum, y-component</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> total_angular_mom </font><font color="#660096">sum</font><font color="#000000"> [angular_mom] </font><font color="#660096">of</font><font color="#000000"> particles
   </font><font color="#0000aa">tick</font><font color="#000000">
   do-plots
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> setup-particles                                </font><font color="#5a5a5a">; Set up the particles</font><font color="#000000">
   </font><font color="#0000aa">setxy</font><font color="#000000"> (</font><font color="#660096">random-normal</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">20.0</font><font color="#000000">) 
         (</font><font color="#660096">random-normal</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">20.0</font><font color="#000000">)                   </font><font color="#5a5a5a">; Start in a cluster</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">heading</font><font color="#000000"> </font><font color="#660096">random</font><font color="#000000"> </font><font color="#963700">360</font><font color="#000000">                         </font><font color="#5a5a5a">; Everyone has a random heading</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> vx </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> vy </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> mass </font><font color="#963700">1</font><font color="#000000">                   </font><font color="#5a5a5a">; Start with no motion and mass = 1</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">white</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> </font><font color="#963700">&quot;circle&quot;</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000"> </font><font color="#963700">5</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> theta </font><font color="#963700">0</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> ap-particles                                   </font><font color="#5a5a5a">; Run artificial physics</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> Fx </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> Fy </font><font color="#963700">0</font><font color="#000000">                              </font><font color="#5a5a5a">; Initialize force components to zero</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> vx (</font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> FR) </font><font color="#660096">*</font><font color="#000000"> vx                           </font><font color="#5a5a5a">; Slow down according to friction</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> vy (</font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> FR) </font><font color="#660096">*</font><font color="#000000"> vy
   
   </font><font color="#0000aa">set</font><font color="#000000"> hood [</font><font color="#660096">who</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">other</font><font color="#000000"> particles              </font><font color="#5a5a5a">; Get the IDs of your neighbors</font><font color="#000000">
   </font><font color="#0000aa">foreach</font><font color="#000000"> hood [         
      </font><font color="#0000aa">set</font><font color="#000000"> deltax (([</font><font color="#660096">xcor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> particle ?) </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000">) 
      </font><font color="#0000aa">if</font><font color="#000000"> ((</font><font color="#660096">abs</font><font color="#000000"> deltax) </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">1.5</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> D) [               </font><font color="#5a5a5a">; Speed improvement for the code</font><font color="#000000">
         </font><font color="#0000aa">set</font><font color="#000000"> deltay (([</font><font color="#660096">ycor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> particle ?) </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000">) 
         </font><font color="#0000aa">set</font><font color="#000000"> r </font><font color="#660096">sqrt</font><font color="#000000"> (deltax </font><font color="#660096">*</font><font color="#000000"> deltax </font><font color="#660096">+</font><font color="#000000"> deltay </font><font color="#660096">*</font><font color="#000000"> deltay)
         </font><font color="#0000aa">if</font><font color="#000000"> (r </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">1.5</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> D) [
            </font><font color="#0000aa">set</font><font color="#000000"> F (k </font><font color="#660096">*</font><font color="#000000"> (r </font><font color="#660096">-</font><font color="#000000"> D))                   </font><font color="#5a5a5a">; The spring law</font><font color="#000000">
            </font><font color="#0000aa">if</font><font color="#000000"> (F </font><font color="#660096">&gt;</font><font color="#000000"> FMAX) [</font><font color="#0000aa">set</font><font color="#000000"> F FMAX]            </font><font color="#5a5a5a">; Bounds check on force magnitude</font><font color="#000000">
            </font><font color="#0000aa">set</font><font color="#000000"> Fx (Fx </font><font color="#660096">+</font><font color="#000000"> F </font><font color="#660096">*</font><font color="#000000"> (deltax </font><font color="#660096">/</font><font color="#000000"> r))        </font><font color="#5a5a5a">; The x-component of force</font><font color="#000000">
            </font><font color="#0000aa">set</font><font color="#000000"> Fy (Fy </font><font color="#660096">+</font><font color="#000000"> F </font><font color="#660096">*</font><font color="#000000"> (deltay </font><font color="#660096">/</font><font color="#000000"> r))        </font><font color="#5a5a5a">; The y-component of force</font><font color="#000000">
         ]
      ]
   ]
   
   </font><font color="#0000aa">set</font><font color="#000000"> dvx DeltaT </font><font color="#660096">*</font><font color="#000000"> (Fx </font><font color="#660096">/</font><font color="#000000"> mass)
   </font><font color="#0000aa">set</font><font color="#000000"> dvy DeltaT </font><font color="#660096">*</font><font color="#000000"> (Fy </font><font color="#660096">/</font><font color="#000000"> mass)
   </font><font color="#0000aa">set</font><font color="#000000"> vx  (vx </font><font color="#660096">+</font><font color="#000000"> dvx)                             </font><font color="#5a5a5a">; The x-component of velocity</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> vy  (vy </font><font color="#660096">+</font><font color="#000000"> dvy)                             </font><font color="#5a5a5a">; The y-component of velocity</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> v </font><font color="#660096">sqrt</font><font color="#000000"> (vx </font><font color="#660096">*</font><font color="#000000"> vx </font><font color="#660096">+</font><font color="#000000"> vy </font><font color="#660096">*</font><font color="#000000"> vy)

   </font><font color="#0000aa">set</font><font color="#000000"> deltax DeltaT </font><font color="#660096">*</font><font color="#000000"> vx
   </font><font color="#0000aa">set</font><font color="#000000"> deltay DeltaT </font><font color="#660096">*</font><font color="#000000"> vy 
   </font><font color="#0000aa">if</font><font color="#000000"> ((deltax </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (deltay </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">)) 
      [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">heading</font><font color="#000000"> (</font><font color="#660096">atan</font><font color="#000000"> deltax deltay)] 
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> move                                           </font><font color="#5a5a5a">; Move the turtle</font><font color="#000000">
   </font><font color="#0000aa">fd</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000"> (deltax </font><font color="#660096">*</font><font color="#000000"> deltax </font><font color="#660096">+</font><font color="#000000"> deltay </font><font color="#660096">*</font><font color="#000000"> deltay)

   </font><font color="#0000aa">set</font><font color="#000000"> lmx (mass </font><font color="#660096">*</font><font color="#000000"> vx)                            </font><font color="#5a5a5a">; Linear momentum of the turtle</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> lmy (mass </font><font color="#660096">*</font><font color="#000000"> vy)
   
   </font><font color="#0000aa">set</font><font color="#000000"> lever_arm_x (</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> center_of_mass_x)
   </font><font color="#0000aa">set</font><font color="#000000"> lever_arm_y (</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> center_of_mass_y)
   </font><font color="#0000aa">set</font><font color="#000000"> lever_arm_r </font><font color="#660096">sqrt</font><font color="#000000"> (lever_arm_x </font><font color="#660096">*</font><font color="#000000"> lever_arm_x </font><font color="#660096">+</font><font color="#000000"> lever_arm_y </font><font color="#660096">*</font><font color="#000000"> lever_arm_y)
   </font><font color="#0000aa">if</font><font color="#000000"> (((vx </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (vy </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">)) </font><font color="#660096">and</font><font color="#000000"> ((lever_arm_x </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (lever_arm_y </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">))) 
      [</font><font color="#0000aa">set</font><font color="#000000"> theta (</font><font color="#660096">atan</font><font color="#000000"> (mass </font><font color="#660096">*</font><font color="#000000"> vy) (mass </font><font color="#660096">*</font><font color="#000000"> vx)) </font><font color="#660096">-</font><font color="#000000"> (</font><font color="#660096">atan</font><font color="#000000"> lever_arm_y lever_arm_x)]
   </font><font color="#0000aa">set</font><font color="#000000"> angular_mom (lever_arm_r </font><font color="#660096">*</font><font color="#000000"> mass </font><font color="#660096">*</font><font color="#000000"> v </font><font color="#660096">*</font><font color="#000000"> (</font><font color="#660096">sin</font><font color="#000000"> theta)) </font><font color="#5a5a5a">; Angular momentum of the turtle</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> update-info                                    </font><font color="#5a5a5a">; Update information from the sliders</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> k Spring_Constant
   </font><font color="#0000aa">set</font><font color="#000000"> FMAX Force_Maximum
   </font><font color="#0000aa">set</font><font color="#000000"> FR Friction
   </font><font color="#0000aa">set</font><font color="#000000"> DeltaT Time_Step
   </font><font color="#0000aa">set</font><font color="#000000"> D Desired_Separation
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> do-plots
   </font><font color="#0000aa">set-current-plot</font><font color="#000000"> </font><font color="#963700">&quot;Linear and Angular Momenta&quot;</font><font color="#000000">  </font><font color="#5a5a5a">; Select the Momenta plot</font><font color="#000000">
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;Lmx&quot;</font><font color="#000000">                     </font><font color="#5a5a5a">; Select the Lmx pen</font><font color="#000000">
   </font><font color="#0000aa">plot</font><font color="#000000"> total_lmx                                 </font><font color="#5a5a5a">; Plot the linear momentum, x-component</font><font color="#000000">
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;Lmy&quot;</font><font color="#000000">
   </font><font color="#0000aa">plot</font><font color="#000000"> total_lmy                                 </font><font color="#5a5a5a">; Plot the linear momentum, y-component</font><font color="#000000">
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;Angular&quot;</font><font color="#000000">
   </font><font color="#0000aa">plot</font><font color="#000000"> total_angular_mom                         </font><font color="#5a5a5a">; Plot the angular momentum</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">; Kill a particle</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> one-dies
   </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">count</font><font color="#000000"> (particles </font><font color="#660096">with</font><font color="#000000"> [mass </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">]) </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) [   </font><font color="#5a5a5a">; Don't kill last particle</font><font color="#000000">
      </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">one-of</font><font color="#000000"> particles </font><font color="#660096">with</font><font color="#000000"> [mass </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">] [</font><font color="#0000aa">die</font><font color="#000000">]  </font><font color="#5a5a5a">; Ask one particle to die</font><font color="#000000">
      </font><font color="#0000aa">clear-drawing</font><font color="#000000">                               </font><font color="#5a5a5a">; A little cleanup is required</font><font color="#000000">
   ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">; Create a new particle</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> one-is-born
   </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">count</font><font color="#000000"> (particles </font><font color="#660096">with</font><font color="#000000"> [mass </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">]) </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) [ 
      </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">one-of</font><font color="#000000"> particles </font><font color="#660096">with</font><font color="#000000"> [mass </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">]
         [</font><font color="#0000aa">hatch</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> deltax </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> deltay </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">pd</font><font color="#000000">   </font><font color="#5a5a5a">; Clone an existing particle</font><font color="#000000">
                   </font><font color="#0000aa">setxy</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> (</font><font color="#660096">random-normal</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> (D </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">)) 
                         </font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> (</font><font color="#660096">random-normal</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> (D </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">))]]
   ] 
</font><font color="#007f69">end</font>
</pre>

</body>
</html>
