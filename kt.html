<html>
<head>
<title>kt</title>
<style type="text/css">
<!--
  :link { color: rgb(110, 0, 110); } 
  :visited { color: rgb(110, 0, 110); } 
  body { margin-left: 5px; font-family: arial, sans-serif; 
         background: white; font-size: 12pt } 
  h2 { background: rgb(166,172,255); 
       font-size: 15pt; 
       padding-left: 6px; padding-right: 6px; padding-top: 6px; 
       padding-bottom: 6px; } 
  p { margin-left: 10px; } 
  pre { margin-left: 13px; background: rgb(225,225,225); 
        font-family: monospace; padding-left: 3px; padding-right: 3px; 
        padding-top: 3px; padding-bottom: 3px; } 
-->
</style>
</head>
<body>

<p>This page was automatically generated by NetLogo 4.1.3.</p>

<p>The applet requires Java 5 or higher.
Java must be enabled in your browser settings.
Mac users must have Mac OS X 10.4 or higher.
Windows and Linux users may obtain the latest Java from
<a href="http://java.sun.com/getjava/download.html">Sun's Java site</a>.</p>

<p>
<applet code="org.nlogo.lite.Applet"
        archive="NetLogoLite.jar,array/array.jar"
        width="940" height="561">
  <param name="DefaultModel"
         value="kt.nlogo">
</applet>
</p>

<p>powered by
<a target="_blank" href="http://ccl.northwestern.edu/netlogo/">NetLogo</a></p>

<p>view/download model file:
<a href="kt.nlogo">kt.nlogo</a>
</p>
<h2>WHAT IS IT?</h2>
<p>This is a model of a physics-based approach to provide a &quot;sweep&quot; of a region.  The goal is to sweep a large group of robots through a long bounded region. This is especially useful for de-mining, searching for survivors after a disaster, and for robot sentries. </p>
<p>We use a very different form of physicomimetics, based on &quot;kinetic theory.&quot; In kinetic theory, particles are treated as possessing no potential energy. The system consists entirely of kinetic energy. In fact, kinetic theory does not typically deal with forces at all. Instead, increases in particle velocity are modeled as being caused by collisions and/or a system temperature increase. This is very different from the F = ma physics systems that we have examined earlier.</p>
<p>Our region is very simple - it is a vertical corridor. In the model, we treat the left boundary as an infinite-length wall that moves down, whereas the right boundary is an infinite-length wall that moves up. This creates an interesting sweep, where one-half of the corridor is swept in one direction while the other half is swept in the other direction. Chapter 4 discusses this particlar simulation in more detail. Chapter 7 provides a more sophisticated version of the simulator in which both walls move in the same direction and robots are modeled realistically.  Chapter 7 also provides experimental and theoretical results.</p>
<p>Kinetic theory is a stochastic approach.   The focus is on obtaining desirable bulk movement of the swarm. The movements of the individual agents are probabilistic and therefore unpredictable.  This is desirable for applications where stealth is required.</p><br>
<h2>HOW IT WORKS</h2>
<p>If an agent senses another agent nearby, they both respond as if a virtual collision has occurred. If an agent senses a wall nearby, it changes its velocity in response to the virtual motion of the wall.  In addition, the temperature T of the walls adds kinetic energy to the particles.</p><br>
<h2>HOW TO USE IT</h2>
<p>Click SETUP AGENTS to initialize the particles, and click MOVE AGENTS to have them move.</p>
<p>The NUMBER_OF_PARTICLES slider allows you to control the number of particles created at initialization. Changing this slider while the simulation is running will have no effect.</p>
<p>Two sliders affect the simulation when it is running.  The WALL_VELOCITY slider controls the velocity of both walls (i.e., the left wall moves down with velocity WALL_VELOCITY, and the right wall moves up with velocity WALL_VELOCITY). The TEMPERATURE slider controls the temperature T of both walls.</p>
<p>Two monitors show the x- and y-components of the linear momentum. These should remain close to zero because the particles are stationary when initialized, and kinetic theory conserves linear momentum.</p>
<p>A histogram shows the velocity distribution of the particles. The corridor is broken into<br>13 vertical columns, and the histogram shows 13 bars that indicate the average velocity of the particles in each column. The leftmost bar gives the average velocity in the leftmost column, and the rightmost bar gives the average velocity in the rightmost column.  Since there is an odd number of columns, the central bar reflects the average velocity in the center column.</p>
<p>The velocity distribution is averaged during the running of the simulation.  If you click RESAMPLE, the previous data is thrown away and the averages are (re-)computed using the data accumulated after RESAMPLE is clicked. Hence, the averages will fluctuate until enough new samples are accumulated.</p>
<p>Two additional monitors give quantitative information about the bars of the histogram. One monitor shows the slope of the bars.  The other monitor gives the correlation coefficient - the maximum value is 1.0, indicating that the height of the bars has a relationship that is predicted by theory (see Chapters 4 and 7 for specifics).</p>
<p>Once you understand the behavior of the particles, it is generally a good idea to speed up the simulation by moving the speed slider (at the top) to the right. </p><br>
<h2>THINGS TO NOTICE</h2>
<p>After running the simulation for a while, what does the histogram look like?   Can you guess why it has this particular form?  Try guessing first, and then read Chapter 4 (or Chapter 7) to find the mathematical formula for the velocity distribution.  </p>
<p>Both the WALL_VELOCITY and the wall TEMPERATURE are controllable by sliders.  These parameters control the bulk movement of the robotic swarm.</p>
<p>Recall that a kinetic theory approach conserves linear momentum.  The book explains how collisions are implemented in a way that ensures this conservation.</p><br>
<h2>THINGS TO TRY</h2>
<p>Trying running the simulation with 100 agents and try running with 1000 agents. What<br>difference does this make in the behavior?</p>
<p>Change the WALL_VELOCITY. For an extreme case, set it to zero.</p>
<p>Change the TEMPERATURE.</p>
<p>How do these changes (of the WALL_VELOCITY and TEMPERATURE, going from low to high values) affect behavior?  Can you explain the differences in swarm behavior?</p>
<p>Try a wide variety of parameter settings and see if you can predict how the settings will affect the shape and slope of the histogram.</p>
<p>Figure out which parameter (slider) settings provide better horizontal corridor coverage, and which provide better vertical corridor coverage.   How would you recommend balancing the two?  Can you derive a formula for doing this?</p><br>
<h2>EXTENDING THE MODEL</h2>
<p>Try adding obstacles, including obstacles of difference sizes and shapes.  Observe what happens in the &quot;shadow regions&quot; (see Chapter 7) as you vary the parameters.   Find the best settings for shadow region coverage, and determine how that affects the vertical and horizontal coverage of the corridor.</p>
<p>Create a button to add agents and a button to remove agents (you can get the code from prior simulations). Does the bulk swarm behavior change when you add or remove agents?  If yes, how?</p>
<p>For a more challenging project, invent a hybrid physicomimetic algorithm consisting of both forces and collisions.  Normal movement is driven by forces, whereas collisions are used to drive the particles out of enclosing &quot;traps.&quot;   Start with code such as &quot;formation_lj_goal_obs.nlogo&quot; and add in some of the code from &quot;kt.nlogo&quot; as appropriate.  Note that you will have to add software procedures for an agent to detect when it is trapped and then to switch from forces to collisions (e.g., by raising the wall TEMPERATURE inside a cul-de-sac) to pop out of the &quot;trap.&quot;</p>
<p>In order to change any NetLogo simulation, you must have the source code (i.e., &quot;kt.nlogo&quot;) downloaded to your computer, as well as NetLogo itself. You can not change the code when you are running the simulation with your browser.</p><br>
<h2>NETLOGO FEATURES</h2>
<p>The &quot;extensions[array]&quot; command adds the ability to use arrays in NetLogo. An array is used to compute the velocity distribution for the thirteen columns in the environment.</p>
<p>The &quot;do-plot&quot; procedure provides extensive detail on how to create a very useful histogram.</p><br>
<h2>CREDITS AND REFERENCES</h2>
<p>Spears, D. F., Kerr, W., and Spears, W. M. (2009) Fluid-like swarms with predictable macroscopic behavior. Lecture Notes in Computer Science, Volume 4324.</p>
<p>Spears, D. F., Kerr, W., and Spears, W. M. (2006) Physics-based robot swarms for coverage problems. International Journal on Intelligent Control and Systems, 11(3).</p>
<p>Kerr, W. and Spears, D. F. (2005) Robotic simulation of gases for a surveillance task. In Proceedings of the IEEE/RSJ International Conference on Intelligent Robots and Systems.</p>
<p>Garcia, A. (2000) Numerical Methods for Physics, Second Edition.  New Jersey: Prentice Hall.  </p><br>
<h2>HOW TO CITE</h2>
<p>If you mention this model in an academic publication, we ask that you include these citations for the model itself and for the NetLogo software:<br>- Spears, W. M. and Spears, D. F. (eds.) Physicomimetics: Physics-Based Swarm Intelligence, Springer-Verlag, (2011).<br>- Wilensky, U. (1999). NetLogo. <a href="http://ccl.northwestern.edu/netlogo/">http://ccl.northwestern.edu/netlogo/</a>. Center for Connected Learning and Computer-Based Modeling, Northwestern University, Evanston, IL.</p><br>
<h2>COPYRIGHT NOTICE</h2>
<p>Copyright 2011 William M. Spears. All rights reserved.</p>
<p>Permission to use, modify or redistribute this model is hereby granted, provided that both of the following requirements are followed: <br>a) this copyright notice is included, and <br>b) this model will not be redistributed for profit without permission from William M. Spears. <br>Contact William M. Spears for appropriate licenses for redistribution for profit.</p>
<p><a href="http://www.swarmotics.com">http://www.swarmotics.com</a></p><br>
<h2>PROCEDURES</h2>
<pre><font color="#5a5a5a">; William M. Spears, Wesley Kerr, and Diana F. Spears, September 2011</font><font color="#000000">
</font><font color="#5a5a5a">; Kinetic Theory Tutorial Code</font><font color="#000000">
</font><font color="#5a5a5a">; Based on code from &quot;Numerical Methods for Physics&quot; by</font><font color="#000000">
</font><font color="#5a5a5a">; Alejandro L. Garcia, 2nd edition, Prentice Hall, 2000.</font><font color="#000000">
</font><font color="#5a5a5a">; Especially see pages 388 and 393 of Garcia for details.</font><font color="#000000">
</font><font color="#5a5a5a">; For research and educational use only</font><font color="#000000">

</font><font color="#007f69">extensions</font><font color="#000000">[array]                                                 </font><font color="#5a5a5a">; This extension adds arrays to NetLogo</font><font color="#000000">
 
</font><font color="#007f69">globals</font><font color="#000000"> [vel_hist slope corr sum_vel sample]                      </font><font color="#5a5a5a">; vel_hist is the velocity distribution histogram</font><font color="#000000">

</font><font color="#007f69">turtles-own</font><font color="#000000"> [v vx vy]   
 
</font><font color="#5a5a5a">; Called by &quot;Setup Agents&quot;</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> setup
   </font><font color="#0000aa">clear-all</font><font color="#000000">                                                      </font><font color="#5a5a5a">; Clear everything</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> sample </font><font color="#963700">0</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> vel_hist </font><font color="#660096">array:from-list</font><font color="#000000"> </font><font color="#660096">n-values</font><font color="#000000"> </font><font color="#963700">13</font><font color="#000000"> [</font><font color="#963700">0</font><font color="#000000">]                   </font><font color="#5a5a5a">; Used to break the environment into 13 columns</font><font color="#000000">

   </font><font color="#0000aa">crt</font><font color="#000000"> Number_of_Particles                                        </font><font color="#5a5a5a">; Create and initialize particles throughout the environment </font><font color="#000000">
      [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">heading</font><font color="#000000"> (</font><font color="#660096">random</font><font color="#000000"> </font><font color="#963700">360</font><font color="#000000">) </font><font color="#0000aa">set</font><font color="#000000"> v (</font><font color="#660096">sqrt</font><font color="#000000"> Temperature) </font><font color="#660096">*</font><font color="#000000"> </font><font color="#963700">1.2533</font><font color="#000000"> </font><font color="#5a5a5a">; Constant is from theory (see Chapter 4)</font><font color="#000000">
       </font><font color="#0000aa">set</font><font color="#000000"> vx (v </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">cos</font><font color="#000000"> </font><font color="#660096">heading</font><font color="#000000">) </font><font color="#0000aa">set</font><font color="#000000"> vy (v </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">sin</font><font color="#000000"> </font><font color="#660096">heading</font><font color="#000000">)
       </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">white</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000"> </font><font color="#963700">1.5</font><font color="#000000"> 
       </font><font color="#0000aa">setxy</font><font color="#000000"> (</font><font color="#963700">7</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">random-xcor</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">8</font><font color="#000000">) (</font><font color="#963700">7</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">random-ycor</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">8</font><font color="#000000">)]

   </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> [setup-patches]                                    </font><font color="#5a5a5a">; Ask patches to initialize two vertical walls</font><font color="#000000">
   setup-plot                                                     </font><font color="#5a5a5a">; Initialize the velocity distribution histogram </font><font color="#000000">
   monitor                                                        </font><font color="#5a5a5a">; Update the information for the histogram</font><font color="#000000">
   compute-stats                                                  </font><font color="#5a5a5a">; Compute slope and correlation coefficient of velocity histogram</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> setup-patches                                                  </font><font color="#5a5a5a">; Setup two vertical walls</font><font color="#000000">
   </font><font color="#0000aa">if</font><font color="#000000"> ((</font><font color="#660096">pxcor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> (</font><font color="#660096">max-pxcor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">)) </font><font color="#660096">or</font><font color="#000000"> (</font><font color="#660096">pxcor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> (</font><font color="#660096">max-pxcor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">)) </font><font color="#660096">or</font><font color="#000000"> (</font><font color="#660096">pxcor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> (</font><font color="#660096">max-pxcor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">))) [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000">]
   </font><font color="#0000aa">if</font><font color="#000000"> ((</font><font color="#660096">pxcor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> (</font><font color="#660096">min-pxcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">)) </font><font color="#660096">or</font><font color="#000000"> (</font><font color="#660096">pxcor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> (</font><font color="#660096">min-pxcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">)) </font><font color="#660096">or</font><font color="#000000"> (</font><font color="#660096">pxcor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> (</font><font color="#660096">min-pxcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">))) [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">yellow</font><font color="#000000">]
</font><font color="#007f69">end</font><font color="#000000">
      
</font><font color="#5a5a5a">; Called forever by &quot;Move Agents&quot;</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> go
   </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) [</font><font color="#0000aa">user-message</font><font color="#000000"> </font><font color="#963700">&quot;Please click HALT and then SETUP AGENTS first&quot;</font><font color="#000000"> </font><font color="#0000aa">stop</font><font color="#000000">]
   
   </font><font color="#0000aa">tick</font><font color="#000000">   
   </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> [go-particles]                                     </font><font color="#5a5a5a">; All particles update their velocity</font><font color="#000000">
   </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> [move]                                             </font><font color="#5a5a5a">; All particles move</font><font color="#000000">
   monitor                                                        </font><font color="#5a5a5a">; Update the information for the histogram </font><font color="#000000">
   do-plot                                                        </font><font color="#5a5a5a">; Redraw the histogram</font><font color="#000000">
   compute-stats                                                  </font><font color="#5a5a5a">; Compute slope and correlation coefficient of velocity histogram</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">
 
</font><font color="#007f69">to</font><font color="#000000"> go-particles  
   </font><font color="#0000aa">let</font><font color="#000000"> friends </font><font color="#660096">other</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#660096">in-radius</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">                          </font><font color="#5a5a5a">; Anyone near you?</font><font color="#000000">
   </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">any?</font><font color="#000000"> friends) [                                            </font><font color="#5a5a5a">; If so, assume a collision</font><font color="#000000">
     </font><font color="#0000aa">let</font><font color="#000000"> friend [</font><font color="#660096">who</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">one-of</font><font color="#000000"> friends                           </font><font color="#5a5a5a">; For details, see Chapter 4 of the book</font><font color="#000000">
     </font><font color="#0000aa">let</font><font color="#000000"> rel_speed </font><font color="#660096">sqrt</font><font color="#000000"> (((vx </font><font color="#660096">-</font><font color="#000000"> ([vx] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">turtle</font><font color="#000000"> friend)) </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> 
                         ((vy </font><font color="#660096">-</font><font color="#000000"> ([vy] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">turtle</font><font color="#000000"> friend)) </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">)))
     </font><font color="#0000aa">let</font><font color="#000000"> cm_vel_x </font><font color="#963700">0.5</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> (vx </font><font color="#660096">+</font><font color="#000000"> ([vx] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">turtle</font><font color="#000000"> friend))
     </font><font color="#0000aa">let</font><font color="#000000"> cm_vel_y </font><font color="#963700">0.5</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> (vy </font><font color="#660096">+</font><font color="#000000"> ([vy] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">turtle</font><font color="#000000"> friend))
     </font><font color="#0000aa">let</font><font color="#000000"> theta (</font><font color="#660096">random</font><font color="#000000"> </font><font color="#963700">360</font><font color="#000000">)
     </font><font color="#0000aa">let</font><font color="#000000"> costh (</font><font color="#660096">cos</font><font color="#000000"> theta)
     </font><font color="#0000aa">let</font><font color="#000000"> sinth (</font><font color="#660096">sin</font><font color="#000000"> theta)
     </font><font color="#0000aa">let</font><font color="#000000"> vrel_x (rel_speed </font><font color="#660096">*</font><font color="#000000"> sinth)
     </font><font color="#0000aa">let</font><font color="#000000"> vrel_y (rel_speed </font><font color="#660096">*</font><font color="#000000"> costh)
     </font><font color="#0000aa">set</font><font color="#000000"> vx (cm_vel_x </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">0.5</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> vrel_x)                             </font><font color="#5a5a5a">; Figure out the new velocities for yourself and your neighbor</font><font color="#000000">
     </font><font color="#0000aa">set</font><font color="#000000"> vy (cm_vel_y </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">0.5</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> vrel_y)
     </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtle</font><font color="#000000"> friend [</font><font color="#0000aa">set</font><font color="#000000"> vx (cm_vel_x </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">0.5</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> vrel_x) 
                        </font><font color="#0000aa">set</font><font color="#000000"> vy (cm_vel_y </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">0.5</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> vrel_y)] 
   ]
                                                                  </font><font color="#5a5a5a">; Compute the effect of the walls on particle velocity</font><font color="#000000">
   </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">any?</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">in-radius</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000">])              </font><font color="#5a5a5a">; The red wall moves up</font><font color="#000000">
      [</font><font color="#0000aa">set</font><font color="#000000"> vx (</font><font color="#660096">-</font><font color="#000000"> (</font><font color="#660096">sqrt</font><font color="#000000"> (</font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> Temperature)) </font><font color="#660096">*</font><font color="#000000"> (</font><font color="#660096">sqrt</font><font color="#000000"> (</font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ln</font><font color="#000000"> (</font><font color="#660096">random-float</font><font color="#000000"> </font><font color="#963700">1.0</font><font color="#000000">))))
       </font><font color="#0000aa">set</font><font color="#000000"> vy (((</font><font color="#660096">random-normal</font><font color="#000000"> </font><font color="#963700">0.0</font><font color="#000000"> </font><font color="#963700">1.0</font><font color="#000000">) </font><font color="#660096">*</font><font color="#000000"> (</font><font color="#660096">sqrt</font><font color="#000000"> Temperature)) </font><font color="#660096">+</font><font color="#000000"> Wall_Velocity)]
   
   </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">any?</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">in-radius</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">yellow</font><font color="#000000">])           </font><font color="#5a5a5a">; The yellow wall moves down</font><font color="#000000">
      [</font><font color="#0000aa">set</font><font color="#000000"> vx ((</font><font color="#660096">sqrt</font><font color="#000000"> (</font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> Temperature)) </font><font color="#660096">*</font><font color="#000000"> (</font><font color="#660096">sqrt</font><font color="#000000"> (</font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ln</font><font color="#000000"> (</font><font color="#660096">random-float</font><font color="#000000"> </font><font color="#963700">1.0</font><font color="#000000">))))
       </font><font color="#0000aa">set</font><font color="#000000"> vy (((</font><font color="#660096">random-normal</font><font color="#000000"> </font><font color="#963700">0.0</font><font color="#000000"> </font><font color="#963700">1.0</font><font color="#000000">) </font><font color="#660096">*</font><font color="#000000"> (</font><font color="#660096">sqrt</font><font color="#000000"> Temperature)) </font><font color="#660096">-</font><font color="#000000"> Wall_Velocity)]
   </font><font color="#0000aa">if</font><font color="#000000"> ((vx </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">or</font><font color="#000000"> (vy </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">)) [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">heading</font><font color="#000000"> </font><font color="#660096">atan</font><font color="#000000"> vx vy]
</font><font color="#007f69">end</font><font color="#000000"> 
  
</font><font color="#007f69">to</font><font color="#000000"> move                                                           </font><font color="#5a5a5a">; The particles move with velocity v</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> v </font><font color="#660096">sqrt</font><font color="#000000"> (vx </font><font color="#660096">*</font><font color="#000000"> vx </font><font color="#660096">+</font><font color="#000000"> vy </font><font color="#660096">*</font><font color="#000000"> vy)
   </font><font color="#0000aa">fd</font><font color="#000000"> v
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> monitor                                                        </font><font color="#5a5a5a">; Update the velocity distribution for the histogram</font><font color="#000000">
   </font><font color="#0000aa">if</font><font color="#000000"> (sample </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) [</font><font color="#0000aa">set</font><font color="#000000"> sum_vel </font><font color="#963700">0</font><font color="#000000">]
   </font><font color="#0000aa">foreach</font><font color="#000000"> [</font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000"> </font><font color="#963700">5</font><font color="#000000"> </font><font color="#963700">6</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000"> </font><font color="#963700">8</font><font color="#000000"> </font><font color="#963700">9</font><font color="#000000"> </font><font color="#963700">10</font><font color="#000000"> </font><font color="#963700">11</font><font color="#000000"> </font><font color="#963700">12</font><font color="#000000">] [
      </font><font color="#0000aa">if</font><font color="#000000"> (sample </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) [</font><font color="#0000aa">array:set</font><font color="#000000"> vel_hist ? </font><font color="#963700">0</font><font color="#000000">]
      </font><font color="#0000aa">let</font><font color="#000000"> column (</font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [((</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">&gt;</font><font color="#000000"> (</font><font color="#660096">min-pxcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> (? </font><font color="#660096">*</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">max-pxcor</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">13</font><font color="#000000">))) </font><font color="#660096">and</font><font color="#000000"> 
                                 (</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">&lt;</font><font color="#000000"> (</font><font color="#660096">min-pxcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> ((? </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) </font><font color="#660096">*</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">max-pxcor</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">13</font><font color="#000000">))))]) 
      </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">any?</font><font color="#000000"> column) [</font><font color="#0000aa">array:set</font><font color="#000000"> vel_hist ? ((</font><font color="#660096">array:item</font><font color="#000000"> vel_hist ?) </font><font color="#660096">+</font><font color="#000000"> (</font><font color="#660096">mean</font><font color="#000000"> [vy] </font><font color="#660096">of</font><font color="#000000"> column))]
   ]
   </font><font color="#0000aa">set</font><font color="#000000"> sum_vel (sum_vel </font><font color="#660096">+</font><font color="#000000"> (</font><font color="#660096">sum</font><font color="#000000"> [v] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000">))
   </font><font color="#0000aa">set</font><font color="#000000"> sample sample </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">
 
</font><font color="#007f69">to</font><font color="#000000"> setup-plot                                                     </font><font color="#5a5a5a">; Setup the histogram</font><font color="#000000">
   </font><font color="#0000aa">set-current-plot</font><font color="#000000"> </font><font color="#963700">&quot;Distribution of Velocities&quot;</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> do-plot                                                        </font><font color="#5a5a5a">; Draw the histogram</font><font color="#000000">
   </font><font color="#0000aa">clear-plot</font><font color="#000000">
   </font><font color="#0000aa">set-plot-x-range</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">780</font><font color="#000000"> </font><font color="#5a5a5a">; 540</font><font color="#000000">
   </font><font color="#0000aa">set-plot-y-range</font><font color="#000000"> (</font><font color="#660096">-</font><font color="#000000"> Wall_Velocity) (Wall_Velocity </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">0.001</font><font color="#000000">)
   
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;pen0&quot;</font><font color="#000000">
   </font><font color="#0000aa">plotxy</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> (</font><font color="#660096">array:item</font><font color="#000000"> vel_hist </font><font color="#963700">0</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> sample
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;pen1&quot;</font><font color="#000000">
   </font><font color="#0000aa">plotxy</font><font color="#000000"> </font><font color="#963700">60</font><font color="#000000"> (</font><font color="#660096">array:item</font><font color="#000000"> vel_hist </font><font color="#963700">1</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> sample
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;pen2&quot;</font><font color="#000000">
   </font><font color="#0000aa">plotxy</font><font color="#000000"> </font><font color="#963700">120</font><font color="#000000"> (</font><font color="#660096">array:item</font><font color="#000000"> vel_hist </font><font color="#963700">2</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> sample
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;pen3&quot;</font><font color="#000000">
   </font><font color="#0000aa">plotxy</font><font color="#000000"> </font><font color="#963700">180</font><font color="#000000"> (</font><font color="#660096">array:item</font><font color="#000000"> vel_hist </font><font color="#963700">3</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> sample
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;pen4&quot;</font><font color="#000000">
   </font><font color="#0000aa">plotxy</font><font color="#000000"> </font><font color="#963700">240</font><font color="#000000"> (</font><font color="#660096">array:item</font><font color="#000000"> vel_hist </font><font color="#963700">4</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> sample
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;pen5&quot;</font><font color="#000000">
   </font><font color="#0000aa">plotxy</font><font color="#000000"> </font><font color="#963700">300</font><font color="#000000"> (</font><font color="#660096">array:item</font><font color="#000000"> vel_hist </font><font color="#963700">5</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> sample
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;pen6&quot;</font><font color="#000000">
   </font><font color="#0000aa">plotxy</font><font color="#000000"> </font><font color="#963700">360</font><font color="#000000"> (</font><font color="#660096">array:item</font><font color="#000000"> vel_hist </font><font color="#963700">6</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> sample
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;pen7&quot;</font><font color="#000000">
   </font><font color="#0000aa">plotxy</font><font color="#000000"> </font><font color="#963700">420</font><font color="#000000"> (</font><font color="#660096">array:item</font><font color="#000000"> vel_hist </font><font color="#963700">7</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> sample
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;pen8&quot;</font><font color="#000000">
   </font><font color="#0000aa">plotxy</font><font color="#000000"> </font><font color="#963700">480</font><font color="#000000"> (</font><font color="#660096">array:item</font><font color="#000000"> vel_hist </font><font color="#963700">8</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> sample
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;pen9&quot;</font><font color="#000000">
   </font><font color="#0000aa">plotxy</font><font color="#000000"> </font><font color="#963700">540</font><font color="#000000"> (</font><font color="#660096">array:item</font><font color="#000000"> vel_hist </font><font color="#963700">9</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> sample
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;pen10&quot;</font><font color="#000000">
   </font><font color="#0000aa">plotxy</font><font color="#000000"> </font><font color="#963700">600</font><font color="#000000"> (</font><font color="#660096">array:item</font><font color="#000000"> vel_hist </font><font color="#963700">10</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> sample
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;pen11&quot;</font><font color="#000000">
   </font><font color="#0000aa">plotxy</font><font color="#000000"> </font><font color="#963700">660</font><font color="#000000"> (</font><font color="#660096">array:item</font><font color="#000000"> vel_hist </font><font color="#963700">11</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> sample
   </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;pen12&quot;</font><font color="#000000">
   </font><font color="#0000aa">plotxy</font><font color="#000000"> </font><font color="#963700">720</font><font color="#000000"> (</font><font color="#660096">array:item</font><font color="#000000"> vel_hist </font><font color="#963700">12</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> sample
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> compute-stats                                                  </font><font color="#5a5a5a">; Compute slope and correlation coefficient of velocity histogram</font><font color="#000000">
   </font><font color="#0000aa">let</font><font color="#000000"> xbar </font><font color="#963700">6.0</font><font color="#000000"> </font><font color="#0000aa">let</font><font color="#000000"> ybar </font><font color="#963700">0</font><font color="#000000">
   </font><font color="#0000aa">let</font><font color="#000000"> sxy </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">let</font><font color="#000000"> sx </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">let</font><font color="#000000"> sy </font><font color="#963700">0</font><font color="#000000">
   </font><font color="#0000aa">foreach</font><font color="#000000"> [</font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000"> </font><font color="#963700">5</font><font color="#000000"> </font><font color="#963700">6</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000"> </font><font color="#963700">8</font><font color="#000000"> </font><font color="#963700">9</font><font color="#000000"> </font><font color="#963700">10</font><font color="#000000"> </font><font color="#963700">11</font><font color="#000000"> </font><font color="#963700">12</font><font color="#000000">] [
      </font><font color="#0000aa">set</font><font color="#000000"> ybar (ybar </font><font color="#660096">+</font><font color="#000000"> (</font><font color="#660096">array:item</font><font color="#000000"> vel_hist ?) </font><font color="#660096">/</font><font color="#000000"> sample)
   ]
   </font><font color="#0000aa">set</font><font color="#000000"> ybar (ybar </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">13</font><font color="#000000">)
   </font><font color="#0000aa">foreach</font><font color="#000000"> [</font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000"> </font><font color="#963700">5</font><font color="#000000"> </font><font color="#963700">6</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000"> </font><font color="#963700">8</font><font color="#000000"> </font><font color="#963700">9</font><font color="#000000"> </font><font color="#963700">10</font><font color="#000000"> </font><font color="#963700">11</font><font color="#000000"> </font><font color="#963700">12</font><font color="#000000">] [
      </font><font color="#0000aa">set</font><font color="#000000"> sxy (sxy </font><font color="#660096">+</font><font color="#000000"> ((? </font><font color="#660096">-</font><font color="#000000"> xbar) </font><font color="#660096">*</font><font color="#000000"> (((</font><font color="#660096">array:item</font><font color="#000000"> vel_hist ?) </font><font color="#660096">/</font><font color="#000000"> sample) </font><font color="#660096">-</font><font color="#000000"> ybar)))
      </font><font color="#0000aa">set</font><font color="#000000"> sx (sx </font><font color="#660096">+</font><font color="#000000"> ((? </font><font color="#660096">-</font><font color="#000000"> xbar) </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">))
      </font><font color="#0000aa">set</font><font color="#000000"> sy (sy </font><font color="#660096">+</font><font color="#000000"> (((</font><font color="#660096">array:item</font><font color="#000000"> vel_hist ?) </font><font color="#660096">/</font><font color="#000000"> sample) </font><font color="#660096">-</font><font color="#000000"> ybar) </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">)
   ]
   </font><font color="#0000aa">set</font><font color="#000000"> slope (sxy </font><font color="#660096">/</font><font color="#000000"> sx)
   </font><font color="#0000aa">set</font><font color="#000000"> corr (sxy </font><font color="#660096">/</font><font color="#000000"> ((</font><font color="#660096">sqrt</font><font color="#000000"> sx) </font><font color="#660096">*</font><font color="#000000"> (</font><font color="#660096">sqrt</font><font color="#000000"> sy)))
</font><font color="#007f69">end</font><font color="#000000">
</font>
</pre>

</body>
</html>
